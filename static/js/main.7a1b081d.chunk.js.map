{"version":3,"sources":["common/constants.js","common/utilities.js","actions/index.js","selectors/index.js","selectors/helpers.js","store/plugins/urlState/schema.js","store/plugins/urlState/urlState.js","store/plugins/urlState/applyUrlState.js","common/global.js","store/initial.js","reducers/validate/eventSchema.js","reducers/validate/siteSchema.js","reducers/validate/associationsSchema.js","reducers/validate/sourceSchema.js","reducers/validate/regionSchema.js","reducers/validate/shapeSchema.js","reducers/validate/validators.js","reducers/domain.js","reducers/app.js","reducers/ui.js","reducers/features.js","reducers/index.js","reducers/root.js","store/index.js","store/plugins/urlState/middleware.js","components/atoms/Checkbox.js","components/controls/FilterListPanel.js","components/controls/atoms/PanelTree.js","components/controls/CategoriesListPanel.js","components/controls/ShapesListPanel.js","components/atoms/SitesIcon.js","components/atoms/CoverIcon.js","components/atoms/InfoIcon.js","components/controls/BottomActions.js","components/controls/atoms/ToolbarButton.js","components/controls/FullScreenToggle.js","components/Toolbar.js","components/atoms/Popup.js","components/InfoPopup.js","components/Notification.js","components/atoms/Md.js","components/atoms/Spinner.js","components/atoms/NoSource.js","components/atoms/Content.js","components/atoms/Controls.js","components/atoms/Media.js","assets/github-white.png","components/TemplateCover.js","components/atoms/StaticPage.js","components/atoms/Loading.js","components/time/atoms/Header.js","components/time/Axis.js","components/time/atoms/Clip.js","components/time/atoms/Handles.js","components/time/atoms/ZoomControls.js","components/time/atoms/Markers.js","components/time/atoms/DatetimeBar.js","components/time/atoms/DatetimeSquare.js","components/time/atoms/DatetimeStar.js","components/time/atoms/DatetimeTriangle.js","components/time/atoms/DatetimePentagon.js","components/time/atoms/Project.js","components/atoms/ColoredMarkers.js","components/time/atoms/Events.js","components/time/Categories.js","components/time/Timeline.js","components/space/carto/atoms/Sites.js","components/space/carto/atoms/Regions.js","components/space/carto/atoms/Events.js","components/space/carto/atoms/Clusters.js","components/space/carto/atoms/SelectedEvents.js","components/space/carto/atoms/Narratives.js","components/space/carto/atoms/DefsMarkers.js","assets/satelliteoverlaytoggle/map.png","assets/satelliteoverlaytoggle/sat.png","components/space/carto/atoms/SatelliteOverlayToggle.js","components/space/carto/Map.js","components/space/Space.js","components/controls/atoms/SearchRow.jsx","components/controls/Search.js","components/controls/atoms/Text.js","components/controls/atoms/Time.js","components/controls/atoms/Button.js","components/controls/atoms/Caret.js","components/controls/atoms/CustomField.js","components/controls/atoms/TelegramEmbed.js","components/controls/atoms/Media.js","components/controls/Card.js","components/controls/CardStack.js","components/controls/atoms/NarrativeCard.js","components/controls/atoms/NarrativeAdjust.js","components/controls/atoms/NarrativeClose.js","components/controls/NarrativeControls.js","components/Layout.js","components/App.js","index.jsx"],"names":["ASSOCIATION_MODES","CATEGORY","NARRATIVE","FILTER","SHAPE","DEFAULT_TAB_ICONS","AVAILABLE_SHAPES","POLYGON_CLIP_PATH","STAR","DIAMOND","PENTAGON","TRIANGLE","dayjs","extend","customParseFormat","DATE_FMT","TIME_FMT","process","language","getPathLeaf","path","splitPath","split","length","getCoordinatesForPercent","radius","percent","Math","cos","PI","sin","zipColorsToPercentages","colors","percentages","Error","reduce","map","idx","capitalize","string","charAt","toUpperCase","slice","aggregateFilterPaths","filters","insertPath","children","arguments","undefined","headOfPath","remainder","accumulatedPath","childKey","Object","keys","find","push","accumulatedPlusHead","join","allPaths","forEach","filterItem","filter_paths","getFilterAncestors","filter","splitFilter","ancestors","f","index","pop","getEventCategories","event","activeCategories","associations","a","mode","acc","val","activeCatTitle","cat","title","createFilterPathString","insetSourceFrom","allSources","sources","id","hasOwnProperty","urlFromEnv","ext","Array","isArray","suffix","toggleFlagAC","flag","appState","flags","typeForPath","type","trim","test","isIdentical","obj1","obj2","hash","calcOpacity","num","min","calcClusterOpacity","pointCount","totalPoints","calcClusterSize","maxSize","calculateTotalClusterPoints","clusters","total","cl","properties","cluster","point_count","isLatitude","lat","isFinite","abs","isLongitude","lng","mapClustersToLocations","locations","foundLocation","location","label","calculateColorPercentages","set","coloringSet","associationMap","value","entries","associationCounts","fill","totalAssociations","item","innerSet","events","count","getFilterIdxFromColorSet","filterIdx","indexOf","makeNiceDate","datetime","dateTimeFormat","Intl","DateTimeFormat","year","month","day","formatToParts","isEmptyString","s","EVENT_DATA_URL","ASSOCIATIONS_URL","SOURCES_URL","SITES_URL","REGIONS_URL","SHAPES_URL","domainMsg","domainType","fetchDomain","notifications","handleError","message","dispatch","getState","features","toggleFetchingDomain","eventPromise","Promise","all","url","fetch","then","response","json","catch","results","flatMap","t","associationsPromise","resolve","USE_ASSOCIATIONS","sourcesPromise","USE_SOURCES","sitesPromise","USE_SITES","regionsPromise","USE_REGIONS","shapesPromise","USE_SHAPES","result","sites","regions","shapes","values","some","resp","setInitialCategories","setInitialShapes","err","fetchError","alert","FETCH_ERROR","UPDATE_DOMAIN","updateDomain","payload","fetchSource","source","toggleFetchingSources","ok","fetchSourceError","UPDATE_HIGHLIGHTED","updateHighlighted","highlighted","UPDATE_SELECTED","updateSelected","selected","UPDATE_DISTRICT","updateDistrict","district","CLEAR_FILTER","clearFilter","TOGGLE_ASSOCIATIONS","toggleAssociations","association","shouldColor","TOGGLE_SHAPES","toggleShapes","shape","SET_LOADING","setLoading","SET_NOT_LOADING","setNotLoading","SET_INITIAL_CATEGORIES","SET_INITIAL_SHAPES","UPDATE_TIMERANGE","updateTimeRange","timerange","UPDATE_DIMENSIONS","updateDimensions","dims","UPDATE_NARRATIVE","updateNarrative","narrative","UPDATE_NARRATIVE_STEP_IDX","updateNarrativeStepIdx","UPDATE_SOURCE","updateSource","UPDATE_COLORING_SET","updateColoringSet","UPDATE_TICKS","updateTicks","ticks","TOGGLE_SITES","toggleSites","TOGGLE_FETCHING_DOMAIN","TOGGLE_FETCHING_SOURCES","TOGGLE_LANGUAGE","toggleLanguage","CLOSE_TOOLBAR","closeToolbar","TOGGLE_INFOPOPUP","toggleInfoPopup","TOGGLE_INTROPOPUP","toggleIntroPopup","TOGGLE_NOTIFICATIONS","toggleNotifications","MARK_NOTIFICATIONS_READ","markNotificationsRead","TOGGLE_COVER","toggleCover","UPDATE_SEARCH_QUERY","updateSearchQuery","searchQuery","FETCH_SOURCE_ERROR","msg","TOGGLE_SATELLITE_VIEW","toggleSatelliteView","REHYDRATE_STATE","rehydrateState","getEvents","state","domain","getCategories","getActiveNarrative","app","getSelected","getSources","getShapes","getFilters","getActiveFilters","getActiveCategories","categories","getActiveShapes","getTimeRange","timeline","range","getFeatures","getTiles","ui","tiles","current","selectSites","createSelector","enabled","selectRegions","selectEvents","activeFilters","activeShapes","timeRange","isActiveFilter","includes","isActiveCategory","isActiveTime","eventTime","isTimeRangedIn","GRAPH_NONLOCATED","latitude","longitude","isActiveShape","selectEventCountInTimeRange","curr","selectNarratives","narrativesMeta","narratives","evt","foundNarrative","narr","narrId","steps","key","sort","b","existingAssociatedNarrative","n","d","selectNarrativeIdx","selectedEvent","selectedIdx","step","selectActiveNarrative","selectLocations","activeLocations","selectEventsWithProjects","eventRadius","projSize","projectIdx","projects","project","start","prototype","call","dateMin","end","dateMax","category","projObjs","activeProjs","_","proj","theIdx","theProj","theProjIdx","i","offset","selectStackedEvents","eventsWithProjects","selectProjects","selectSelected","selectDimensions","dimensions","trackHeight","contentHeight","selectFilterPathToIdMapping","selectActiveColorSets","mapping","mapFiltersToIds","selectActiveFilterIds","arr","filterMapping","SCHEMA_TYPES","NUMBER","NUMBER_ARRAY","STRING","STRING_ARRAY","DATE","DATE_ARRAY","isSchemaArray","schema","SCHEMA","freeze","trigger","dehydrate","_ref","rehydrate","nextState","_ref2","e","_ref3","from","Date","_ref4","mapFilterIdsToPaths","x","color","_ref5","URLState","constructor","this","URL","window","delete","searchParams","encoded","_encode","append","serialize","history","replaceState","deserialize","getAll","_decode","get","toString","format","applyUrlState","urlState","o","console","error","fa_red","yellow","black","white","exports","fallbackEventColor","darkBackground","primaryHighlight","secondaryHighlight","isSmallLaptop","innerHeight","mapIniital","anchor","startZoom","minZoom","maxZoom","bounds","maxBounds","space3dInitial","initial","debug","errors","views","routes","isMobile","navigator","userAgent","height","width","marginLeft","marginTop","marginBottom","width_controls","rangeLimits","zoomLevels","copy","duration","isFetchingDomain","isFetchingSources","isCover","isCardstack","isInfopopup","isIntropopup","isShowingSites","cover","description","exploreButton","toolbar","panels","default","icon","categories_label","explore_by_category__title","explore_by_category__description","filters_label","explore_by_filter__title","explore_by_filter__description","narratives_label","explore_by_narrative__title","explore_by_narrative__description","shapes_label","explore_by_shape__title","explore_by_shape__description","loading","style","global","opacity","stroke","strokeWidth","radial","card","layout","template","coloring","maxNumOfColors","dom","timeslider","USE_COVER","HIGHLIGHT_GROUPS","appStore","mergeDeepLeft","intro","space3d","joiFromCustom","custom","output","field","kind","Joi","allow","array","createEventSchema","object","required","date","time","time_precision","y","z","category_full","comments","time_display","narrative___stepStyles","colour","and","or","siteSchema","site","associationsSchema","desc","sourceSchema","thumbnail","paths","affil_s","parent","author","notes","regionSchema","name","items","shapeSchema","makeError","validateDomain","sanitizedDomain","discardedDomain","validateArray","domainKey","validate","assign","validateArrayItem","CUSTOM_EVENT_FIELDS","eventSchema","obj","itemSchema","vl","domainStr","region","points","coords","replace","duplicateAssociations","seenSet","Set","duplicates","has","add","findDuplicateAssociations","errorMsg","foundAssociation","elem","relatedShapeObj","toDate","isNaN","disc","len","domainState","action","isRead","associationType","newAssociations","newShapes","splice","minTime","maxTime","cornerBound0","cornerBound1","stepTime","first","firstToLong0","firstToLong1","firstToLat0","firstToLat1","narrativeState","otherLanguage","sh","uiState","featureState","decorateRootReducer","rootReducer","reducer","combineReducers","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","next","schemas","Checkbox","isActive","onClickCheckbox","styleProps","checkboxColor","baseStyles","checkboxStyles","background","border","containerStyles","_jsxs","className","_jsx","onClick","getFiltersToToggle","turningOff","childKeys","child","FilterListPanel","onSelectFilter","filterColors","createNodeComponent","depth","pathLeaf","matchingKeys","idxFromColorSet","assignedColor","styles","dangerouslySetInnerHTML","__html","marked","aggregatedFilterPaths","renderTree","PanelTree","data","activeValues","onSelect","onSelectionType","CategoriesListPanel","onCategoryFilter","ShapesListPanel","onShapeFilter","styledShapes","clipPath","mapStyleByShape","SitesIcon","isDisabled","onClickHandler","classes","CoverIcon","BottomActions","props","_Fragment","toggle","InfoIcon","info","ToolbarButton","iconKey","tabsRole","FullscreenToggle","React","Component","super","onFullscreenStateChange","bind","isFullscreen","screenfull","componentDidMount","on","componentWillUnmount","off","setState","onToggleFullscreen","warn","render","isEnabled","fullscreen_exit","fullscreen_enter","Toolbar","_selected","selectTab","getImmediateFilterParent","siblings","allFilters","filterParent","filterKey","findSiblings","filterPathObj","nextAncestor","shift","nextObjToSearch","sib","getFilterSiblings","siblingsOff","sibling","grandparentsOn","filt","concat","updatedColoringSet","removeFromColoringSet","actions","flattenedColoringSet","newColoringSet","k","addToColoringSet","methods","renderClosePanel","goToNarrative","onSelectNarrative","renderToolbarNarrativePanel","toolbarCopy","TabPanel","stringNum","substring","renderToolbarCategoriesPanel","panelCategories","catMap","mappedCats","mapCategoriesToPaths","renderToolbarFilterPanel","renderToolbarShapePanel","renderToolbarTab","renderToolbarCategoryTabs","idxs","renderToolbarPanels","USE_CATEGORIES","renderToolbarNavs","nar","renderToolbarTabs","narrativesExist","categoryIdxs","startingIdx","idxCounter","getCategoryIdxs","numCategoryPanels","filtersIdx","categoriesExist","getFilterIdx","shapesIdx","onTitle","TabList","USE_FULLSCREEN","infoShowing","sitesShowing","isNarrative","Tabs","selectedIndex","connect","selectors","viewFilters","bindActionCreators","fontSize","innerWidth","Popup","content","isOpen","onClose","theme","Infopopup","legend","header","Notification","isExtended","toggleDetails","renderItems","renderNotificationContent","notification","onToggle","Md","md","text","unloader","loader","Spinner","small","NoSource","failedUrls","Content","media","viewIdx","translations","switchLanguage","langIdx","el","document","querySelector","shiftW","getBoundingClientRect","transform","m","poster","Img","src","open","trans","code","Player","playsInline","renderError","renderMedia","OverlayControls","onShiftHandler","backArrow","forwardArrow","SourceOverlay","mediaIdx","onShiftGallery","getTypeCounts","Image","Video","Text","renderContent","shortenedTitle","onCancel","stopPropagation","lang","p","selectTypeFromPathWithPoster","Controls","href","target","rel","renderIntlContent","translated","file","opaque","TemplateCover","video","featureLang","getVideo","headerEndIndex","headerVideos","videos","onVideoClickHandler","buffer","renderFeature","featureVideo","renderHeaderVideos","buttonTitle","renderButton","button","renderMediaOverlay","MediaOverlay","footerButton","showing","bcatlogo","alt","bgVideo","loop","muted","autoPlay","preload","margin","subtitle","subsubtitle","headerButton","showAppHandler","buttonSubtitle","StaticPage","LoadingOverlay","isLoading","TimelineHeader","to","hideInfo","d0","d1","languages","require","timeFormatDefaultLocale","setD3Locale","TimelineAxis","xAxis0Ref","createRef","xAxis1Ref","isInitialized","componentDidUpdate","fstFmt","sndFmt","extent","scaleX","x0","axisBottom","tickPadding","tickSize","tickFormat","timeFormat","x1","select","transition","transitionDuration","ref","TimelineClip","max","TimelineHandles","onMoveTime","handleOffset","r","DEFAULT_ZOOM_LEVELS","TimelineZoomControls","onApplyZoom","zoom","zoomIsActive","renderZoom","TimelineMarkers","getEventX","getEventY","renderCircle","cx","cy","strokeOpacity","strokeLinejoin","strokeDasharray","WebkitTransition","MozTransition","renderBar","isDot","projectOffset","evShadows","renderMarkerForEvent","DatetimeBar","highlights","extraRender","sectionHeight","h","DatetimeSquare","center","createStar","numPoints","innerRadius","outerRadius","angle","DatetimeStar","DatetimeTriangle","DatetimePentagon","Project","getX","fillOpacity","ColoredMarkers","colorPercentMap","cumulativeAngleSweep","colorPercent","startX","startY","endX","endY","largeArcFlag","arc","extraStyles","renderDot","colorPercentages","renderDiamond","renderSquare","renderTriangle","renderPentagon","renderStar","fillRule","TimelineEvents","getDatetimeX","getY","getCategoryColor","getHighlights","narIds","renderProjects","log","eventShape","renderShape","getRender","filterIndexIndicatingGroup","evShadow","TimelineCategories","grabRef","drag","d3Drag","onDragStart","onDrag","onDragEnd","renderCategory","getCategoryY","x2","dy","fallbackLabel","renderedCategories","Timeline","styleDatetime","svgRef","isFolded","scaleY","dragPos0","addEventListeners","UNSAFE_componentWillReceiveProps","nextProps","makeScaleX","makeScaleY","computeDims","addEventListener","element","scaleTime","catHeight","catsYpos","g","extraPadding","prevProps","prevState","getTimeScaleExtent","timeDomain","getTime","onClickArrow","boundingClient","direction","newCentralTime","timeMinute","domain0","domainF","onUpdateTimerange","onCenterTime","onSoftTimeRangeUpdate","newDomain0","newDomainF","minDate","maxDate","toggleTransition","isTransition","sourceEvent","timeShift","invert","timeSecond","timestamp","ZOOM_TO_TIMEFRAME_ON_TIMELINE_CLICK","timeframe","floor","foldedStyle","bottom","left","heightStyle","extraStyle","eventCountInTimeRange","onKeyDown","tabIndex","Header","Clip","Axis","Categories","default_categories_label","Handles","dir","ZoomControls","Markers","ev","Events","group","c","selectedEvents","MapSites","projectPoint","MapRegions","svg","Portal","node","lineCoords","p1","p2","y1","y2","regionstyles","markerStart","MapEvents","styleLocation","renderLocationSlicesByAssociation","onlyIfInNarrative","customStyles","isSelected","shiftKey","handleEventSelect","display","DefsClusters","Cluster","size","renderHover","getClusterChildren","cluster_id","clusterId","coordinates","geometry","hovered","setHovered","useState","onMouseEnter","onMouseLeave","ClusterEvents","isRadial","clusterSize","txt","circleSize","textAnchor","fontWeight","zIndex","MapSelectedEvents","renderMarker","marker","strokeLinecap","defaultStyles","MapNarratives","hasNoLocation","_renderNarrativeStepArrow","distance","sqrt","theta","atan2","alpha","coord0","coord1","coord2","renderBetweenSteps","step1","step2","_renderNarrativeStep","renderBetweenMarked","arrows","lastMarked","withLines","_idx","stepStyle","stepStyles","narrativeId","body","NARRATIVE_STEP_STYLES","renderFullNarrative","MapDefsMarkers","viewBox","refX","refY","markerWidth","markerHeight","orient","SatelliteOverlayToggle","switchToSatellite","reset","isUsingSatellite","backgroundImage","mapImg","satImg","satellite","supportedMapboxMap","Map","onClusterSelect","loadClusterData","superclusterIndex","tileLayer","mapTransformX","mapTransformY","indexLoaded","initializeMap","initializeTileLayer","dispatchEvent","Event","eventPoint","setView","getZoom","animate","pan","fitBounds","getTileUrl","MAPBOX_TOKEN","setUrl","L","addTo","mapConfig","clusterConfig","setMinZoom","setMaxZoom","setMaxBounds","Supercluster","keyboard","disable","zoomControl","remove","updateClusters","alignLayers","dragging","enable","doubleClickZoom","scrollWheelZoom","flushSync","classList","getMapDetails","getBounds","getWest","getSouth","getEast","getNorth","bbox","getClusters","convertedLocations","loc","feature","load","getLeaves","Infinity","getSelectedClusters","selectedIds","sl","clusterPresent","findIndex","mapNode","transformX","transformY","getComputedStyle","getPropertyValue","latLng","LatLng","latLngToLayerPoint","expansionZoom","getClusterExpansionZoom","parseInt","options","zoomToFly","flyTo","getClientDims","renderTiles","pane","getPanes","overlayPane","renderSites","Sites","renderRegions","Regions","renderNarratives","hasNarratives","Narratives","styleCluster","renderEvents","filteredLocations","renderClusters","allClusters","Clusters","renderSelected","selectedClusters","totalMarkers","totalClusterPoints","String","SelectedEvents","mapSelectedEvents","renderMarkers","DefsMarkers","innerMap","USE_SATELLITE_OVERLAY_TOGGLE","toggleView","Space","MapCarto","SearchRow","query","eventObj","onSearchRowClick","getHighlightedText","highlight","parts","RegExp","part","toLowerCase","backgroundColor","regexp","match","firstLine","getShortDescription","Search","onButtonClick","queryString","searchResults","searchAttributes","attribute","onChange","CardText","hoverValue","showHover","setShowHover","onMouseOver","onMouseOut","pointerEvents","borderBottom","CardTime","timelabel","precision","unknownLang","cardstack","unknown_time","variable","Button","primary","borderRadius","normalCursor","defaultProps","CardButton","CardCaret","CardCustomField","frameBorder","scrolling","overflow","TelegramEmbed","messageHandler","urlObj","createElement","iFrame","checkFrame","removeEventListener","contentWindow","JSON","parse","postMessage","stringify","frame","pathname","container","Media","videoRef","useRef","onVideoStart","useCallback","_videoRef$current","play","onVideoStop","_videoRef$current2","pause","formattedTitle","TITLE_LENGTH","disablePictureInPicture","TelegramPostEmbed","tweetId","exec","TwitterTweetEmbed","generateCardLayout","basic","times","scaleFont","sourced","Card","setIsOpen","renderTime","CardMedia","renderField","CardCustom","textTransform","lineHeight","justifyContent","align","row","renderRow","CardStack","refs","refCardStack","refCardStackContent","scrollToCard","cardScroll","offsetTop","scrollTop","change","currentTime","easeInOutQuad","animateScroll","setTimeout","renderCards","selections","generateTemplate","cardUI","thisRef","renderSelectedCards","renderNarrativeCards","renderCardStackHeader","headerLang","onToggleCardstack","renderCardStackContent","renderNarrativeContent","sourceError","Adjust","Close","closeMsg","NarrativeControls","prevExists","nextExists","onPrev","onNext","Dashboard","handleViewSource","handleHighlight","setNarrative","setNarrativeFromFilters","handleSelect","findEventIdx","selectNarrativeStep","theEvent","ar","compareFn","cmp","binarySearch","theev","otherev","axis","matchedEvents","ptr","std","withSteps","evs","hasOne","locationEventId","narrativeIdxObj","narrativeIdx","prev","keyCode","renderIntroPopup","extraContent","position","checkMobile","isMobileOnly","popupStyles","maxWidth","maxHeight","top","overflowY","timelineDims","onViewSource","onHighlight","InfoPopup","isNotification","USE_SEARCH","App","Layout","ReactDOM","createRoot","getElementById","Provider","isOpera","opr","addons","opera","isIE","HTMLElement","safari","pushNotification","documentMode","isEdge","StyleMedia","chrome","webstore","CSS"],"mappings":"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","file":"static/js/main.7a1b081d.chunk.js","sourcesContent":["export const ASSOCIATION_MODES = {\n  CATEGORY: \"CATEGORY\",\n  NARRATIVE: \"NARRATIVE\",\n  FILTER: \"FILTER\",\n};\n\nexport const SHAPE = \"SHAPE\";\n\nexport const DEFAULT_TAB_ICONS = {\n  CATEGORY: \"widgets\",\n  NARRATIVE: \"timeline\",\n  FILTER: \"filter_list\",\n  SHAPE: \"change_history\",\n};\n\nexport const AVAILABLE_SHAPES = {\n  STAR: \"STAR\",\n  DIAMOND: \"DIAMOND\",\n  PENTAGON: \"PENTAGON\",\n  SQUARE: \"SQUARE\",\n  DOT: \"DOT\",\n  BAR: \"BAR\",\n  TRIANGLE: \"TRIANGLE\",\n};\n\nexport const POLYGON_CLIP_PATH = {\n  STAR: \"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)\",\n  DIAMOND: \"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)\",\n  PENTAGON: \"polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)\",\n  TRIANGLE: \"polygon(50% 0%, 0% 100%, 100% 100%)\",\n};\n\nexport const DEFAULT_CHECKBOX_COLOR = \"#ffffff\";\n","import customParseFormat from \"dayjs/plugin/customParseFormat\";\nimport dayjs from \"dayjs\";\nimport hash from \"object-hash\";\nimport { timeFormatDefaultLocale } from \"d3\";\n\nimport { ASSOCIATION_MODES, POLYGON_CLIP_PATH } from \"./constants\";\n\ndayjs.extend(customParseFormat);\n\nlet { DATE_FMT, TIME_FMT } = process.env;\nif (!DATE_FMT) DATE_FMT = \"MM/DD/YYYY\";\nif (!TIME_FMT) TIME_FMT = \"HH:mm\";\n\nexport const language = process.env.store.app.language || \"en-US\";\n\nexport function getPathLeaf(path) {\n  const splitPath = path.split(\"/\");\n  return splitPath[splitPath.length - 1];\n}\n\nexport function calcDatetime(date, time) {\n  if (!time) time = \"00:00\";\n  const dt = dayjs(`${date} ${time}`, `${DATE_FMT} ${TIME_FMT}`);\n  return dt.toDate();\n}\n\nexport function getCoordinatesForPercent(radius, percent) {\n  const x = radius * Math.cos(2 * Math.PI * percent);\n  const y = radius * Math.sin(2 * Math.PI * percent);\n  return [x, y];\n}\n\n/**\n * This function takes the array of percentages: [0.5, 0.5, ...]\n * and maps it by index to the set of colors ['#fff', '#000', ...]\n * If there aren't enough colors in the set, it raises an error for the user\n *\n * Return value:\n * ex. {'#fff': 0.5, '#000': 0.5, ...} */\nexport function zipColorsToPercentages(colors, percentages) {\n  if (colors.length < percentages.length) {\n    throw new Error(\"You must declare an appropriate number of filter colors\");\n  }\n\n  return percentages.reduce((map, percent, idx) => {\n    map[colors[idx]] = percent;\n    return map;\n  }, {});\n}\n\n/**\n * Compare two arrays of scalars\n * @param {array} arr1: array of numbers\n * @param {array} arr2: array of numbers\n */\nexport function areEqual(arr1, arr2) {\n  return (\n    arr1.length === arr2.length &&\n    arr1.every((element, index) => {\n      return element === arr2[index];\n    })\n  );\n}\n\n/**\n * Return whether the variable is neither null nor undefined\n * @param {object} variable\n */\nexport function isNotNullNorUndefined(variable) {\n  return typeof variable !== \"undefined\" && variable !== null;\n}\n\n/*\n * Taken from: https://stackoverflow.com/questions/1026069/how-do-i-make-the-first-letter-of-a-string-uppercase-in-javascript\n */\nexport function capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nexport function trimAndEllipse(string, stringNum) {\n  if (string.length > stringNum) {\n    return string.substring(0, 120) + \"...\";\n  }\n  return string;\n}\n\n/**\n * Takes the complete set of filters, and according to their paths places them at the correct node\n *\n * Returns a nested object where:\n * Key: filter_path_0/filter_path_1/filter_path_2...\n * Value: {...nested children}\n */\nexport function aggregateFilterPaths(filters) {\n  function insertPath(\n    children = {},\n    [headOfPath, ...remainder],\n    accumulatedPath\n  ) {\n    const childKey = Object.keys(children).find((path) => {\n      const pathLeaf = getPathLeaf(path);\n      return pathLeaf === headOfPath;\n    });\n    accumulatedPath.push(headOfPath);\n    const accumulatedPlusHead = accumulatedPath.join(\"/\");\n    if (!childKey) children[accumulatedPlusHead] = {};\n    if (remainder.length > 0)\n      insertPath(children[accumulatedPlusHead], remainder, accumulatedPath);\n    return children;\n  }\n\n  const allPaths = [];\n  filters.forEach((filterItem) => allPaths.push(filterItem.filter_paths));\n  const aggregatedPaths = allPaths.reduce(\n    (children, path) => insertPath(children, path, []),\n    {}\n  );\n  return aggregatedPaths;\n}\n\n/**\n * From the set of associations, grab a given filter's set of parents,\n * ie. all the elements in the path array before the idx where the filter is located.\n * If we can't find the filter by the ID, we know its a meta filter, so we look\n * through every association's given path attribute to find its location.\n *\n * Returns the list of parents: ex. ['Chemical', 'Tear Gas', ...]\n */\nexport function getFilterAncestors(filter) {\n  const splitFilter = filter.split(\"/\");\n  const ancestors = [];\n  splitFilter.forEach((f, index) => {\n    const accumulatedPath = splitFilter.slice(0, index + 1).join(\"/\");\n    ancestors.push(accumulatedPath);\n  });\n  // The last element here will be the leaf node aka the filter passed in\n  ancestors.pop();\n  return ancestors;\n}\n\n/**\n * Grabs the second to last element in the paths array for a given existing filter.\n * This is the filter's most immediate ancestor.\n */\nexport function getImmediateFilterParent(filter) {\n  const ancestors = getFilterAncestors(filter);\n  return ancestors[ancestors.length - 1];\n}\n\n/**\n * Grabs a given filter's siblings: the set of associations that share the same immediate filter parent.\n */\nexport function getFilterSiblings(allFilters, filterParent, filterKey) {\n  function findSiblings(filterPathObj, ancestors) {\n    if (ancestors.length === 0 || filterPathObj === {}) return {};\n    const nextAncestor = ancestors.shift();\n    if (Object.keys(filterPathObj).includes(nextAncestor)) {\n      const nextObjToSearch = filterPathObj[nextAncestor];\n      if (ancestors.length === 0) {\n        return nextObjToSearch;\n      } else {\n        return findSiblings(nextObjToSearch, ancestors);\n      }\n    }\n  }\n  const aggregatedFilters = aggregateFilterPaths(allFilters);\n  const ancestors = getFilterAncestors(filterKey);\n  const siblings = findSiblings(aggregatedFilters, ancestors);\n  return Object.keys(siblings).filter((sib) => sib !== filterKey);\n}\n\n/**\n * Looks at the current coloring set (ie. a map between sets of filters and colors) and configures where to add next set\n */\nexport function addToColoringSet(coloringSet, filters) {\n  const flattenedColoringSet = coloringSet.flatMap((f) => f);\n  const newColoringSet = filters.filter(\n    (k) => flattenedColoringSet.indexOf(k) === -1\n  );\n  return [...coloringSet, newColoringSet];\n}\n\n/**\n * Looks at the current coloring set (ie. a map between sets of filters and colors) and configures new sets based off of existing filters\n */\nexport function removeFromColoringSet(coloringSet, filters) {\n  const newColoringSets = coloringSet.map((set) =>\n    set.filter((s) => {\n      return !filters.includes(s);\n    })\n  );\n  return newColoringSets.filter((item) => item.length !== 0);\n}\n\nexport function getEventCategories(event, activeCategories) {\n  const eventCats = event.associations.filter(\n    (a) => a.mode === ASSOCIATION_MODES.CATEGORY\n  );\n  return eventCats.reduce((acc, val) => {\n    const activeCatTitle = activeCategories.find((cat) => cat === val.title);\n    if (activeCatTitle) acc.push(activeCatTitle);\n    return acc;\n  }, []);\n}\n\n/**\n * Takes a filter's path and concatenates it like so: Parent 1/Parent 2/Child\n */\nexport function createFilterPathString(filter) {\n  return filter.filter_paths.join(\"/\");\n}\n\n/**\n * Inset the full source represenation from 'allSources' into an event. The\n * function is 'curried' to allow easy use with maps. To use for a single\n * source, call with two sets of parentheses:\n *      const src = insetSourceFrom(sources)(anEvent)\n */\nexport function insetSourceFrom(allSources) {\n  return (event) => {\n    let sources;\n    if (!event.sources) {\n      sources = [];\n    } else {\n      sources = event.sources.map((id) => {\n        return allSources.hasOwnProperty(id) ? allSources[id] : null;\n      });\n    }\n    return {\n      ...event,\n      sources,\n    };\n  };\n}\n\n/**\n * Debugging function: put in place of a mapStateToProps function to\n * view that source modal by default\n */\nexport function injectSource(id) {\n  return (state) => {\n    return {\n      ...state,\n      app: {\n        ...state.app,\n        source: state.domain.sources[id],\n      },\n    };\n  };\n}\n\nexport function urlFromEnv(ext) {\n  if (process.env[ext]) {\n    if (!Array.isArray(process.env[ext])) {\n      return [`${process.env.SERVER_ROOT}${process.env[ext]}`];\n    } else {\n      return process.env[ext].map(\n        (suffix) => `${process.env.SERVER_ROOT}${suffix}`\n      );\n    }\n  } else {\n    return null;\n  }\n}\n\nexport function toggleFlagAC(flag) {\n  return (appState) => ({\n    ...appState,\n    flags: {\n      ...appState.flags,\n      [flag]: !appState.flags[flag],\n    },\n  });\n}\n\nexport function selectTypeFromPath(path) {\n  let type;\n  switch (true) {\n    case /\\.(png|jpg)$/.test(path):\n      type = \"Image\";\n      break;\n    case /\\.(mp4)$/.test(path):\n      type = \"Video\";\n      break;\n    case /\\.(md)$/.test(path):\n      type = \"Text\";\n      break;\n    default:\n      type = \"Unknown\";\n      break;\n  }\n  return { type, path };\n}\n\nexport function typeForPath(path) {\n  let type;\n  path = path.trim();\n  switch (true) {\n    case /\\.((png)|(jpg)|(jpeg))$/.test(path):\n      type = \"Image\";\n      break;\n    case /\\.(mp4)$/.test(path):\n      type = \"Video\";\n      break;\n    case /\\.(md)$/.test(path):\n      type = \"Text\";\n      break;\n    case /\\.(pdf)$/.test(path):\n      type = \"Document\";\n      break;\n    case /.+(twitter\\.com).+/.test(path):\n      type = \"Tweet\";\n      break;\n    case /.+(t\\.me).+/.test(path):\n      type = \"Telegram\";\n      break;\n\n    default:\n      type = \"Unknown\";\n      break;\n  }\n  return type;\n}\n\nexport function selectTypeFromPathWithPoster(path, poster) {\n  return { type: typeForPath(path), path, poster };\n}\n\nexport function isIdentical(obj1, obj2) {\n  return hash(obj1) === hash(obj2);\n}\n\nexport function calcOpacity(num) {\n  /* Events have opacity 0.5 by default, and get added to according to how many\n   * other events there are in the same render. The idea here is that the\n   * overlaying of events builds up a 'heat map' of the event space, where\n   * darker areas represent more events with proportion */\n  const base = num >= 1 ? 0.9 : 0;\n  return base + Math.min(0.5, 0.08 * (num - 1));\n}\n\nexport function calcClusterOpacity(pointCount, totalPoints) {\n  /* Clusters represent multiple events within a specific radius. The darker the cluster,\n  the larger the number of underlying events. We use a multiplication factor (50) here as well\n  to ensure that the larger clusters have an appropriately darker shading. */\n  return Math.min(0.85, 0.08 + (pointCount / totalPoints) * 50);\n}\n\nexport function calcClusterSize(pointCount, totalPoints) {\n  /* The larger the cluster size, the higher the count of points that the cluster represents.\n  Just like with opacity, we use a multiplication factor to ensure that clusters with higher point\n  counts appear larger. */\n  //TO-DO: Convert maxSize into a config var\n  const maxSize = totalPoints > 60 ? 60 : 35;\n  return Math.min(maxSize, 10 + (pointCount / totalPoints) * 100);\n}\n\nexport function calculateTotalClusterPoints(clusters) {\n  return clusters.reduce((total, cl) => {\n    if (cl && cl.properties && cl.properties.cluster) {\n      total += cl.properties.point_count;\n    }\n    return total;\n  }, 0);\n}\n\nexport function isLatitude(lat) {\n  return !!lat && isFinite(lat) && Math.abs(lat) <= 90;\n}\n\nexport function isLongitude(lng) {\n  return !!lng && isFinite(lng) && Math.abs(lng) <= 180;\n}\n\nexport function mapClustersToLocations(clusters, locations) {\n  return clusters.reduce((acc, cl) => {\n    const foundLocation = locations.find(\n      (location) => location.label === cl.properties.id\n    );\n    if (foundLocation) acc.push(foundLocation);\n    return acc;\n  }, []);\n}\n\n/**\n * Loops through a set of either locations or events\n * and calculates the proportionate percentage of every given association in relation to the coloring set\n */\nexport function calculateColorPercentages(set, coloringSet) {\n  if (coloringSet.length === 0) return [1];\n  const associationMap = {};\n\n  for (const [idx, value] of coloringSet.entries()) {\n    for (const filter of value) {\n      associationMap[filter] = idx;\n    }\n  }\n\n  const associationCounts = new Array(coloringSet.length);\n  associationCounts.fill(0);\n\n  let totalAssociations = 0;\n\n  set.forEach((item) => {\n    let innerSet = \"events\" in item ? item.events : item;\n\n    if (!Array.isArray(innerSet)) innerSet = [innerSet];\n\n    innerSet.forEach((val) => {\n      val.associations.forEach((a) => {\n        const idx = associationMap[createFilterPathString(a)];\n        if (!idx && idx !== 0) return;\n        associationCounts[idx] += 1;\n        totalAssociations += 1;\n      });\n    });\n  });\n\n  if (totalAssociations === 0) return [1];\n\n  return associationCounts.map((count) => count / totalAssociations);\n}\n\n/**\n * Gets the idx of a given filter in relation to its position in the coloring set\n *\n * Example coloringSet = [['Chemical', 'Tear Gas'], ['Procedural', 'Destruction of property']]\n */\nexport function getFilterIdxFromColorSet(filter, coloringSet) {\n  let filterIdx = -1;\n  coloringSet.map((set, idx) => {\n    const foundIdx = set.indexOf(filter);\n    if (foundIdx !== -1) filterIdx = idx;\n    return null;\n  });\n  return filterIdx;\n}\n\nexport const dateMin = function () {\n  return Array.prototype.slice.call(arguments).reduce(function (a, b) {\n    return a < b ? a : b;\n  });\n};\n\nexport const dateMax = function () {\n  return Array.prototype.slice.call(arguments).reduce(function (a, b) {\n    return a > b ? a : b;\n  });\n};\n\n/** Taken from\n * https://stackoverflow.com/questions/22697936/binary-search-in-javascript\n * **/\nexport function binarySearch(ar, el, compareFn) {\n  let m = 0;\n  let n = ar.length - 1;\n  while (m <= n) {\n    const k = (n + m) >> 1;\n    const cmp = compareFn(el, ar[k]);\n    if (cmp > 0) {\n      m = k + 1;\n    } else if (cmp < 0) {\n      n = k - 1;\n    } else {\n      return k;\n    }\n  }\n  return -m - 1;\n}\n\nexport function makeNiceDate(datetime) {\n  if (datetime === null) return null;\n  // see https://stackoverflow.com/questions/3552461/how-to-format-a-javascript-date\n  const dateTimeFormat = new Intl.DateTimeFormat(language, {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"2-digit\",\n  });\n  const [{ value: month }, , { value: day }, , { value: year }] =\n    dateTimeFormat.formatToParts(datetime);\n\n  return `${day} ${month}, ${year}`;\n}\n\n/**\n * Sets the default locale for d3 to format dates in each available language.\n */\nexport function setD3Locale() {\n  const languages = {\n    \"es-MX\": require(\"./data/es-MX.json\"),\n  };\n\n  if (language !== \"es-US\" && languages[language]) {\n    timeFormatDefaultLocale(languages[language]);\n  }\n}\n\n/**\n * Gets the set of associated styles for a given shape type from the entire set of shapes\n * @param list shapes - The aggregated set of shapes\n * @param list activeShapes - The set of active shapes in the app\n */\nexport function mapStyleByShape(shapes, activeShapes) {\n  const styledShapes = shapes.map((s) => {\n    const { colour, shape, id } = s;\n    const style = {\n      checkboxStyles: {\n        background: activeShapes.includes(id) ? colour : \"black\",\n        border: \"none\",\n        clipPath: POLYGON_CLIP_PATH[shape],\n      },\n      containerStyles: {\n        background: colour,\n        clipPath: POLYGON_CLIP_PATH[shape],\n      },\n    };\n    s.styles = style;\n    return s;\n  });\n  return styledShapes;\n}\n\nexport function mapCategoriesToPaths(categories, panelCategories) {\n  const mappedCats = categories.reduce((acc, cat) => {\n    const type = cat.filter_paths[0];\n    if (!(type in acc)) {\n      acc[type] = [];\n    }\n    acc[type].push(cat);\n    return acc;\n  }, {});\n\n  const categoryMap =\n    panelCategories.length > 1 ? mappedCats : { default: categories };\n  return categoryMap;\n}\n\nexport function getCategoryIdxs(panelCategories, startingIdx) {\n  let idxCounter = startingIdx;\n  // If there are specified categories from the config, filter out the default value; else, leave the default value\n  const catTypes =\n    panelCategories.length > 1\n      ? panelCategories.filter((val) => val !== \"default\")\n      : panelCategories;\n  return catTypes.reduce((set, val) => {\n    set[val] = idxCounter;\n    idxCounter += 1;\n    return set;\n  }, {});\n}\n\nexport function getFilterIdx(\n  narrativesExist,\n  categoriesExist,\n  numCategoryPanels\n) {\n  if (narrativesExist && !categoriesExist) return 1;\n  else if (!narrativesExist && categoriesExist) return numCategoryPanels;\n  else if (narrativesExist && categoriesExist) return numCategoryPanels + 1;\n  else return 0;\n}\n\nexport const isEmptyString = (s) => s.length === 0;\n\nexport const isOdd = (num) => num % 2 !== 0;\n\nexport function isEmptyObject(o) {\n  return o == null || (typeof o === \"object\" && !Object.keys(o).length);\n}\n","import { urlFromEnv } from \"../common/utilities\";\n\n// TODO: relegate these URLs entirely to environment variables\n// const CONFIG_URL = urlFromEnv('CONFIG_EXT')\nconst EVENT_DATA_URL = urlFromEnv(\"EVENTS_EXT\");\nconst ASSOCIATIONS_URL = urlFromEnv(\"ASSOCIATIONS_EXT\");\nconst SOURCES_URL = urlFromEnv(\"SOURCES_EXT\");\nconst SITES_URL = urlFromEnv(\"SITES_EXT\");\nconst REGIONS_URL = urlFromEnv(\"REGIONS_EXT\");\nconst SHAPES_URL = urlFromEnv(\"SHAPES_EXT\");\n\nconst domainMsg = (domainType) =>\n  `Something went wrong fetching ${domainType}. Check the URL or try disabling them in the config file.`;\n\nexport function fetchDomain() {\n  const notifications = [];\n\n  function handleError(message) {\n    notifications.push({\n      message,\n      type: \"error\",\n    });\n    return [];\n  }\n\n  return (dispatch, getState) => {\n    const features = getState().features;\n    dispatch(toggleFetchingDomain());\n\n    // let configPromise = Promise.resolve([])\n    // if (features.USE_REMOTE_CONFIG) {\n    //   configPromise = fetch(CONFIG_URL)\n    //     .then(response => response.json())\n    //     .catch(() => handleError(\"Couldn't find data at the config URL you specified.\"))\n    // }\n\n    // NB: EVENT_DATA_URL is a list, and so results are aggregated\n    const eventPromise = Promise.all(\n      EVENT_DATA_URL.map((url) =>\n        fetch(url)\n          .then((response) => response.json())\n          .catch(() => handleError(\"events\"))\n      )\n    ).then((results) => results.flatMap((t) => t));\n\n    let associationsPromise = Promise.resolve([]);\n    if (features.USE_ASSOCIATIONS) {\n      if (!ASSOCIATIONS_URL) {\n        associationsPromise = Promise.resolve(\n          handleError(\n            \"USE_ASSOCIATIONS is true, but you have not provided a ASSOCIATIONS_EXT\"\n          )\n        );\n      } else {\n        associationsPromise = fetch(ASSOCIATIONS_URL)\n          .then((response) => response.json())\n          .catch(() => handleError(domainMsg(\"associations\")));\n      }\n    }\n\n    let sourcesPromise = Promise.resolve([]);\n    if (features.USE_SOURCES) {\n      if (!SOURCES_URL) {\n        sourcesPromise = Promise.resolve(\n          handleError(\n            \"USE_SOURCES is true, but you have not provided a SOURCES_EXT\"\n          )\n        );\n      } else {\n        sourcesPromise = fetch(SOURCES_URL)\n          .then((response) => response.json())\n          .catch(() => handleError(domainMsg(\"sources\")));\n      }\n    }\n\n    let sitesPromise = Promise.resolve([]);\n    if (features.USE_SITES) {\n      sitesPromise = fetch(SITES_URL)\n        .then((response) => response.json())\n        .catch(() => handleError(domainMsg(\"sites\")));\n    }\n\n    let regionsPromise = Promise.resolve([]);\n    if (features.USE_REGIONS) {\n      regionsPromise = fetch(REGIONS_URL)\n        .then((response) => response.json())\n        .catch(() => handleError(domainMsg(\"regions\")));\n    }\n\n    let shapesPromise = Promise.resolve([]);\n    if (features.USE_SHAPES) {\n      shapesPromise = fetch(SHAPES_URL)\n        .then((response) => response.json())\n        .catch(() => handleError(domainMsg(\"shapes\")));\n    }\n\n    return Promise.all([\n      eventPromise,\n      associationsPromise,\n      sourcesPromise,\n      sitesPromise,\n      regionsPromise,\n      shapesPromise,\n    ])\n      .then((response) => {\n        const result = {\n          events: response[0],\n          associations: response[1],\n          sources: response[2],\n          sites: response[3],\n          regions: response[4],\n          shapes: response[5],\n          notifications,\n        };\n        if (\n          Object.values(result).some((resp) => resp.hasOwnProperty(\"error\"))\n        ) {\n          throw new Error(\n            \"Some URLs returned negative. If you are in development, check the server is running\"\n          );\n        }\n        dispatch(toggleFetchingDomain());\n        dispatch(setInitialCategories(result.associations));\n        dispatch(setInitialShapes(result.shapes));\n        return result;\n      })\n      .catch((err) => {\n        dispatch(fetchError(err.message));\n        dispatch(toggleFetchingDomain());\n        // TODO: handle this appropriately in React hierarchy\n        alert(err.message);\n      });\n  };\n}\n\nexport const FETCH_ERROR = \"FETCH_ERROR\";\nexport function fetchError(message) {\n  return {\n    type: FETCH_ERROR,\n    message,\n  };\n}\n\nexport const UPDATE_DOMAIN = \"UPDATE_DOMAIN\";\nexport function updateDomain(payload) {\n  return {\n    type: UPDATE_DOMAIN,\n    payload,\n  };\n}\n\nexport function fetchSource(source) {\n  return (dispatch) => {\n    if (!SOURCES_URL) {\n      dispatch(fetchSourceError(\"No source extension specified.\"));\n    } else {\n      dispatch(toggleFetchingSources());\n\n      fetch(`${SOURCES_URL}`)\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error(\n              \"No sources are available at the URL specified in the config specified.\"\n            );\n          } else {\n            return response.json();\n          }\n        })\n        .catch((err) => {\n          dispatch(fetchSourceError(err.message));\n          dispatch(toggleFetchingSources());\n        });\n    }\n  };\n}\n\nexport const UPDATE_HIGHLIGHTED = \"UPDATE_HIGHLIGHTED\";\nexport function updateHighlighted(highlighted) {\n  return {\n    type: UPDATE_HIGHLIGHTED,\n    highlighted: highlighted,\n  };\n}\n\nexport const UPDATE_SELECTED = \"UPDATE_SELECTED\";\nexport function updateSelected(selected) {\n  return {\n    type: UPDATE_SELECTED,\n    selected: selected,\n  };\n}\n\nexport const UPDATE_DISTRICT = \"UPDATE_DISTRICT\";\nexport function updateDistrict(district) {\n  return {\n    type: UPDATE_DISTRICT,\n    district,\n  };\n}\n\nexport const CLEAR_FILTER = \"CLEAR_FILTER\";\nexport function clearFilter(filter) {\n  return {\n    type: CLEAR_FILTER,\n    filter,\n  };\n}\n\nexport const TOGGLE_ASSOCIATIONS = \"TOGGLE_ASSOCIATIONS\";\nexport function toggleAssociations(association, value, shouldColor) {\n  return {\n    type: TOGGLE_ASSOCIATIONS,\n    association,\n    value,\n    shouldColor,\n  };\n}\n\nexport const TOGGLE_SHAPES = \"TOGGLE_SHAPES\";\nexport function toggleShapes(shape) {\n  return {\n    type: TOGGLE_SHAPES,\n    shape,\n  };\n}\n\nexport const SET_LOADING = \"SET_LOADING\";\nexport function setLoading() {\n  return {\n    type: SET_LOADING,\n  };\n}\n\nexport const SET_NOT_LOADING = \"SET_NOT_LOADING\";\nexport function setNotLoading() {\n  return {\n    type: SET_NOT_LOADING,\n  };\n}\n\nexport const SET_INITIAL_CATEGORIES = \"SET_INITIAL_CATEGORIES\";\nexport function setInitialCategories(values) {\n  return {\n    type: SET_INITIAL_CATEGORIES,\n    values,\n  };\n}\n\nexport const SET_INITIAL_SHAPES = \"SET_INITIAL_SHAPES\";\nexport function setInitialShapes(values) {\n  return {\n    type: SET_INITIAL_SHAPES,\n    values,\n  };\n}\n\nexport const UPDATE_TIMERANGE = \"UPDATE_TIMERANGE\";\nexport function updateTimeRange(timerange) {\n  return {\n    type: UPDATE_TIMERANGE,\n    timerange,\n  };\n}\n\nexport const UPDATE_DIMENSIONS = \"UPDATE_DIMENSIONS\";\nexport function updateDimensions(dims) {\n  return {\n    type: UPDATE_DIMENSIONS,\n    dims,\n  };\n}\n\nexport const UPDATE_NARRATIVE = \"UPDATE_NARRATIVE\";\nexport function updateNarrative(narrative) {\n  return {\n    type: UPDATE_NARRATIVE,\n    narrative,\n  };\n}\n\nexport const UPDATE_NARRATIVE_STEP_IDX = \"UPDATE_NARRATIVE_STEP_IDX\";\nexport function updateNarrativeStepIdx(idx) {\n  return {\n    type: UPDATE_NARRATIVE_STEP_IDX,\n    idx,\n  };\n}\n\nexport const UPDATE_SOURCE = \"UPDATE_SOURCE\";\nexport function updateSource(source) {\n  return {\n    type: UPDATE_SOURCE,\n    source,\n  };\n}\n\nexport const UPDATE_COLORING_SET = \"UPDATE_COLORING_SET\";\nexport function updateColoringSet(coloringSet) {\n  return {\n    type: UPDATE_COLORING_SET,\n    coloringSet,\n  };\n}\n\nexport const UPDATE_TICKS = \"UPDATE_TICKS\";\nexport function updateTicks(ticks) {\n  return {\n    type: UPDATE_TICKS,\n    ticks,\n  };\n}\n\n// UI\n\nexport const TOGGLE_SITES = \"TOGGLE_SITES\";\nexport function toggleSites() {\n  return {\n    type: TOGGLE_SITES,\n  };\n}\n\nexport const TOGGLE_FETCHING_DOMAIN = \"TOGGLE_FETCHING_DOMAIN\";\nexport function toggleFetchingDomain() {\n  return {\n    type: TOGGLE_FETCHING_DOMAIN,\n  };\n}\n\nexport const TOGGLE_FETCHING_SOURCES = \"TOGGLE_FETCHING_SOURCES\";\nexport function toggleFetchingSources() {\n  return {\n    type: TOGGLE_FETCHING_SOURCES,\n  };\n}\n\nexport const TOGGLE_LANGUAGE = \"TOGGLE_LANGUAGE\";\nexport function toggleLanguage(language) {\n  return {\n    type: TOGGLE_LANGUAGE,\n    language,\n  };\n}\n\nexport const CLOSE_TOOLBAR = \"CLOSE_TOOLBAR\";\nexport function closeToolbar() {\n  return {\n    type: CLOSE_TOOLBAR,\n  };\n}\n\nexport const TOGGLE_INFOPOPUP = \"TOGGLE_INFOPOPUP\";\nexport function toggleInfoPopup() {\n  return {\n    type: TOGGLE_INFOPOPUP,\n  };\n}\n\nexport const TOGGLE_INTROPOPUP = \"TOGGLE_INTROPOPUP\";\nexport function toggleIntroPopup() {\n  return {\n    type: TOGGLE_INTROPOPUP,\n  };\n}\n\nexport const TOGGLE_NOTIFICATIONS = \"TOGGLE_NOTIFICATIONS\";\nexport function toggleNotifications() {\n  return {\n    type: TOGGLE_NOTIFICATIONS,\n  };\n}\n\nexport const MARK_NOTIFICATIONS_READ = \"MARK_NOTIFICATIONS_READ\";\nexport function markNotificationsRead() {\n  return {\n    type: MARK_NOTIFICATIONS_READ,\n  };\n}\n\nexport const TOGGLE_COVER = \"TOGGLE_COVER\";\nexport function toggleCover() {\n  return {\n    type: TOGGLE_COVER,\n  };\n}\n\nexport const UPDATE_SEARCH_QUERY = \"UPDATE_SEARCH_QUERY\";\nexport function updateSearchQuery(searchQuery) {\n  return {\n    type: UPDATE_SEARCH_QUERY,\n    searchQuery,\n  };\n}\n\n// ERRORS\n\nexport const FETCH_SOURCE_ERROR = \"FETCH_SOURCE_ERROR\";\nexport function fetchSourceError(msg) {\n  return {\n    type: FETCH_SOURCE_ERROR,\n    msg,\n  };\n}\n\nexport const TOGGLE_SATELLITE_VIEW = \"TOGGLE_SATELLITE_VIEW\";\nexport function toggleSatelliteView() {\n  return {\n    type: TOGGLE_SATELLITE_VIEW,\n  };\n}\n\nexport const REHYDRATE_STATE = \"REHYDRATE_STATE\";\nexport function rehydrateState() {\n  return {\n    type: REHYDRATE_STATE,\n  };\n}\n","import { createSelector } from \"reselect\";\nimport {\n  insetSourceFrom,\n  dateMin,\n  dateMax,\n  isLatitude,\n  isLongitude,\n  createFilterPathString,\n} from \"../common/utilities\";\nimport { isTimeRangedIn } from \"./helpers\";\nimport { ASSOCIATION_MODES, SHAPE } from \"../common/constants\";\n\n// Input selectors\nexport const getEvents = (state) => state.domain.events;\nexport const getCategories = (state) =>\n  state.domain.associations.filter(\n    (item) => item.mode === ASSOCIATION_MODES.CATEGORY\n  );\nexport const getNarratives = (state) =>\n  state.domain.associations.filter(\n    (item) => item.mode === ASSOCIATION_MODES.NARRATIVE\n  );\nexport const getActiveNarrative = (state) => state.app.associations.narrative;\nexport const getSelected = (state) => state.app.selected;\nexport const getSites = (state) => state.domain.sites;\nexport const getSources = (state) => state.domain.sources;\nexport const getRegions = (state) => state.domain.regions;\nexport const getShapes = (state) => state.domain.shapes;\nexport const getFilters = (state) =>\n  state.domain.associations.filter(\n    (item) => item.mode === ASSOCIATION_MODES.FILTER\n  );\nexport const getNotifications = (state) => state.domain.notifications;\nexport const getActiveFilters = (state) => state.app.associations.filters;\nexport const getActiveCategories = (state) => state.app.associations.categories;\nexport const getActiveShapes = (state) => state.app.shapes;\nexport const getColoringSet = (state) => state.app.associations.coloringSet;\nexport const getTimeRange = (state) => state.app.timeline.range;\nexport const getTimelineDimensions = (state) => state.app.timeline.dimensions;\nexport const selectNarrative = (state) => state.app.associations.narrative;\nexport const getFeatures = (state) => state.features;\nexport const getEventRadius = (state) => state.ui.eventRadius;\nexport const getTiles = (state) => state.ui.tiles.current;\n\nexport const selectSites = createSelector(\n  [getSites, getFeatures],\n  (sites, features) => {\n    if (features.USE_SITES) {\n      return sites.filter((s) => !!+s.enabled);\n    }\n    return [];\n  }\n);\n\nexport const selectSources = createSelector(\n  [getSources, getFeatures],\n  (sources, features) => {\n    if (features.USE_SOURCES) return sources;\n    return {};\n  }\n);\n\nexport const selectRegions = createSelector(\n  [getRegions, getFeatures],\n  (regions, features) => {\n    if (features.USE_REGIONS) return regions;\n    return [];\n  }\n);\n\n/**\n * Of all available events, selects those that\n * 1. fall in time range\n * 2. exist in an active filter\n * 3. exist in an active category\n */\nexport const selectEvents = createSelector(\n  [\n    getEvents,\n    getActiveFilters,\n    getActiveCategories,\n    getActiveShapes,\n    getTimeRange,\n    getFeatures,\n  ],\n  (\n    events,\n    activeFilters,\n    activeCategories,\n    activeShapes,\n    timeRange,\n    features\n  ) => {\n    return events.reduce((acc, event) => {\n      const isMatchingFilter =\n        (event.associations &&\n          event.associations\n            .filter((a) => a.mode === ASSOCIATION_MODES.FILTER)\n            .map((association) =>\n              activeFilters.includes(createFilterPathString(association))\n            )\n            .some((s) => s)) ||\n        activeFilters.length === 0;\n      const isActiveFilter = isMatchingFilter || activeFilters.length === 0;\n      const isActiveCategory =\n        (event.associations &&\n          event.associations\n            .filter((a) => a.mode === ASSOCIATION_MODES.CATEGORY)\n            .map((association) => activeCategories.includes(association.title))\n            .some((s) => s)) ||\n        activeCategories.length === 0;\n      let isActiveTime = isTimeRangedIn(event, timeRange);\n      isActiveTime = features.GRAPH_NONLOCATED\n        ? (!event.latitude && !event.longitude) || isActiveTime\n        : isActiveTime;\n      const isActiveShape =\n        event.shape && activeShapes.includes(event.shape.id);\n      if (event.type === SHAPE) {\n        if (isActiveShape && isActiveCategory && isActiveTime) {\n          acc[event.id] = { ...event };\n        }\n      } else {\n        if (isActiveFilter && isActiveCategory && isActiveTime) {\n          acc[event.id] = { ...event };\n        }\n      }\n      return acc;\n    }, []);\n  }\n);\n\n/**\n * Of all available events, select only those that fall within the currently selected time range and have a location attached.\n * Since `events` is a sparse array, we need to reduce the array in order to count.\n */\nexport const selectEventCountInTimeRange = createSelector(\n  [selectEvents],\n  (events, timeRange) =>\n    events.reduce(\n      (acc, curr) => (curr.latitude && curr.longitude ? acc + 1 : acc),\n      0\n    )\n);\n\n/**\n * Of all available events, selects those that fall within the time range,\n * and if filters are being used, select them if their filters are enabled\n */\nexport const selectNarratives = createSelector(\n  [getEvents, getNarratives, getSources, getFeatures],\n  (events, narrativesMeta, sources, features) => {\n    if (Array.isArray(narrativesMeta) && narrativesMeta.length === 0) {\n      return [];\n    }\n    const narratives = {};\n    const narrativeSkeleton = (id) => ({ id, steps: [] });\n\n    /* populate narratives dict with events */\n    events.forEach((evt) => {\n      evt.associations.forEach((association) => {\n        const foundNarrative = narrativesMeta.find(\n          (narr) => narr.id === association\n        );\n        if (foundNarrative) {\n          const { id: narrId } = foundNarrative;\n          // initialise\n          if (!narratives[narrId]) {\n            narratives[narrId] = narrativeSkeleton(narrId);\n          }\n          // add evt to steps\n          // NB: insetSourceFrom is a 'curried' function to allow with maps\n          narratives[narrId].steps.push(insetSourceFrom(sources)(evt));\n        }\n      });\n    });\n    /* sort steps by time */\n    Object.keys(narratives).forEach((key) => {\n      const steps = narratives[key].steps;\n\n      steps.sort((a, b) => a.datetime - b.datetime);\n\n      const existingAssociatedNarrative = narrativesMeta.find(\n        (n) => n.id === key\n      );\n\n      if (existingAssociatedNarrative) {\n        narratives[key] = {\n          ...existingAssociatedNarrative,\n          ...narratives[key],\n        };\n      }\n    });\n    // Return narratives in original order\n    // + filter those that are undefined\n    return narrativesMeta.map((n) => narratives[n.id]).filter((d) => d);\n  }\n);\n\n/** We iterate through narrative.steps and check the idx there against the selected array and we return the idx */\nexport const selectNarrativeIdx = createSelector(\n  [getSelected, getActiveNarrative],\n  (selected, narrative) => {\n    // Only one event selected in narrative mode\n    if (narrative === null) return -1;\n\n    const selectedEvent = selected[0];\n    let selectedIdx;\n\n    narrative.steps.forEach((step, idx) => {\n      if (selectedEvent.id === step.id) {\n        selectedIdx = idx;\n      }\n    });\n    return selectedIdx;\n  }\n);\n\n/** Aggregate information about the narrative and the current step into\n *  a single object. If narrative is null, the whole object is null.\n */\nexport const selectActiveNarrative = createSelector(\n  [getActiveNarrative, selectNarrativeIdx],\n  (narrative, current) => (narrative ? { ...narrative, current } : null)\n);\n\n/**\n * Group events by location. Each location is an object:\n  {\n    events: [...],\n    label: 'Location name',\n    latitude: '47.7',\n    longitude: '32.2'\n  }\n */\nexport const selectLocations = createSelector([selectEvents], (events) => {\n  const activeLocations = {};\n  events.forEach((event) => {\n    const { latitude, longitude } = event;\n    if (!isLatitude(latitude) || !isLongitude(longitude)) return;\n\n    const location = `${event.location}$_${event.latitude}_${event.longitude}`;\n\n    if (activeLocations[location]) {\n      activeLocations[location].events.push(event);\n    } else {\n      activeLocations[location] = {\n        label: location,\n        events: [event],\n        id: event.id,\n        latitude: event.latitude,\n        longitude: event.longitude,\n      };\n    }\n  });\n\n  return Object.values(activeLocations);\n});\n\nexport const selectEventsWithProjects = createSelector(\n  [selectEvents, getFeatures, getEventRadius],\n  (events, features, eventRadius) => {\n    if (!features.GRAPH_NONLOCATED) {\n      return [events, []];\n    }\n    const projSize = 2 * eventRadius;\n    const projectIdx = features.GRAPH_NONLOCATED.projectIdx || 0;\n    const getProject = (ev) => ev.filters[projectIdx];\n    const projects = {};\n\n    // get all projects\n    events = events.reduce((acc, event) => {\n      const project =\n        event.filters.length >= 1 && !event.latitude && !event.longitude\n          ? getProject(event)\n          : null;\n\n      // add project if it doesn't exist\n      if (project !== null) {\n        if (projects.hasOwnProperty(project)) {\n          projects[project].start = dateMin(\n            projects[project].start,\n            event.datetime\n          );\n          projects[project].end = dateMax(\n            projects[project].end,\n            event.datetime\n          );\n        } else {\n          projects[project] = {\n            start: event.datetime,\n            end: event.datetime,\n            key: project,\n            category: event.category,\n          };\n        }\n      }\n      acc.push({ ...event, project });\n      return acc;\n    }, []);\n\n    const projObjs = Object.values(projects);\n    projObjs.sort((a, b) => a.start - b.start);\n\n    // active projects is a data structure with projObjs.length empty slots\n    const activeProjs = Object.keys(projects).map((_, idx) => null);\n\n    const projectsWithOffset = projObjs.reduce((acc, proj, theIdx) => {\n      // remove any project that have ended from slots\n      activeProjs.forEach((theProj, theProjIdx) => {\n        if (theProj !== null) {\n          const projInSlot = projects[theProj];\n          if (projInSlot.end < proj.start) {\n            activeProjs[theProjIdx] = null;\n          }\n        }\n      });\n      let i = 0;\n      // find the first empty slot\n      while (activeProjs[i]) i++;\n      // put proj in slot\n      activeProjs[i] = proj.key;\n\n      proj.offset = i * projSize;\n      acc[proj.key] = proj;\n      return acc;\n    }, {});\n\n    return [events, projectsWithOffset];\n  }\n);\n\nexport const selectStackedEvents = createSelector(\n  [selectEventsWithProjects],\n  (eventsWithProjects) => {\n    return eventsWithProjects[0];\n  }\n);\n\nexport const selectProjects = createSelector(\n  [selectEventsWithProjects, getFeatures],\n  (eventsWithProjects, features) => {\n    if (!features.GRAPH_NONLOCATED) {\n      return [];\n    }\n    return eventsWithProjects[1];\n  }\n);\n\n/**\n * Of all the sources, select those that are relevant to the selected events.\n */\nexport const selectSelected = createSelector(\n  [getSelected, getSources],\n  (selected, sources) => {\n    if (selected.length === 0) {\n      return [];\n    }\n    return selected.map(insetSourceFrom(sources));\n  }\n);\n\nexport const selectDimensions = createSelector(\n  [getTimelineDimensions],\n  (dimensions) => {\n    return {\n      ...dimensions,\n      trackHeight: dimensions.contentHeight - 50, // height of time labels\n    };\n  }\n);\n\nexport const selectFilterPathToIdMapping = createSelector(\n  [getFilters],\n  (filters) => {\n    return filters.reduce((acc, curr) => {\n      acc[createFilterPathString(curr)] = curr.id;\n      return acc;\n    }, {});\n  }\n);\n\nexport const selectActiveColorSets = createSelector(\n  [getColoringSet, selectFilterPathToIdMapping],\n  (set, mapping) => {\n    return set.map((set) => mapFiltersToIds(set, mapping).join(\",\"));\n  }\n);\n\nexport const selectActiveFilterIds = createSelector(\n  [getActiveFilters, selectFilterPathToIdMapping],\n  (filters, mapping) => {\n    return mapFiltersToIds(filters, mapping);\n  }\n);\n\nfunction mapFiltersToIds(arr, filterMapping) {\n  return arr.reduce((acc, path) => {\n    const id = filterMapping[path];\n    if (id) acc.push(id);\n    return acc;\n  }, []);\n}\n","/**\n * Some handy helpers\n */\n\n/**\n * Given an event and a time range,\n * returns true/false if the event falls within timeRange\n */\nexport function isTimeRangedIn(event, timeRange) {\n  const eventTime = event.datetime;\n  return timeRange[0] < eventTime && eventTime < timeRange[1];\n}\n\n/**\n * Shuffles array in place. ES6 version\n * @param {Array} a items An array containing the items.\n * https://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array\n */\nexport function shuffle(a) {\n  for (let i = a.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [a[i], a[j]] = [a[j], a[i]];\n  }\n  return a;\n}\n","import {\n  TOGGLE_ASSOCIATIONS,\n  UPDATE_COLORING_SET,\n  UPDATE_SELECTED,\n  UPDATE_TIMERANGE,\n} from \"../../../actions\";\nimport { ASSOCIATION_MODES } from \"../../../common/constants\";\nimport { createFilterPathString } from \"../../../common/utilities\";\nimport {\n  getSelected,\n  getTimeRange,\n  selectActiveColorSets,\n  selectActiveFilterIds,\n} from \"../../../selectors\";\n\nexport const SCHEMA_TYPES = {\n  NUMBER: \"NUMBER\",\n  NUMBER_ARRAY: \"NUMBER_ARRAY\",\n  STRING: \"STRING\",\n  STRING_ARRAY: \"STRING_ARRAY\",\n  DATE: \"DATE\",\n  DATE_ARRAY: \"DATE_ARRAY\",\n};\n\nexport function isSchemaArray(schema) {\n  return [\n    SCHEMA_TYPES.DATE_ARRAY,\n    SCHEMA_TYPES.NUMBER_ARRAY,\n    SCHEMA_TYPES.STRING_ARRAY,\n  ].includes(schema.type);\n}\n\n/**\n * Schema specifies how redux state maps to the url and vice versa.\n * `trigger`: action that triggers a call to `dehydrate()`\n * `type`: type of the mapped URL property\n * `dehydrate()`: maps redux state to url state.\n * `rehydrate()`:\n *    maps url state to redux state.\n *    !for performance reasons, this function works with a mutable ref to `state`!\n */\nexport const SCHEMA = Object.freeze({\n  id: {\n    key: \"id\",\n    trigger: UPDATE_SELECTED,\n    type: SCHEMA_TYPES.NUMBER_ARRAY,\n    dehydrate(state) {\n      return getSelected(state).map(({ id }) => id);\n    },\n    // TODO: determine time range if `range` not set.\n    rehydrate(nextState, { id }) {\n      if (id?.length) {\n        nextState.app.selected = id.map((id) =>\n          nextState.domain.events.find((e) => e.id === id)\n        );\n      }\n    },\n  },\n  range: {\n    key: \"range\",\n    trigger: UPDATE_TIMERANGE,\n    type: SCHEMA_TYPES.DATE_ARRAY,\n    dehydrate(state) {\n      return getTimeRange(state);\n    },\n    rehydrate(nextState, { range }) {\n      if (range?.length === 2) {\n        const val = Array.from(range);\n        val.sort((a, b) => new Date(a) - new Date(b));\n        nextState.app.timeline.range = val;\n      }\n    },\n  },\n  filter: {\n    key: \"filter\",\n    trigger: TOGGLE_ASSOCIATIONS,\n    type: SCHEMA_TYPES.STRING_ARRAY,\n    dehydrate(state) {\n      return selectActiveFilterIds(state);\n    },\n    // TODO: set parent filters if all children checked.\n    rehydrate(nextState, { filter }) {\n      if (filter?.length) {\n        const filters = nextState.domain.associations.filter(\n          (x) => x.mode === ASSOCIATION_MODES.FILTER\n        );\n        const filterMapping = mapFilterIdsToPaths(filters);\n        nextState.app.associations.filters = filter.map(\n          (id) => filterMapping[id]\n        );\n      }\n    },\n  },\n  color: {\n    key: \"color\",\n    trigger: UPDATE_COLORING_SET,\n    type: SCHEMA_TYPES.STRING_ARRAY,\n    dehydrate(state) {\n      return selectActiveColorSets(state);\n    },\n    // TODO: color parent if all children checked.\n    rehydrate(state, { color }) {\n      if (color?.length) {\n        const filters = state.domain.associations.filter(\n          (x) => x.mode === ASSOCIATION_MODES.FILTER\n        );\n        const filterMapping = mapFilterIdsToPaths(filters);\n        state.app.associations.coloringSet = color.map((set) =>\n          set.split(\",\").map((id) => filterMapping[id])\n        );\n      }\n    },\n  },\n});\n\nfunction mapFilterIdsToPaths(filters) {\n  return filters.reduce((acc, curr) => {\n    acc[curr.id] = createFilterPathString(curr);\n    return acc;\n  }, {});\n}\n","import dayjs from \"dayjs\";\nimport { isSchemaArray, SCHEMA, SCHEMA_TYPES } from \"./schema\";\n\nexport class URLState {\n  constructor() {\n    this.url = new URL(window.location);\n    this.schema = SCHEMA;\n  }\n\n  delete(key) {\n    this.url.searchParams.delete(key);\n  }\n\n  /**\n   * `key` not declared in `schema` will be ignored.\n   * `value` is encoded according to the schema.\n   * if the schema declares `isArray: true`, `value` is required be an array.\n   */\n  set(key, value) {\n    const schema = this.schema[key];\n    if (!schema) return;\n\n    this.delete(key);\n\n    if (isSchemaArray(schema)) {\n      value.forEach((val) => {\n        const encoded = this._encode(schema, val);\n        if (encoded) this.url.searchParams.append(key, encoded);\n      });\n    } else {\n      const encoded = this._encode(schema, value);\n      if (encoded) this.url.searchParams.set(key, encoded);\n    }\n  }\n\n  serialize() {\n    window.history.replaceState(null, \"\", this.url);\n  }\n\n  /**\n   * Returns URL state as object.\n   * Values are decoded according to schema.\n   */\n  deserialize() {\n    const state = {};\n\n    this.url.searchParams.forEach((_, key) => {\n      if (state[key] != null) return;\n\n      const schema = this.schema[key];\n      // ignore unknown query parameters\n      if (!schema) return;\n\n      state[key] = isSchemaArray(schema)\n        ? this.url.searchParams\n            .getAll(key)\n            .map((val) => this._decode(schema, val))\n        : this._decode(schema, this.url.searchParams.get(key));\n    });\n\n    return state;\n  }\n\n  _decode(schema, value) {\n    switch (schema.type) {\n      case SCHEMA_TYPES.NUMBER_ARRAY:\n      case SCHEMA_TYPES.NUMBER: {\n        return +value;\n      }\n\n      case SCHEMA_TYPES.DATE:\n      case SCHEMA_TYPES.DATE_ARRAY: {\n        return new Date(value);\n      }\n\n      default: {\n        if (value === \"null\" || value === \"undefined\") return undefined;\n        return value;\n      }\n    }\n  }\n\n  _encode(schema, value) {\n    switch (schema.type) {\n      case SCHEMA_TYPES.NUMBER_ARRAY:\n      case SCHEMA_TYPES.NUMBER: {\n        return value.toString();\n      }\n\n      case SCHEMA_TYPES.DATE:\n      case SCHEMA_TYPES.DATE_ARRAY: {\n        return dayjs(value).format(\"YYYY-MM-DD\");\n      }\n\n      default: {\n        return value;\n      }\n    }\n  }\n}\n\nexport default URLState;\n","import { isEmptyObject } from \"../../../common/utilities\";\nimport { SCHEMA } from \"./schema\";\nimport URLState from \"./urlState\";\n\nexport function applyUrlState(state) {\n  const urlState = new URLState().deserialize();\n  if (isEmptyObject(urlState)) return state;\n\n  const nextState = { ...state };\n\n  Object.values(SCHEMA).forEach((s) => {\n    try {\n      s.rehydrate(nextState, urlState);\n    } catch (err) {\n      console.error(err);\n    }\n  });\n\n  return nextState;\n}\n","export const colors = {\n  fa_red: \"#eb443e\",\n  yellow: \"#ffd800\",\n  black: \"#000\",\n  white: \"#fff\",\n};\n\nconst exports = {\n  fallbackEventColor: colors.fa_red,\n  darkBackground: colors.black,\n  primaryHighlight: colors.fa_red,\n  secondaryHighlight: colors.white,\n};\n\nexport default exports;\n","import { mergeDeepLeft } from \"ramda\";\n\nimport global, { colors } from \"../common/global\";\nimport copy from \"../common/data/copy.json\";\nimport { language } from \"../common/utilities\";\nimport { DEFAULT_TAB_ICONS } from \"../common/constants\";\n\nconst isSmallLaptop = window.innerHeight < 800;\nconst mapIniital = {\n  anchor: [8.130912119045295, -66.63830778451526],\n  startZoom: 7,\n  minZoom: 2,\n  maxZoom: 15,\n  bounds: null,\n  maxBounds: [\n    [180, -180],\n    [-180, 180],\n  ],\n};\nconst space3dInitial = {};\n\nconst initial = {\n  /*\n   * The Domain or 'domain' of this state refers to the tree of data\n   *  available for render and display.\n   * Selections and filters in the 'app' subtree will operate the domain\n   *   in mapStateToProps of the Dashboard, and determine which items\n   *   in the domain will get rendered by React\n   */\n  domain: {\n    events: [],\n    categories: [],\n    associations: [],\n    sources: {},\n    sites: [],\n    shapes: [],\n    regions: [],\n    notifications: [],\n  },\n\n  /*\n   * The 'app' subtree of this state determines the data and information to be\n   *   displayed.\n   * It may refer to those the user interacts with, by selecting,\n   *   filtering and so on, which ultimately operate on the data to be displayed.\n   * Additionally, some of the 'app' flags are determined by the config file\n   *   or by the characteristics of the client, browser, etc.\n   */\n  app: {\n    debug: true,\n    errors: {\n      source: false,\n    },\n    highlighted: null,\n    selected: [],\n    source: null,\n    associations: {\n      coloringSet: [],\n      filters: [],\n      narrative: null,\n      categories: [],\n      views: {\n        events: true,\n        routes: false,\n        sites: true,\n      },\n    },\n    shapes: [],\n    isMobile: /Mobi/.test(navigator.userAgent),\n    language: \"en-US\",\n    cluster: {\n      radius: 30,\n      minZoom: 2,\n      maxZoom: 15,\n    },\n    timeline: {\n      dimensions: {\n        ticks: 15,\n        height: isSmallLaptop ? 170 : 250,\n        width: 0,\n        marginLeft: 70,\n        marginTop: isSmallLaptop ? 5 : 10, // the padding used for the day/month labels inside the timeline\n        marginBottom: 60,\n        contentHeight: isSmallLaptop ? 160 : 200,\n        width_controls: 100,\n      },\n      range: [new Date(2024, 6, 20, 12), new Date(2024, 8, 10, 12)],\n      rangeLimits: [new Date(1, 1, 1, 1), new Date()],\n      zoomLevels: copy[language].timeline.zoomLevels || [\n        { label: \"1 month\", duration: 40320 },\n        { label: \"2 weeks\", duration: 20160 },\n        { label: \"1 week\", duration: 10080 },\n      ],\n    },\n    flags: {\n      isFetchingDomain: false,\n      isFetchingSources: false,\n      isCover: true,\n      isCardstack: true,\n      isInfopopup: false,\n      isIntropopup: false,\n      isShowingSites: true,\n    },\n    cover: {\n      title:\n        \"## Election Aftershocks \\n\\n##### Human Rights violations in Venezuela \\n##### 2024\",\n      description:\n        \"This interactive map designed to visualize human rights violations in Venezuela reported in the period following the 2024 presidential election. The information presented is a compilation of posts published on X (formerly Twitter) by internationally recognized human rights organizations in Venezuela with the understanding that many more violations likely remain unreported.\\n\\nThe map provides a clear view of the human rights violations, with the approximate location of where they took place based on the content of the post. This resource was designed by anonymous collaborators and researchers who met online with the intention to focus attention on critical human rights issues in the post-electoral context in Venezuela, drawing awareness to specific incidents and the broader human rights environment.<br><br> \\n\\n##### Contact Information and Acknowledgement \\n\\n##### To contribute to this project you can visit the [GitHub repo](https://forensic-architecture.org/), which was created using the a template from [Forensic Architecture](https://forensic-architecture.org/). For any info please contact us to 2000mamagallina@gmail.com\",\n      exploreButton: \"EXPLORE THE MAP\",\n    },\n    toolbar: {\n      panels: {\n        categories: {\n          default: {\n            icon: DEFAULT_TAB_ICONS.CATEGORY,\n            label: copy[language].toolbar.categories_label,\n            title: copy[language].toolbar.explore_by_category__title,\n            description:\n              copy[language].toolbar.explore_by_category__description,\n          },\n        },\n        filters: {\n          icon: DEFAULT_TAB_ICONS.FILTER,\n          label: copy[language].toolbar.filters_label,\n          title: copy[language].toolbar.explore_by_filter__title,\n          description: copy[language].toolbar.explore_by_filter__description,\n        },\n        narratives: {\n          icon: DEFAULT_TAB_ICONS.NARRATIVE,\n          label: copy[language].toolbar.narratives_label,\n          title: copy[language].toolbar.explore_by_narrative__title,\n          description: copy[language].toolbar.explore_by_narrative__description,\n        },\n        shapes: {\n          icon: DEFAULT_TAB_ICONS.SHAPE,\n          label: copy[language].toolbar.shapes_label,\n          title: copy[language].toolbar.explore_by_shape__title,\n          description: copy[language].toolbar.explore_by_shape__description,\n        },\n      },\n    },\n    loading: false,\n  },\n\n  /*\n   * The 'ui' subtree of this state refers the state of the cosmetic\n   *   elements of the application, such as color palettes of clusters\n   *   as well as dom elements to attach SVG\n   */\n  ui: {\n    tiles: {\n      current: \"openstreetmap\", // ['openstreetmap', 'streets', 'satellite'] (2nd two require a mapbox access token)\n      default: \"openstreetmap\", // ['openstreetmap', 'streets', 'satellite']\n    },\n    style: {\n      categories: {\n        default: global.fallbackEventColor,\n      },\n      narratives: {\n        default: {\n          opacity: 0.9,\n          stroke: global.fallbackEventColor,\n          strokeWidth: 3,\n        },\n      },\n      regions: {\n        default: {\n          stroke: \"blue\",\n          strokeWidth: 3,\n          opacity: 0.9,\n        },\n      },\n      clusters: {\n        radial: false,\n      },\n    },\n    card: {\n      layout: {\n        template: \"basic\",\n      },\n    },\n    coloring: {\n      maxNumOfColors: 4,\n      colors: Object.values(colors),\n    },\n    dom: {\n      timeline: \"timeline\",\n      timeslider: \"timeslider\",\n      map: \"map\",\n    },\n    eventRadius: 8,\n  },\n\n  features: {\n    USE_COVER: true,\n    USE_ASSOCIATIONS: false,\n    USE_SITES: false,\n    USE_SOURCES: false,\n    USE_REGIONS: false,\n    GRAPH_NONLOCATED: false,\n    HIGHLIGHT_GROUPS: false,\n  },\n};\n\nlet appStore;\nif (process.env.store) {\n  appStore = mergeDeepLeft(process.env.store, initial);\n} else {\n  appStore = initial;\n}\n\n// NB: config.js dates get implicitly converted to strings in mergeDeepLeft\nappStore.app.timeline.range[0] = new Date(appStore.app.timeline.range[0]);\nappStore.app.timeline.range[1] = new Date(appStore.app.timeline.range[1]);\nappStore.app.flags.isIntropopup = !!appStore.app.intro;\n\nif (\"map\" in appStore.app) {\n  appStore.app.map = mergeDeepLeft(appStore.app.map, mapIniital);\n}\n\nif (\"space3d\" in appStore.app) {\n  appStore.app.space3d = mergeDeepLeft(appStore.app.space3d, space3dInitial);\n}\n\nexport default appStore;\n","import Joi from \"joi\";\n\nfunction joiFromCustom(custom) {\n  const output = {};\n  custom.forEach((field) => {\n    if (field.kind === \"text\" || field.kind === \"link\") {\n      output[field.key] = Joi.string().allow(\"\");\n    }\n    if (field.kind === \"list\") {\n      output[field.key] = Joi.array().allow(\"\");\n    }\n  });\n  return output;\n}\n\nfunction createEventSchema(custom) {\n  return Joi.object()\n    .keys({\n      id: Joi.string().allow(\"\"),\n      description: Joi.string().allow(\"\").required(),\n      date: Joi.string().allow(\"\"),\n      time: Joi.string().allow(\"\"),\n      time_precision: Joi.string().allow(\"\"),\n\n      /* map */\n      location: Joi.string().allow(\"\"),\n      latitude: Joi.string().allow(\"\"),\n      longitude: Joi.string().allow(\"\"),\n      /* space */\n      x: Joi.string().allow(\"\"),\n      y: Joi.string().allow(\"\"),\n      z: Joi.string().allow(\"\"),\n\n      type: Joi.string().allow(\"\"),\n      category: Joi.string().allow(\"\"),\n      category_full: Joi.string().allow(\"\"),\n      associations: Joi.array().default([]),\n      sources: Joi.array(),\n      comments: Joi.string().allow(\"\"),\n      time_display: Joi.string().allow(\"\"),\n      // nested\n      narrative___stepStyles: Joi.array(),\n      shape: Joi.string().allow(\"\"),\n      colour: Joi.string().allow(\"\"),\n      ...joiFromCustom(custom),\n    })\n    .and(\"latitude\", \"longitude\")\n    .or(\"date\", \"latitude\");\n}\n\nexport default createEventSchema;\n","import Joi from \"joi\";\n\nconst siteSchema = Joi.object().keys({\n  id: Joi.string().required(),\n  description: Joi.string().allow(\"\").required(),\n  site: Joi.string().required(),\n  latitude: Joi.string().required(),\n  longitude: Joi.string().required(),\n  enabled: Joi.string().allow(\"\"),\n});\n\nexport default siteSchema;\n","import Joi from \"joi\";\n\nconst associationsSchema = Joi.object().keys({\n  id: Joi.string().allow(\"\").required(),\n  title: Joi.string().allow(\"\").required(),\n  desc: Joi.string().allow(\"\"),\n  mode: Joi.string().allow(\"\").required(),\n  filter_paths: Joi.array(),\n});\n\nexport default associationsSchema;\n","import Joi from \"joi\";\n\nconst sourceSchema = Joi.object().keys({\n  id: Joi.string().required(),\n  title: Joi.string().allow(\"\"),\n  thumbnail: Joi.string().allow(\"\"),\n  paths: Joi.array().required(),\n  type: Joi.string().allow(\"\"),\n  affil_s: Joi.array().allow(\"\"),\n  url: Joi.string().allow(\"\"),\n  description: Joi.string().allow(\"\"),\n  parent: Joi.string().allow(\"\"),\n  author: Joi.string().allow(\"\"),\n  date: Joi.string().allow(\"\"),\n  notes: Joi.string().allow(\"\"),\n});\n\nexport default sourceSchema;\n","import Joi from \"joi\";\n\nconst regionSchema = Joi.object().keys({\n  name: Joi.string().required(),\n  items: Joi.array().required(),\n});\n\nexport default regionSchema;\n","import Joi from \"joi\";\n\nconst shapeSchema = Joi.object().keys({\n  id: Joi.string().allow(\"\"),\n  title: Joi.string().allow(\"\"),\n  shape: Joi.string().allow(\"\"),\n  colour: Joi.string().allow(\"\"),\n});\n\nexport default shapeSchema;\n","import Joi from \"joi\";\n\nimport createEventSchema from \"./eventSchema\";\nimport siteSchema from \"./siteSchema\";\nimport associationsSchema from \"./associationsSchema\";\nimport sourceSchema from \"./sourceSchema\";\nimport regionSchema from \"./regionSchema\";\nimport shapeSchema from \"./shapeSchema\";\n\nimport { calcDatetime, capitalize } from \"../../common/utilities\";\n\n/*\n * Create an error notification object\n * Types: ['error', 'warning', 'good', 'neural']\n */\nfunction makeError(type, id, message) {\n  return {\n    type: \"error\",\n    id,\n    message: `${type} ${id}: ${message}`,\n  };\n}\n\nfunction isValidDate(d) {\n  return d instanceof Date && !isNaN(d);\n}\n\nfunction findDuplicateAssociations(associations) {\n  const seenSet = new Set([]);\n  const duplicates = [];\n  associations.forEach((item) => {\n    if (seenSet.has(item.id)) {\n      duplicates.push({\n        id: item.id,\n        error: makeError(\n          \"Association\",\n          item.id,\n          \"association was found more than once. Ignoring duplicate.\"\n        ),\n      });\n    } else {\n      seenSet.add(item.id);\n    }\n  });\n  return duplicates;\n}\n\n/*\n * Validate domain schema\n */\nexport function validateDomain(domain, features) {\n  const sanitizedDomain = {\n    events: [],\n    sites: [],\n    associations: [],\n    sources: {},\n    regions: [],\n    shapes: [],\n    notifications: domain ? domain.notifications : null,\n  };\n\n  if (domain === undefined) {\n    return sanitizedDomain;\n  }\n\n  const discardedDomain = {\n    events: [],\n    sites: [],\n    associations: [],\n    sources: [],\n    regions: [],\n    shapes: [],\n  };\n\n  function validateArrayItem(item, domainKey, schema) {\n    const result = Joi.validate(item, schema);\n    if (result.error !== null) {\n      const id = item.id || \"-\";\n      const domainStr = capitalize(domainKey);\n      const error = makeError(domainStr, id, result.error.message);\n\n      discardedDomain[domainKey].push(Object.assign(item, { error }));\n    } else {\n      sanitizedDomain[domainKey].push(item);\n    }\n  }\n\n  function validateArray(items, domainKey, schema) {\n    items.forEach((item) => {\n      if (domainKey === \"events\" && item.date === \"\" && item.time === \"\")\n        return;\n      validateArrayItem(item, domainKey, schema);\n    });\n  }\n\n  function validateObject(obj, domainKey, itemSchema) {\n    Object.keys(obj).forEach((key) => {\n      if (key === \"\") return;\n      const vl = obj[key];\n      const result = Joi.validate(vl, itemSchema);\n      if (result.error !== null) {\n        const id = vl.id || \"-\";\n        const domainStr = capitalize(domainKey);\n        discardedDomain[domainKey].push({\n          ...vl,\n          error: makeError(domainStr, id, result.error.message),\n        });\n      } else {\n        sanitizedDomain[domainKey][key] = vl;\n      }\n    });\n  }\n\n  if (!Array.isArray(features.CUSTOM_EVENT_FIELDS)) {\n    features.CUSTOM_EVENT_FIELDS = [];\n  }\n\n  const eventSchema = createEventSchema(features.CUSTOM_EVENT_FIELDS);\n  validateArray(domain.events, \"events\", eventSchema);\n  validateArray(domain.sites, \"sites\", siteSchema);\n  validateArray(domain.associations, \"associations\", associationsSchema);\n  validateObject(domain.sources, \"sources\", sourceSchema);\n  validateArray(domain.regions, \"regions\", regionSchema);\n  validateArray(domain.shapes, \"shapes\", shapeSchema);\n\n  // NB: [lat, lon] array is best format for projecting into map\n  sanitizedDomain.regions = sanitizedDomain.regions.map((region) => ({\n    name: region.name,\n    points: region.items.map((coords) => coords.replace(/\\s/g, \"\").split(\",\")),\n  }));\n\n  sanitizedDomain.shapes = sanitizedDomain.shapes.reduce((acc, val) => {\n    if (!val.shape) {\n      discardedDomain.shapes.push({\n        ...val,\n        error: makeError(\n          \"events\",\n          val.id,\n          \"Invalid event shape. Please specify a shape for this type of event.\"\n        ),\n      });\n    } else {\n      acc.push(val);\n    }\n    return acc;\n  }, []);\n\n  const duplicateAssociations = findDuplicateAssociations(domain.associations);\n  // Duplicated associations\n  if (duplicateAssociations.length > 0) {\n    sanitizedDomain.notifications.push({\n      message:\n        \"Associations are required to be unique. Ignoring duplicates for now.\",\n      items: duplicateAssociations,\n      type: \"error\",\n    });\n  }\n  sanitizedDomain.associations = domain.associations;\n\n  // append events with datetime and sort\n  sanitizedDomain.events = sanitizedDomain.events.filter((event, idx) => {\n    let errorMsg = \"\";\n    event.id = idx;\n    // event.associations comes in as a [association.ids...]; convert to actual association objects\n    event.associations = event.associations.reduce((acc, id) => {\n      const foundAssociation = sanitizedDomain.associations.find(\n        (elem) => elem.id === id\n      );\n      if (foundAssociation) acc.push(foundAssociation);\n      return acc;\n    }, []);\n\n    if (event.shape) {\n      const relatedShapeObj = sanitizedDomain.shapes.find(\n        (elem) => elem.id === event.shape\n      );\n      if (!relatedShapeObj)\n        errorMsg =\n          \"Failed to find related shape. Please verify shape type for event.\";\n      else {\n        event.shape = relatedShapeObj;\n      }\n    }\n    // if lat, long come in with commas, replace with decimal format\n    event.latitude = event.latitude.replace(\",\", \".\");\n    event.longitude = event.longitude.replace(\",\", \".\");\n\n    event.datetime = calcDatetime(event.date, event.time);\n    if (!isValidDate(event.datetime))\n      errorMsg =\n        \"Invalid date. It's been dropped, as otherwise timemap won't work as expected.\";\n\n    if (errorMsg) {\n      discardedDomain.events.push({\n        ...event,\n        error: makeError(\"events\", event.id, errorMsg),\n      });\n      return false;\n    }\n    return true;\n  });\n\n  sanitizedDomain.events.sort((a, b) => a.datetime - b.datetime);\n\n  // Message the number of failed items in domain\n  Object.keys(discardedDomain).forEach((disc) => {\n    const len = discardedDomain[disc].length;\n    if (len) {\n      sanitizedDomain.notifications.push({\n        message: `${len} invalid ${disc} not displayed.`,\n        items: discardedDomain[disc],\n        type: \"error\",\n      });\n    }\n  });\n  return sanitizedDomain;\n}\n","import initial from \"../store/initial.js\";\n\nimport { UPDATE_DOMAIN, MARK_NOTIFICATIONS_READ } from \"../actions\";\nimport { validateDomain } from \"./validate/validators.js\";\n\nfunction updateDomain(domainState, action) {\n  return {\n    ...domainState,\n    ...validateDomain(action.payload.domain, action.payload.features),\n  };\n}\n\nfunction markNotificationsRead(domainState, action) {\n  return {\n    ...domainState,\n    notifications: domainState.notifications.map((n) => ({\n      ...n,\n      isRead: true,\n    })),\n  };\n}\n\nfunction domain(domainState = initial.domain, action) {\n  switch (action.type) {\n    case UPDATE_DOMAIN:\n      return updateDomain(domainState, action);\n    case MARK_NOTIFICATIONS_READ:\n      return markNotificationsRead(domainState, action);\n    default:\n      return domainState;\n  }\n}\n\nexport default domain;\n","import initial from \"../store/initial.js\";\nimport { ASSOCIATION_MODES } from \"../common/constants\";\nimport { toggleFlagAC } from \"../common/utilities\";\n\nimport {\n  UPDATE_HIGHLIGHTED,\n  UPDATE_SELECTED,\n  UPDATE_COLORING_SET,\n  UPDATE_TICKS,\n  CLEAR_FILTER,\n  TOGGLE_ASSOCIATIONS,\n  TOGGLE_SHAPES,\n  UPDATE_TIMERANGE,\n  UPDATE_DIMENSIONS,\n  UPDATE_NARRATIVE,\n  UPDATE_NARRATIVE_STEP_IDX,\n  UPDATE_SOURCE,\n  TOGGLE_LANGUAGE,\n  TOGGLE_SITES,\n  TOGGLE_FETCHING_DOMAIN,\n  TOGGLE_FETCHING_SOURCES,\n  TOGGLE_INFOPOPUP,\n  TOGGLE_INTROPOPUP,\n  TOGGLE_NOTIFICATIONS,\n  TOGGLE_COVER,\n  FETCH_ERROR,\n  FETCH_SOURCE_ERROR,\n  SET_LOADING,\n  SET_NOT_LOADING,\n  SET_INITIAL_CATEGORIES,\n  SET_INITIAL_SHAPES,\n  UPDATE_SEARCH_QUERY,\n} from \"../actions\";\n\nfunction updateHighlighted(appState, action) {\n  return Object.assign({}, appState, {\n    highlighted: action.highlighted,\n  });\n}\n\nfunction updateTicks(appState, action) {\n  return {\n    ...appState,\n    timeline: {\n      ...appState.timeline,\n      dimensions: {\n        ...appState.timeline.dimensions,\n        ticks: action.ticks,\n      },\n    },\n  };\n}\n\nfunction updateSelected(appState, action) {\n  return Object.assign({}, appState, {\n    selected: action.selected,\n  });\n}\n\nfunction updateColoringSet(appState, action) {\n  return {\n    ...appState,\n    associations: {\n      ...appState.associations,\n      coloringSet: action.coloringSet,\n    },\n  };\n}\n\nfunction updateNarrative(appState, action) {\n  let minTime = appState.timeline.range[0];\n  let maxTime = appState.timeline.range[1];\n\n  const cornerBound0 = [180, 180];\n  const cornerBound1 = [-180, -180];\n\n  // Compute narrative time range and map bounds\n  if (action.narrative) {\n    // Forced to comment out min and max time changes, not sure why?\n    minTime = appState.timeline.rangeLimits[0];\n    maxTime = appState.timeline.rangeLimits[1];\n\n    // Find max and mins coordinates of narrative events\n    action.narrative.steps.forEach((step) => {\n      const stepTime = step.datetime;\n      if (stepTime < minTime) minTime = stepTime;\n      if (stepTime > maxTime) maxTime = stepTime;\n\n      if (!!step.longitude && !!step.latitude) {\n        if (+step.longitude < cornerBound0[1])\n          cornerBound0[1] = +step.longitude;\n        if (+step.longitude > cornerBound1[1])\n          cornerBound1[1] = +step.longitude;\n        if (+step.latitude < cornerBound0[0]) cornerBound0[0] = +step.latitude;\n        if (+step.latitude > cornerBound1[0]) cornerBound1[0] = +step.latitude;\n      }\n    });\n    // Adjust bounds to center around first event, while keeping visible all others\n    // Takes first event, finds max ditance with first attempt bounds, and use this max distance\n    // on the other side, both in latitude and longitude\n    const first = action.narrative.steps[0];\n    if (!!first.longitude && !!first.latitude) {\n      const firstToLong0 = Math.abs(+first.longitude - cornerBound0[1]);\n      const firstToLong1 = Math.abs(+first.longitude - cornerBound1[1]);\n      const firstToLat0 = Math.abs(+first.latitude - cornerBound0[0]);\n      const firstToLat1 = Math.abs(+first.latitude - cornerBound1[0]);\n\n      if (firstToLong0 > firstToLong1)\n        cornerBound1[1] = +first.longitude + firstToLong0;\n      if (firstToLong0 < firstToLong1)\n        cornerBound0[1] = +first.longitude - firstToLong1;\n      if (firstToLat0 > firstToLat1)\n        cornerBound1[0] = +first.latitude + firstToLat0;\n      if (firstToLat0 < firstToLat1)\n        cornerBound0[0] = +first.latitude - firstToLat1;\n    }\n\n    // Add some buffer on both sides of the time extent\n    minTime = minTime - Math.abs((maxTime - minTime) / 10);\n    maxTime = maxTime + Math.abs((maxTime - minTime) / 10);\n  }\n  return {\n    ...appState,\n    associations: {\n      ...appState.associations,\n      narrative: action.narrative,\n    },\n    map: {\n      ...appState.map,\n      bounds: action.narrative ? [cornerBound0, cornerBound1] : null,\n    },\n    timeline: {\n      ...appState.timeline,\n      range: [minTime, maxTime],\n    },\n  };\n}\n\nfunction updateNarrativeStepIdx(appState, action) {\n  return {\n    ...appState,\n    narrativeState: {\n      current: action.idx,\n    },\n  };\n}\n\nfunction toggleAssociations(appState, action) {\n  if (!(action.value instanceof Array)) {\n    action.value = [action.value];\n  }\n  const { association: associationType } = action;\n\n  let newAssociations = appState.associations[associationType].slice(0);\n  action.value.forEach((vl) => {\n    if (newAssociations.includes(vl)) {\n      newAssociations = newAssociations.filter((s) => s !== vl);\n    } else {\n      newAssociations.push(vl);\n    }\n  });\n\n  return {\n    ...appState,\n    associations: {\n      ...appState.associations,\n      [associationType]: newAssociations,\n    },\n  };\n}\n\nfunction toggleShapes(appState, action) {\n  let newShapes = [...appState.shapes];\n  if (newShapes.includes(action.shape)) {\n    const idx = newShapes.indexOf(action.shape);\n    newShapes.splice(idx, 1);\n  } else {\n    newShapes.push(action.shape);\n  }\n\n  return {\n    ...appState,\n    shapes: newShapes,\n  };\n}\n\nfunction clearFilter(appState, action) {\n  return {\n    ...appState,\n    filters: {\n      ...appState.filters,\n      [action.filter]: [],\n    },\n  };\n}\n\nfunction updateTimeRange(appState, action) {\n  // XXX\n  return {\n    ...appState,\n    timeline: {\n      ...appState.timeline,\n      range: action.timerange,\n    },\n  };\n}\n\nfunction updateDimensions(appState, action) {\n  return {\n    ...appState,\n    timeline: {\n      ...appState.timeline,\n      dimensions: {\n        ...appState.timeline.dimensions,\n        ...action.dims,\n      },\n    },\n  };\n}\n\nfunction toggleLanguage(appState, action) {\n  const otherLanguage = appState.language === \"es-MX\" ? \"en-US\" : \"es-MX\";\n  return Object.assign({}, appState, {\n    language: action.language || otherLanguage,\n  });\n}\n\nfunction updateSource(appState, action) {\n  return {\n    ...appState,\n    source: action.source,\n  };\n}\n\nfunction fetchError(state, action) {\n  return {\n    ...state,\n    error: action.message,\n    notifications: [{ type: \"error\", message: action.message }],\n  };\n}\n\nconst toggleSites = toggleFlagAC(\"isShowingSites\");\nconst toggleFetchingDomain = toggleFlagAC(\"isFetchingDomain\");\nconst toggleFetchingSources = toggleFlagAC(\"isFetchingSources\");\nconst toggleInfoPopup = toggleFlagAC(\"isInfopopup\");\nconst toggleIntroPopup = toggleFlagAC(\"isIntropopup\");\nconst toggleNotifications = toggleFlagAC(\"isNotification\");\nconst toggleCover = toggleFlagAC(\"isCover\");\n\nfunction fetchSourceError(appState, action) {\n  return {\n    ...appState,\n    errors: {\n      ...appState.errors,\n      source: action.msg,\n    },\n  };\n}\n\nfunction setLoading(appState) {\n  return {\n    ...appState,\n    loading: true,\n  };\n}\n\nfunction setNotLoading(appState) {\n  return {\n    ...appState,\n    loading: false,\n  };\n}\n\nfunction setInitialCategories(appState, action) {\n  const categories = action.values.reduce((acc, val) => {\n    if (val.mode === ASSOCIATION_MODES.CATEGORY) acc.push(val.title);\n    return acc;\n  }, []);\n\n  return {\n    ...appState,\n    associations: {\n      ...appState.associations,\n      categories: categories,\n    },\n  };\n}\n\nfunction setInitialShapes(appState, action) {\n  const shapeIds = action.values.map((sh) => sh.id);\n  return {\n    ...appState,\n    shapes: shapeIds,\n  };\n}\n\nfunction updateSearchQuery(appState, action) {\n  return {\n    ...appState,\n    searchQuery: action.searchQuery,\n  };\n}\n\nfunction app(appState = initial.app, action) {\n  switch (action.type) {\n    case UPDATE_HIGHLIGHTED:\n      return updateHighlighted(appState, action);\n    case UPDATE_SELECTED:\n      return updateSelected(appState, action);\n    case UPDATE_COLORING_SET:\n      return updateColoringSet(appState, action);\n    case UPDATE_TICKS:\n      return updateTicks(appState, action);\n    case CLEAR_FILTER:\n      return clearFilter(appState, action);\n    case TOGGLE_ASSOCIATIONS:\n      return toggleAssociations(appState, action);\n    case TOGGLE_SHAPES:\n      return toggleShapes(appState, action);\n    case UPDATE_TIMERANGE:\n      return updateTimeRange(appState, action);\n    case UPDATE_DIMENSIONS:\n      return updateDimensions(appState, action);\n    case UPDATE_NARRATIVE:\n      return updateNarrative(appState, action);\n    case UPDATE_NARRATIVE_STEP_IDX:\n      return updateNarrativeStepIdx(appState, action);\n    case UPDATE_SOURCE:\n      return updateSource(appState, action);\n    /* toggles */\n    case TOGGLE_LANGUAGE:\n      return toggleLanguage(appState, action);\n    case TOGGLE_SITES:\n      return toggleSites(appState);\n    case TOGGLE_FETCHING_DOMAIN:\n      return toggleFetchingDomain(appState);\n    case TOGGLE_FETCHING_SOURCES:\n      return toggleFetchingSources(appState);\n    case TOGGLE_INFOPOPUP:\n      return toggleInfoPopup(appState);\n    case TOGGLE_INTROPOPUP:\n      return toggleIntroPopup(appState);\n    case TOGGLE_NOTIFICATIONS:\n      return toggleNotifications(appState);\n    case TOGGLE_COVER:\n      return toggleCover(appState);\n    /* errors */\n    case FETCH_ERROR:\n      return fetchError(appState, action);\n    case FETCH_SOURCE_ERROR:\n      return fetchSourceError(appState, action);\n    case SET_LOADING:\n      return setLoading(appState);\n    case SET_NOT_LOADING:\n      return setNotLoading(appState);\n    case SET_INITIAL_CATEGORIES:\n      return setInitialCategories(appState, action);\n    case SET_INITIAL_SHAPES:\n      return setInitialShapes(appState, action);\n    case UPDATE_SEARCH_QUERY:\n      return updateSearchQuery(appState, action);\n    default:\n      return appState;\n  }\n}\n\nexport default app;\n","import initial from \"../store/initial.js\";\n\nimport { TOGGLE_SATELLITE_VIEW } from \"../actions\";\n\nfunction ui(uiState = initial.ui, action) {\n  switch (action.type) {\n    case TOGGLE_SATELLITE_VIEW:\n      return {\n        ...uiState,\n        tiles: {\n          ...uiState.tiles,\n          current:\n            uiState.tiles.current === \"satellite\"\n              ? uiState.tiles.default\n              : \"satellite\",\n        },\n      };\n    default:\n      return uiState;\n  }\n}\n\nexport default ui;\n","import initial from \"../store/initial.js\";\n\nfunction features(featureState = initial.features, action) {\n  return featureState;\n}\n\nexport default features;\n","import { combineReducers } from \"redux\";\nimport rootReducer from \"./root.js\";\nimport domain from \"./domain.js\";\nimport app from \"./app.js\";\nimport ui from \"./ui.js\";\nimport features from \"./features.js\";\n\nfunction decorateRootReducer(rootReducer, reducer) {\n  return (state, action) =>\n    reducer(\n      {\n        ...rootReducer(state, action),\n      },\n      action\n    );\n}\n\nexport default decorateRootReducer(\n  rootReducer,\n  combineReducers({\n    app,\n    domain,\n    ui,\n    features,\n  })\n);\n","import { REHYDRATE_STATE } from \"../actions\";\nimport { applyUrlState } from \"../store/plugins/urlState\";\n\nexport default function rootReducer(state = {}, action) {\n  switch (action.type) {\n    case REHYDRATE_STATE:\n      return applyUrlState(state);\n    default:\n      return state;\n  }\n}\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n\nimport rootReducer from \"../reducers\";\nimport { urlStateMiddleware } from \"./plugins/urlState\";\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst store = createStore(\n  rootReducer,\n  composeEnhancers(applyMiddleware(thunk), applyMiddleware(urlStateMiddleware))\n);\n\nexport default store;\n","import { SCHEMA } from \"./schema\";\nimport URLState from \"./urlState\";\n\nexport function urlStateMiddleware(store) {\n  return (next) => (action) => {\n    const result = next(action);\n\n    try {\n      const schemas = Object.values(SCHEMA).filter(\n        (s) => s.trigger === action.type\n      );\n\n      if (schemas.length) {\n        const urlState = new URLState();\n        const state = store.getState();\n        schemas.forEach((s) => {\n          urlState.set(s.key, s.dehydrate(state));\n        });\n        urlState.serialize();\n      }\n    } catch (err) {\n      console.error(\"error serializing url state\", err);\n    }\n\n    return result;\n  };\n}\n","import React from \"react\";\nimport { DEFAULT_CHECKBOX_COLOR } from \"../../common/constants\";\n\nconst Checkbox = ({ label, isActive, onClickCheckbox, color, styleProps }) => {\n  const checkboxColor = color ? color : DEFAULT_CHECKBOX_COLOR;\n  const baseStyles = {\n    checkboxStyles: {\n      background: isActive ? checkboxColor : \"none\",\n      border: `1px solid ${checkboxColor}`,\n    },\n  };\n  const containerStyles = styleProps ? styleProps.containerStyles : {};\n  const checkboxStyles = styleProps\n    ? styleProps.checkboxStyles\n    : baseStyles.checkboxStyles;\n  return (\n    <div className={isActive ? \"item active\" : \"item\"}>\n      <span style={{ color: color }}>{label}</span>\n      <button onClick={onClickCheckbox}>\n        <div className=\"border\" style={containerStyles}>\n          <div className=\"checkbox\" style={checkboxStyles} />\n        </div>\n      </button>\n    </div>\n  );\n};\n\nexport default Checkbox;\n","import React from \"react\";\nimport Checkbox from \"../atoms/Checkbox\";\nimport { marked } from \"marked\";\nimport {\n  aggregateFilterPaths,\n  getFilterIdxFromColorSet,\n  getPathLeaf,\n} from \"../../common/utilities\";\n\n/** recursively get an array of node keys to toggle */\nfunction getFiltersToToggle(filter, activeFilters) {\n  const [key, children] = filter;\n  // base case: no children to recurse through\n  if (children === {}) return [key];\n\n  const turningOff = activeFilters.includes(key);\n  const childKeys = Object.entries(children)\n    .flatMap((filter) => getFiltersToToggle(filter, activeFilters))\n    .filter((child) => activeFilters.includes(child) === turningOff);\n\n  childKeys.push(key);\n  return childKeys;\n}\n\nfunction FilterListPanel({\n  filters,\n  activeFilters,\n  onSelectFilter,\n  language,\n  coloringSet,\n  filterColors,\n  title,\n  description,\n}) {\n  function createNodeComponent(filter, depth) {\n    const [key, children] = filter;\n    const pathLeaf = getPathLeaf(key);\n    const matchingKeys = getFiltersToToggle(filter, activeFilters);\n    const idxFromColorSet = getFilterIdxFromColorSet(key, coloringSet);\n    const assignedColor =\n      idxFromColorSet !== -1 && activeFilters.includes(key)\n        ? filterColors[idxFromColorSet]\n        : \"\";\n\n    const styles = {\n      color: assignedColor,\n      marginLeft: `${depth * 20}px`,\n    };\n\n    return (\n      <li\n        key={pathLeaf.replace(/ /g, \"_\")}\n        className=\"filter-filter\"\n        style={{ ...styles }}\n      >\n        <Checkbox\n          label={pathLeaf}\n          isActive={activeFilters.includes(key)}\n          onClickCheckbox={() => onSelectFilter(key, matchingKeys)}\n          color={assignedColor}\n        />\n        {Object.keys(children).length > 0 ? (\n          <ul>\n            {Object.entries(children).map((filter) =>\n              createNodeComponent(filter, depth + 1)\n            )}\n          </ul>\n        ) : null}\n      </li>\n    );\n  }\n\n  function renderTree(filters) {\n    const aggregatedFilterPaths = aggregateFilterPaths(filters);\n\n    return (\n      <div>\n        {Object.entries(aggregatedFilterPaths).map((filter) =>\n          createNodeComponent(filter, 1)\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"react-innertabpanel\">\n      <h2>{title}</h2>\n      <p\n        dangerouslySetInnerHTML={{\n          __html: marked(description),\n        }}\n      />\n      {renderTree(filters)}\n    </div>\n  );\n}\n\nexport default FilterListPanel;\n","import React from \"react\";\nimport Checkbox from \"../../atoms/Checkbox\";\nimport { ASSOCIATION_MODES } from \"../../../common/constants\";\n\nconst PanelTree = ({ data, activeValues, onSelect, type }) => {\n  // If the parent panel is of type 'CATEGORY': filter on title. If panel is 'SHAPE': filter on id\n  const onSelectionType = type === ASSOCIATION_MODES.CATEGORY ? \"title\" : \"id\";\n  return (\n    <div>\n      {data.map((val) => {\n        return (\n          <li\n            key={val.title.replace(/ /g, \"_\")}\n            className=\"filter-filter active\"\n            style={{ marginLeft: \"20px\" }}\n          >\n            <Checkbox\n              label={val.title}\n              isActive={activeValues.includes(val[onSelectionType])}\n              onClickCheckbox={() => onSelect(val[onSelectionType])}\n              styleProps={val.styles}\n            />\n          </li>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default PanelTree;\n","import React from \"react\";\nimport { marked } from \"marked\";\nimport PanelTree from \"./atoms/PanelTree\";\nimport { ASSOCIATION_MODES } from \"../../common/constants\";\n\nconst CategoriesListPanel = ({\n  categories,\n  activeCategories,\n  onCategoryFilter,\n  language,\n  title,\n  description,\n}) => {\n  return (\n    <div className=\"react-innertabpanel\">\n      <h2>{title}</h2>\n      <p\n        dangerouslySetInnerHTML={{\n          __html: marked(description),\n        }}\n      />\n      <PanelTree\n        data={categories}\n        activeValues={activeCategories}\n        onSelect={onCategoryFilter}\n        type={ASSOCIATION_MODES.CATEGORY}\n      />\n    </div>\n  );\n};\n\nexport default CategoriesListPanel;\n","import React from \"react\";\nimport { marked } from \"marked\";\nimport PanelTree from \"./atoms/PanelTree\";\nimport { mapStyleByShape } from \"../../common/utilities\";\nimport { SHAPE } from \"../../common/constants\";\n\nconst ShapesListPanel = ({\n  shapes,\n  activeShapes,\n  onShapeFilter,\n  language,\n  title,\n  description,\n}) => {\n  const styledShapes = mapStyleByShape(shapes, activeShapes);\n  return (\n    <div className=\"react-innertabpanel\">\n      <h2>{title}</h2>\n      <p\n        dangerouslySetInnerHTML={{\n          __html: marked(description),\n        }}\n      />\n      <PanelTree\n        data={styledShapes}\n        activeValues={activeShapes}\n        onSelect={onShapeFilter}\n        type={SHAPE}\n      />\n    </div>\n  );\n};\n\nexport default ShapesListPanel;\n","import React from \"react\";\n\nconst SitesIcon = ({ isActive, isDisabled, onClickHandler }) => {\n  let classes = isActive ? \"action-button enabled\" : \"action-button\";\n  if (isDisabled) {\n    classes = \"action-button disabled\";\n  }\n\n  return (\n    <button className={classes} onClick={onClickHandler}>\n      <i className=\"material-icons\">location_on</i>\n    </button>\n  );\n};\n\nexport default SitesIcon;\n","import React from \"react\";\n\nconst CoverIcon = ({ isActive, isDisabled, onClickHandler }) => {\n  let classes = isActive ? \"action-button enabled\" : \"action-button\";\n  if (isDisabled) {\n    classes = \"action-button disabled\";\n  }\n\n  return (\n    <button className={classes} onClick={onClickHandler}>\n      <i className=\"material-icons\">home</i>\n    </button>\n  );\n};\n\nexport default CoverIcon;\n","import React from \"react\";\n\nconst CoverIcon = ({ isActive, isDisabled, onClickHandler }) => {\n  let classes = isActive ? \"action-button enabled\" : \"action-button\";\n  if (isDisabled) {\n    classes = \"action-button disabled\";\n  }\n\n  return (\n    <button className={classes} onClick={onClickHandler}>\n      <i className=\"material-icons\">info</i>\n    </button>\n  );\n};\n\nexport default CoverIcon;\n","import React from \"react\";\n\nimport SitesIcon from \"../atoms/SitesIcon\";\nimport CoverIcon from \"../atoms/CoverIcon\";\nimport InfoIcon from \"../atoms/InfoIcon\";\n\nfunction BottomActions(props) {\n  function renderToggles() {\n    return (\n      <>\n        <div className=\"bottom-action-block\">\n          {props.features.USE_SITES ? (\n            <SitesIcon\n              isActive={props.sites.enabled}\n              onClickHandler={props.sites.toggle}\n            />\n          ) : null}\n        </div>\n        <div className=\"botttom-action-block\">\n          <InfoIcon\n            isActive={props.info.enabled}\n            onClickHandler={props.info.toggle}\n          />\n        </div>\n        <div className=\"botttom-action-block\">\n          {props.features.USE_COVER ? (\n            <CoverIcon onClickHandler={props.cover.toggle} />\n          ) : null}\n        </div>\n      </>\n    );\n  }\n\n  return <div className=\"bottom-actions\">{renderToggles()}</div>;\n}\n\nexport default BottomActions;\n","export function ToolbarButton({ isActive, iconKey, onClick, label }) {\n  return (\n    <div\n      className={isActive ? \"toolbar-tab active\" : \"toolbar-tab\"}\n      key={iconKey}\n      onClick={onClick}\n    >\n      <i className=\"material-icons\">{iconKey}</i>\n      <div className=\"tab-caption\">{label}</div>\n    </div>\n  );\n}\n\n// https://github.com/reactjs/react-tabs#set-tabsrole\nToolbarButton.tabsRole = \"Tab\";\n","import React from \"react\";\nimport screenfull from \"screenfull\";\nimport { ToolbarButton } from \"./atoms/ToolbarButton\";\nimport copy from \"../../common/data/copy.json\";\n\nexport class FullscreenToggle extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onFullscreenStateChange = this.onFullscreenStateChange.bind(this);\n\n    this.state = {\n      isFullscreen: screenfull.isFullscreen,\n    };\n  }\n\n  componentDidMount() {\n    screenfull.on(\"change\", this.onFullscreenStateChange);\n  }\n\n  componentWillUnmount() {\n    screenfull.off(\"change\", this.onFullscreenStateChange);\n  }\n\n  onFullscreenStateChange(evt) {\n    this.setState({ isFullscreen: screenfull.isFullscreen });\n  }\n\n  onToggleFullscreen() {\n    screenfull.toggle().catch(console.warn);\n  }\n\n  render() {\n    if (!screenfull.isEnabled) return null;\n\n    const { language } = this.props;\n    const { isFullscreen } = this.state;\n\n    return (\n      <ToolbarButton\n        isActive={isFullscreen}\n        label={\n          isFullscreen\n            ? copy[language].toolbar.fullscreen_exit\n            : copy[language].toolbar.fullscreen_enter\n        }\n        iconKey={isFullscreen ? \"fullscreen_exit\" : \"fullscreen\"}\n        onClick={this.onToggleFullscreen}\n      />\n    );\n  }\n}\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport * as actions from \"../actions\";\nimport * as selectors from \"../selectors\";\n\nimport { Tabs, TabList, TabPanel } from \"react-tabs\";\nimport FilterListPanel from \"./controls/FilterListPanel\";\nimport CategoriesListPanel from \"./controls/CategoriesListPanel\";\nimport ShapesListPanel from \"./controls/ShapesListPanel\";\nimport BottomActions from \"./controls/BottomActions\";\nimport copy from \"../common/data/copy.json\";\nimport {\n  trimAndEllipse,\n  getImmediateFilterParent,\n  getFilterSiblings,\n  getFilterAncestors,\n  addToColoringSet,\n  removeFromColoringSet,\n  mapCategoriesToPaths,\n  getCategoryIdxs,\n  getFilterIdx,\n} from \"../common/utilities.js\";\nimport { ToolbarButton } from \"./controls/atoms/ToolbarButton\";\nimport { FullscreenToggle } from \"./controls/FullScreenToggle\";\n\nclass Toolbar extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSelectFilter = this.onSelectFilter.bind(this);\n    this.state = { _selected: -1 };\n  }\n\n  selectTab(selected) {\n    const _selected = this.state._selected === selected ? -1 : selected;\n    this.setState({ _selected });\n  }\n\n  onSelectFilter(key, matchingKeys) {\n    const { filters, activeFilters, coloringSet, maxNumOfColors } = this.props;\n\n    const parent = getImmediateFilterParent(key);\n    const isTurningOff = activeFilters.includes(key);\n\n    if (!isTurningOff) {\n      const updatedColoringSet = addToColoringSet(coloringSet, matchingKeys);\n      if (updatedColoringSet.length <= maxNumOfColors) {\n        this.props.actions.updateColoringSet(updatedColoringSet);\n      }\n    } else {\n      if (parent && activeFilters.includes(parent)) {\n        const siblings = getFilterSiblings(filters, parent, key);\n        let siblingsOff = true;\n        for (const sibling of siblings) {\n          if (activeFilters.includes(sibling)) {\n            siblingsOff = false;\n            break;\n          }\n        }\n\n        if (siblingsOff) {\n          const grandparentsOn = getFilterAncestors(key).filter((filt) =>\n            activeFilters.includes(filt)\n          );\n          matchingKeys = matchingKeys.concat(grandparentsOn);\n        }\n      }\n\n      const updatedColoringSet = removeFromColoringSet(\n        coloringSet,\n        matchingKeys\n      );\n      this.props.actions.updateColoringSet(updatedColoringSet);\n    }\n    this.props.methods.onSelectFilter(matchingKeys);\n    this.props.actions.updateSelected([]);\n  }\n\n  renderClosePanel() {\n    return (\n      <div className=\"panel-header\" onClick={() => this.selectTab(-1)}>\n        <div className=\"caret\" />\n      </div>\n    );\n  }\n\n  goToNarrative(narrative) {\n    this.selectTab(-1); // set all unselected within this component\n    this.props.methods.onSelectNarrative(narrative);\n  }\n\n  renderToolbarNarrativePanel() {\n    const { panels } = this.props.toolbarCopy;\n    return (\n      <TabPanel>\n        <h2>{panels.narratives.label}</h2>\n        <p>{panels.narratives.description}</p>\n        {this.props.narratives.map((narr) => {\n          return (\n            <div className=\"panel-action action\">\n              <button\n                onClick={() => {\n                  this.goToNarrative(narr);\n                }}\n              >\n                <p>{narr.id}</p>\n                <p>\n                  <small>{trimAndEllipse(narr.desc, 120)}</small>\n                </p>\n              </button>\n            </div>\n          );\n        })}\n      </TabPanel>\n    );\n  }\n\n  renderToolbarCategoriesPanel() {\n    const { categories: panelCategories } = this.props.toolbarCopy.panels;\n    const catMap = mapCategoriesToPaths(\n      this.props.categories,\n      Object.keys(panelCategories)\n    );\n\n    return (\n      <div>\n        {Object.keys(catMap).map((type) => {\n          const children = catMap[type];\n          return (\n            <TabPanel key={type}>\n              <CategoriesListPanel\n                categories={children}\n                activeCategories={this.props.activeCategories}\n                onCategoryFilter={this.props.methods.onCategoryFilter}\n                language={this.props.language}\n                title={panelCategories[type].label}\n                description={panelCategories[type].description}\n              />\n            </TabPanel>\n          );\n        })}\n      </div>\n    );\n  }\n\n  renderToolbarFilterPanel() {\n    const { panels } = this.props.toolbarCopy;\n    return (\n      <TabPanel>\n        <FilterListPanel\n          filters={this.props.filters}\n          activeFilters={this.props.activeFilters}\n          onSelectFilter={this.onSelectFilter}\n          language={this.props.language}\n          coloringSet={this.props.coloringSet}\n          filterColors={this.props.filterColors}\n          title={panels.filters.label}\n          description={panels.filters.description}\n        />\n      </TabPanel>\n    );\n  }\n\n  renderToolbarShapePanel() {\n    const { panels } = this.props.toolbarCopy;\n\n    if (this.props.features.USE_SHAPES) {\n      return (\n        <TabPanel>\n          <ShapesListPanel\n            shapes={this.props.shapes}\n            activeShapes={this.props.activeShapes}\n            onShapeFilter={this.props.methods.onShapeFilter}\n            language={this.props.language}\n            title={panels.shapes.label}\n            description={panels.shapes.description}\n          />\n        </TabPanel>\n      );\n    }\n  }\n\n  renderToolbarTab(_selected, label, iconKey, key) {\n    return (\n      <ToolbarButton\n        key={key}\n        label={label}\n        iconKey={iconKey}\n        isActive={this.state._selected === _selected}\n        onClick={() => {\n          this.selectTab(_selected);\n        }}\n      />\n    );\n  }\n\n  renderToolbarCategoryTabs(idxs) {\n    const { categories: panelCategories } = this.props.toolbarCopy.panels;\n    return (\n      <div>\n        {Object.keys(idxs).map((key) => {\n          return this.renderToolbarTab(\n            idxs[key],\n            panelCategories[key].label,\n            panelCategories[key].icon,\n            key\n          );\n        })}\n      </div>\n    );\n  }\n\n  renderToolbarPanels() {\n    const { features, narratives } = this.props;\n    const classes =\n      this.state._selected >= 0 ? \"toolbar-panels\" : \"toolbar-panels folded\";\n    return (\n      <div className={classes}>\n        {this.renderClosePanel()}\n        {narratives && narratives.length !== 0\n          ? this.renderToolbarNarrativePanel()\n          : null}\n        {features.USE_CATEGORIES ? this.renderToolbarCategoriesPanel() : null}\n        {features.USE_ASSOCIATIONS ? this.renderToolbarFilterPanel() : null}\n        {features.USE_SHAPES ? this.renderToolbarShapePanel() : null}\n      </div>\n    );\n  }\n\n  renderToolbarNavs() {\n    if (this.props.narratives) {\n      return this.props.narratives.map((nar, idx) => {\n        const isActive = idx === this.state._selected;\n\n        const classes = isActive ? \"toolbar-tab active\" : \"toolbar-tab\";\n\n        return (\n          <div\n            className={classes}\n            onClick={() => {\n              this.selectTab(idx);\n            }}\n          >\n            <div className=\"tab-caption\">{nar.label}</div>\n          </div>\n        );\n      });\n    }\n    return null;\n  }\n\n  renderToolbarTabs() {\n    const { features, narratives, toolbarCopy } = this.props;\n    const narrativesExist = narratives && narratives.length !== 0;\n    let title = copy[this.props.language].toolbar.title;\n    if (process.env.display_title) title = process.env.display_title;\n    const { panels } = toolbarCopy;\n\n    const narrativesIdx = 0;\n    const categoryIdxs = getCategoryIdxs(\n      Object.keys(panels.categories),\n      narrativesExist ? 1 : 0\n    );\n    const numCategoryPanels = Object.keys(categoryIdxs).length;\n    const filtersIdx = getFilterIdx(\n      narrativesExist,\n      features.USE_CATEGORIES,\n      numCategoryPanels || 0\n    );\n    const shapesIdx = filtersIdx + 1;\n\n    return (\n      <div className=\"toolbar\">\n        <div className=\"toolbar-header\" onClick={this.props.methods.onTitle}>\n          {/* (mamagallina) antes {title} */}\n          <p>Election Aftershocks: Human Rights violations in Venezuela</p>\n        </div>\n        <div className=\"toolbar-tabs\">\n          <TabList>\n            {narrativesExist\n              ? this.renderToolbarTab(\n                  narrativesIdx,\n                  panels.narratives.label,\n                  panels.narratives.icon\n                )\n              : null}\n            {features.USE_CATEGORIES\n              ? this.renderToolbarCategoryTabs(categoryIdxs)\n              : null}\n            {features.USE_ASSOCIATIONS\n              ? this.renderToolbarTab(\n                  filtersIdx,\n                  panels.filters.label,\n                  panels.filters.icon\n                )\n              : null}\n            {features.USE_SHAPES\n              ? this.renderToolbarTab(\n                  shapesIdx,\n                  panels.shapes.label,\n                  panels.shapes.icon\n                )\n              : null}\n            {features.USE_FULLSCREEN && (\n              <FullscreenToggle language={this.props.language} />\n            )}\n          </TabList>\n        </div>\n        <BottomActions\n          info={{\n            enabled: this.props.infoShowing,\n            toggle: this.props.actions.toggleInfoPopup,\n          }}\n          sites={{\n            enabled: this.props.sitesShowing,\n            toggle: this.props.actions.toggleSites,\n          }}\n          cover={{\n            toggle: this.props.actions.toggleCover,\n          }}\n          features={this.props.features}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const { isNarrative } = this.props;\n\n    return (\n      <div\n        id=\"toolbar-wrapper\"\n        className={`toolbar-wrapper ${isNarrative ? \"narrative-mode\" : \"\"}`}\n      >\n        <Tabs onSelect={() => null} selectedIndex={this.state._selected}>\n          {this.renderToolbarTabs()}\n          {this.renderToolbarPanels()}\n        </Tabs>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    filters: selectors.getFilters(state),\n    categories: selectors.getCategories(state),\n    narratives: selectors.selectNarratives(state),\n    shapes: selectors.getShapes(state),\n    language: state.app.language,\n    toolbarCopy: state.app.toolbar,\n    activeFilters: selectors.getActiveFilters(state),\n    activeCategories: selectors.getActiveCategories(state),\n    activeShapes: selectors.getActiveShapes(state),\n    viewFilters: state.app.associations.views,\n    narrative: state.app.associations.narrative,\n    sitesShowing: state.app.flags.isShowingSites,\n    infoShowing: state.app.flags.isInfopopup,\n    coloringSet: state.app.associations.coloringSet,\n    maxNumOfColors: state.ui.coloring.maxNumOfColors,\n    filterColors: state.ui.coloring.colors,\n    eventRadius: state.ui.eventRadius,\n    features: selectors.getFeatures(state),\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Toolbar);\n","import React from \"react\";\nimport { marked } from \"marked\";\n\nconst fontSize = window.innerWidth > 1000 ? 14 : 18;\n\nconst Popup = ({\n  content = [],\n  styles = {},\n  isOpen = true,\n  onClose,\n  title,\n  theme = \"light\",\n  isMobile = false,\n  children,\n}) => (\n  <div>\n    <div\n      className={`infopopup ${isOpen ? \"\" : \"hidden\"} ${\n        theme === \"dark\" ? \"dark\" : \"light\"\n      } ${isMobile ? \"mobile\" : \"\"}`}\n      style={{ ...styles, fontSize }}\n    >\n      <div className=\"legend-header\">\n        <button\n          onClick={onClose}\n          className=\"side-menu-burg over-white is-active\"\n        >\n          <span />\n        </button>\n        <h2>{title}</h2>\n      </div>\n      {content.map((t, idx) => (\n        <div key={idx} dangerouslySetInnerHTML={{ __html: marked(t) }} />\n      ))}\n      {children}\n    </div>\n  </div>\n);\n\nexport default Popup;\n","import React from \"react\";\nimport Popup from \"./atoms/Popup\";\nimport copy from \"../common/data/copy.json\";\n\nconst Infopopup = ({ isOpen, onClose, language, styles }) => (\n  <Popup\n    title={copy[language].legend.default.header}\n    content={copy[language].legend.default.intro}\n    onClose={onClose}\n    isOpen={isOpen}\n    styles={styles}\n  />\n);\n\nexport default Infopopup;\n","import React from \"react\";\n\nexport default class Notification extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      isExtended: false,\n    };\n  }\n\n  toggleDetails() {\n    this.setState({ isExtended: !this.state.isExtended });\n  }\n\n  renderItems(items) {\n    if (!items) return \"\";\n    return (\n      <div>\n        {items.map((item, idx) => {\n          if (item.error) {\n            return <p key={idx}>{item.error.message}</p>;\n          }\n          return null;\n        })}\n      </div>\n    );\n  }\n\n  renderNotificationContent(notification) {\n    const { type, message, items } = notification;\n\n    return (\n      <div>\n        <div className={`message ${type}`}>{message}</div>\n        <div className={`details ${this.state.isExtended}`}>\n          {items !== null ? this.renderItems(items) : \"\"}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    if (!this.props.notifications) return null;\n    const notificationsToRender = this.props.notifications.filter(\n      (n) => !(\"isRead\" in n && n.isRead)\n    );\n    if (notificationsToRender.length > 0) {\n      return (\n        <div className=\"notification-wrapper\">\n          {this.props.notifications.map((notification, idx) => {\n            return (\n              <div\n                className=\"notification\"\n                onClick={() => this.toggleDetails()}\n                key={idx}\n              >\n                <button\n                  onClick={this.props.onToggle}\n                  className=\"side-menu-burg over-white is-active\"\n                >\n                  <span />\n                </button>\n                {this.renderNotificationContent(notification)}\n              </div>\n            );\n          })}\n        </div>\n      );\n    }\n    return <div />;\n  }\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { marked } from \"marked\";\n\nclass Md extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { md: null, error: null };\n  }\n\n  componentDidMount() {\n    fetch(this.props.path)\n      .then((resp) => resp.text())\n      .then((text) => {\n        if (text.length <= 0) {\n          throw new Error();\n        }\n\n        this.setState({ md: marked(text) });\n      })\n      .catch(() => {\n        this.setState({ error: true });\n      });\n  }\n\n  render() {\n    if (this.state.md && !this.state.error) {\n      return (\n        <div\n          className=\"md-container\"\n          dangerouslySetInnerHTML={{ __html: this.state.md }}\n        />\n      );\n    } else if (this.state.error) {\n      return this.props.unloader || <div>Error: couldn't load source</div>;\n    } else {\n      return this.props.loader;\n    }\n  }\n}\n\nMd.propTypes = {\n  loader: PropTypes.func,\n  unloader: PropTypes.func.isRequired,\n  path: PropTypes.string.isRequired,\n};\n\nexport default Md;\n","import React from \"react\";\n\nconst Spinner = ({ small }) => {\n  return (\n    <div className={`spinner ${small ? \"small\" : \"\"}`}>\n      <div className=\"double-bounce-overlay\" />\n      <div className=\"double-bounce\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import React from \"react\";\n\nconst NoSource = ({ failedUrls }) => {\n  return (\n    <div className=\"no-source-container\">\n      <div className=\"no-source-row\">\n        <p>\n          <i className=\"material-icons no-source-icon\">error</i>\n        </p>\n        <p>\n          No media found, as the original media has not yet been uploaded to the\n          platform.\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default NoSource;\n","import React from \"react\";\nimport { Player } from \"video-react\";\nimport Img from \"react-image\";\nimport Md from \"./Md\";\nimport Spinner from \"../atoms/Spinner\";\nimport NoSource from \"../atoms/NoSource\";\n\nconst Content = ({ media, viewIdx, translations, switchLanguage, langIdx }) => {\n  const el = document.querySelector(\".source-media-gallery\");\n  const shiftW = el ? el.getBoundingClientRect().width : 0;\n\n  function renderMedia(media) {\n    const { path, type, poster } = media;\n    switch (type) {\n      case \"Image\":\n        return (\n          <div className=\"source-image-container\">\n            <Img\n              className=\"source-image\"\n              src={path}\n              loader={\n                <div className=\"source-image-loader\">\n                  <Spinner />\n                </div>\n              }\n              unloader={<NoSource failedUrls={[path]} />}\n              onClick={() => window.open(path, \"_blank\")}\n            />\n          </div>\n        );\n      case \"Video\":\n        return (\n          <div className=\"media-player\">\n            <div className=\"banner-trans right-overlay\">\n              {translations\n                ? translations.map((trans, idx) =>\n                    langIdx !== idx + 1 ? (\n                      <div\n                        className=\"trans-button\"\n                        onClick={() => switchLanguage(idx + 1)}\n                      >\n                        {trans.code}\n                      </div>\n                    ) : (\n                      <div\n                        className=\"trans-button\"\n                        onClick={() => switchLanguage(0)}\n                      >\n                        EN\n                      </div>\n                    )\n                  )\n                : null}\n            </div>\n            <Player\n              poster={poster}\n              className=\"source-video\"\n              playsInline\n              src={path}\n            />\n          </div>\n        );\n      case \"Text\":\n        return (\n          <div className=\"source-text-container\">\n            <Md\n              path={path}\n              loader={<Spinner />}\n              unloader={() => this.renderError()}\n            />\n          </div>\n        );\n      case \"Document\":\n        return <iframe title={path} className=\"source-document\" src={path} />;\n      default:\n        return (\n          <NoSource\n            failedUrls={[\n              `Application does not support extension: ${path.split(\".\")[1]}`,\n            ]}\n          />\n        );\n    }\n  }\n\n  return (\n    <div\n      className=\"source-media-gallery\"\n      style={{ transform: `translate(${viewIdx * -shiftW}px)` }}\n    >\n      {media.map((m) => renderMedia(m))}\n    </div>\n  );\n};\n\nexport default Content;\n","import React from \"react\";\n\nconst OverlayControls = ({ viewIdx, paths, onShiftHandler }) => {\n  const backArrow =\n    viewIdx !== 0 ? (\n      <div className=\"back\" onClick={() => onShiftHandler(-1)}>\n        <div className=\"centerer\">\n          <i className=\"material-icons\">arrow_left</i>\n        </div>\n      </div>\n    ) : null;\n  const forwardArrow =\n    viewIdx < paths.length - 1 ? (\n      <div className=\"next\" onClick={() => onShiftHandler(1)}>\n        <div className=\"centerer\">\n          <i className=\"material-icons\">arrow_right</i>\n        </div>\n      </div>\n    ) : null;\n\n  if (paths.length > 1) {\n    return (\n      <div className=\"media-gallery-controls\">\n        {backArrow}\n        {forwardArrow}\n      </div>\n    );\n  }\n  return <div className=\"media-gallery-controls\" />;\n};\n\nexport default OverlayControls;\n","import React from \"react\";\nimport { marked } from \"marked\";\nimport Content from \"./Content\";\nimport Controls from \"./Controls\";\nimport { selectTypeFromPathWithPoster } from \"../../common/utilities\";\n\n/*\n * Inside the SourceOverlay, both the currently displaying media and language\n * can be changed by the user. These are both managed in this component's React\n * state.\n */\nclass SourceOverlay extends React.Component {\n  constructor() {\n    super();\n    this.state = { mediaIdx: 0, langIdx: 0 };\n    this.onShiftGallery = this.onShiftGallery.bind(this);\n  }\n\n  getTypeCounts(media) {\n    return media.reduce(\n      (acc, vl) => {\n        acc[vl.type] += 1;\n        return acc;\n      },\n      { Image: 0, Video: 0, Text: 0 }\n    );\n  }\n\n  onShiftGallery(shift) {\n    // no more left\n    if (this.state.mediaIdx === 0 && shift === -1) return;\n    // no more right\n    if (\n      this.state.mediaIdx === this.props.source.paths.length - 1 &&\n      shift === 1\n    )\n      return;\n    this.setState({ mediaIdx: this.state.mediaIdx + shift });\n  }\n\n  switchLanguage(idx) {\n    this.setState({ langIdx: idx });\n  }\n\n  renderContent(source) {\n    const { url, title, paths, date, type, poster, description } = source;\n    const shortenedTitle = title.substring(0, 100);\n    return (\n      <>\n        <div className=\"mo-banner\">\n          <div className=\"mo-banner-close\" onClick={this.props.onCancel}>\n            <i className=\"material-icons\">close</i>\n          </div>\n\n          <h3 className=\"mo-banner-content\">{shortenedTitle}</h3>\n        </div>\n        <div className=\"mo-container\" onClick={(e) => e.stopPropagation()}>\n          <div className=\"mo-media-container\">\n            <Content\n              switchLanguage={(lang) => this.switchLanguage(lang)}\n              translations={this.props.translations}\n              langIdx={this.state.langIdx}\n              media={paths.map((p) => selectTypeFromPathWithPoster(p, poster))}\n              viewIdx={this.state.mediaIdx}\n            />\n          </div>\n        </div>\n\n        <div className=\"mo-footer\">\n          <Controls\n            paths={paths}\n            viewIdx={this.state.mediaIdx}\n            onShiftHandler={this.onShiftGallery}\n          />\n\n          <div className=\"mo-meta-container\">\n            {description ? (\n              <div className=\"mo-box-desc\">\n                <div\n                  className=\"md-container\"\n                  dangerouslySetInnerHTML={{ __html: marked(description) }}\n                />\n              </div>\n            ) : null}\n\n            {type || date || url ? (\n              <div className=\"mo-box\">\n                <div>\n                  {type ? <h4>Evidence type</h4> : null}\n                  {type ? (\n                    <p>\n                      <i className=\"material-icons left\">perm_media</i>\n                      {type}\n                    </p>\n                  ) : null}\n                </div>\n                <div>\n                  {date ? <h4>Date Published</h4> : null}\n                  {date ? (\n                    <p>\n                      <i className=\"material-icons left\">today</i>\n                      {date}\n                    </p>\n                  ) : null}\n                </div>\n                <div>\n                  {url ? <h4>Link</h4> : null}\n                  {url ? (\n                    <span>\n                      <i className=\"material-icons left\">link</i>\n                      <a href={url} target=\"_blank\" rel=\"noreferrer\">\n                        Link to original URL\n                      </a>\n                    </span>\n                  ) : null}\n                </div>\n              </div>\n            ) : null}\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  renderIntlContent() {\n    const { langIdx } = this.state;\n    const { translations, source } = this.props;\n    let translated = null;\n    if (translations && translations.length && langIdx > 0) {\n      translated = translations[langIdx - 1];\n    }\n    if (translated) {\n      translated = {\n        ...translated,\n        poster: source.poster,\n        // NOTE: this is to allow a slightly nicer syntax when using the Media\n        // overlay in cover videos.\n        paths: translated.file ? [translated.file] : translated.paths,\n      };\n    }\n\n    return this.renderContent(langIdx === 0 ? source : translated);\n  }\n\n  render() {\n    if (typeof this.props.source !== \"object\") {\n      return this.renderError();\n    }\n\n    return (\n      <div className={`mo-overlay ${this.props.opaque ? \"opaque\" : \"\"}`}>\n        {this.renderIntlContent()}\n      </div>\n    );\n  }\n}\n\nexport default SourceOverlay;\n","export default __webpack_public_path__ + \"static/media/github-white.4d74fd76.png\";","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Player } from \"video-react\";\nimport { marked } from \"marked\";\nimport MediaOverlay from \"./atoms/Media\";\n// import falogo from \"../assets/fa-logo.png\";\nimport bcatlogo from \"../assets/github-white.png\";\nconst MEDIA_HIDDEN = -2;\n\n/**\n * Manages the presentation of props that come in from the store's app.cover.\n * These are documented in docs/custom-cover.md.\n * The component is a bit of a mess, keeping a lot of internal state and using\n * a couple of weird offset calculations... but it works for the time being.\n */\nclass TemplateCover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      video: MEDIA_HIDDEN,\n      featureLang: 0,\n    };\n  }\n\n  getVideo(index, headerEndIndex) {\n    if (index < headerEndIndex) {\n      return this.props.cover.headerVideos[index];\n    } else if (index >= 0) {\n      return this.props.cover.videos[index - headerEndIndex];\n    } else {\n      return null;\n    }\n  }\n\n  onVideoClickHandler(index) {\n    const buffer = this.props.cover.headerVideos\n      ? this.props.cover.headerVideos.length\n      : 0;\n    return () => {\n      this.setState({\n        video: index + buffer,\n      });\n    };\n  }\n\n  renderFeature() {\n    const { featureVideo } = this.props.cover;\n    const { featureLang } = this.state;\n    const { translations } = featureVideo;\n    const source =\n      featureLang === 0\n        ? featureVideo\n        : {\n            ...translations[featureLang - 1],\n            poster: featureVideo.poster,\n          };\n\n    return (\n      <div>\n        <div className=\"banner-trans right-overlay\">\n          {translations &&\n            translations.map((trans, idx) => {\n              const langIdx = idx + 1; // default lang idx is 0\n              if (featureLang !== langIdx) {\n                return (\n                  <div\n                    key={trans.code}\n                    onClick={() => this.setState({ featureLang: langIdx })}\n                    className=\"trans-button\"\n                  >\n                    {trans.code}\n                  </div>\n                );\n              } else {\n                return (\n                  <div\n                    key=\"ENG\"\n                    onClick={() => this.setState({ featureLang: 0 })}\n                    className=\"trans-button\"\n                  >\n                    ENG\n                  </div>\n                );\n              }\n            })}\n        </div>\n\n        <Player\n          className=\"source-video\"\n          poster={source.poster}\n          playsInline\n          src={source.file}\n        />\n      </div>\n    );\n  }\n\n  renderHeaderVideos() {\n    const { headerVideos } = this.props.cover;\n    return (\n      <div className=\"row\">\n        {headerVideos.slice(0, 2).map((media, index) => (\n          <div\n            key={index}\n            className=\"cell plain\"\n            onClick={() => this.setState({ video: index })}\n          >\n            {media.buttonTitle}\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  renderButton(button, yellow) {\n    return (\n      <div className=\"row\">\n        <a className={`cell ${yellow ? \"yellow\" : \"plain\"}`} href={button.href}>\n          {button.title}\n        </a>\n      </div>\n    );\n  }\n\n  renderMediaOverlay() {\n    const video = this.getVideo(\n      this.state.video,\n      this.props.cover.headerVideos ? this.props.cover.headerVideos.length : 0\n    );\n    return (\n      <MediaOverlay\n        opaque\n        source={{\n          title: video.title,\n          desc: video.desc,\n          paths: [video.file],\n          poster: video.poster,\n        }}\n        translations={video.translations}\n        onCancel={() => this.setState({ video: MEDIA_HIDDEN })}\n      />\n    );\n  }\n\n  render() {\n    if (!this.props.cover) {\n      return (\n        <div className=\"default-cover-container\">\n          You haven't specified any cover props. Put them in the values that\n          overwrite the store in <code>app.cover</code>\n        </div>\n      );\n    }\n\n    const { videos, footerButton } = this.props.cover;\n    const { showing } = this.props;\n    return (\n      <div className=\"default-cover-container\">\n        <div className={showing ? \"cover-header\" : \"cover-header minimized\"}>\n          <a\n            className=\"cover-logo-container\"\n            href=\"https://forensic-architecture.org\"\n          >\n            {/* <img */}\n            {/*   className=\"cover-logo\" */}\n            {/*   src={falogo} */}\n            {/*   alt=\"Forensic Architecture logo\" */}\n            {/* /> */}\n          </a>\n          <a\n            className=\"cover-logo-container\"\n            href=\"https://github.com/mamagallina\"\n          >\n            <img className=\"cover-logo\" src={bcatlogo} alt=\"Github\" />\n          </a>\n        </div>\n        <div className=\"cover-content\">\n          {this.props.cover.bgVideo ? (\n            <div\n              className={`fullscreen-bg ${!this.props.showing ? \"hidden\" : \"\"}`}\n            >\n              <video\n                loop\n                muted\n                autoPlay\n                preload=\"auto\"\n                className=\"fullscreen-bg__video\"\n              >\n                <source src={this.props.cover.bgVideo} type=\"video/mp4\" />\n              </video>\n            </div>\n          ) : null}\n          <h2\n            style={{ margin: 0 }}\n            dangerouslySetInnerHTML={{ __html: marked(this.props.cover.title) }}\n          />\n          {this.props.cover.subtitle ? (\n            <h3 style={{ marginTop: 0 }}>{this.props.cover.subtitle}</h3>\n          ) : null}\n          {this.props.cover.subsubtitle ? (\n            <h5>{this.props.cover.subsubtitle}</h5>\n          ) : null}\n\n          {this.props.cover.featureVideo ? this.renderFeature() : null}\n          <div className=\"hero thin\">\n            {this.props.cover.headerVideos ? this.renderHeaderVideos() : null}\n            {this.props.cover.headerButton\n              ? this.renderButton(this.props.cover.headerButton)\n              : null}\n            <div className=\"row\">\n              <div className=\"cell yellow\" onClick={this.props.showAppHandler}>\n                {this.props.cover.exploreButton}\n              </div>\n            </div>\n          </div>\n\n          {Array.isArray(this.props.cover.description) ? (\n            this.props.cover.description.map((e, index) => (\n              <div\n                key={index}\n                className=\"md-container\"\n                dangerouslySetInnerHTML={{ __html: marked(e) }}\n              />\n            ))\n          ) : (\n            <div\n              className=\"md-container\"\n              dangerouslySetInnerHTML={{\n                __html: marked(this.props.cover.description),\n              }}\n            />\n          )}\n\n          {videos ? (\n            <div className=\"hero\">\n              <div className=\"row\">\n                {/* NOTE: only take first four videos, drop any others for style reasons */}\n                {videos &&\n                  videos.slice(0, 2).map((media, index) => (\n                    <div\n                      key={index}\n                      className=\"cell small\"\n                      onClick={this.onVideoClickHandler(index)}\n                    >\n                      {media.buttonTitle}\n                      <br />\n                      {media.buttonSubtitle}\n                    </div>\n                  ))}\n              </div>\n              <div className=\"row\">\n                {videos.length > 2 &&\n                  this.props.cover.videos.slice(2, 4).map((media, index) => (\n                    <div\n                      key={index}\n                      className=\"cell small\"\n                      onClick={this.onVideoClickHandler(index + 2)}\n                    >\n                      {media.buttonTitle}\n                      <br />\n                      {media.buttonSubtitle}\n                    </div>\n                  ))}\n              </div>\n            </div>\n          ) : null}\n          {footerButton ? (\n            <div className=\"hero\">\n              <div className=\"row\">{this.renderButton(footerButton)}</div>\n            </div>\n          ) : null}\n        </div>\n\n        {this.state.video !== MEDIA_HIDDEN ? this.renderMediaOverlay() : null}\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    cover: state.app.cover,\n  };\n}\n\nexport default connect(mapStateToProps)(TemplateCover);\n","import React from \"react\";\n\nconst StaticPage = ({ showing, children }) => (\n  <div className={`cover-container ${showing ? \"showing\" : \"\"}`}>\n    {children}\n  </div>\n);\n\nexport default StaticPage;\n","import React from \"react\";\nimport copy from \"../../common/data/copy.json\";\n\nconst LoadingOverlay = ({ isLoading, language }) => {\n  let classes = \"loading-overlay\";\n  classes += !isLoading ? \" hidden\" : \"\";\n\n  return (\n    <div id=\"loading-overlay\" className={classes}>\n      <div className=\"loading-wrapper\">\n        <span id=\"loading-text\" className=\"text\">\n          {copy[language].loading}\n        </span>\n        <div className=\"spinner\">\n          <div className=\"double-bounce1\" />\n          <div className=\"double-bounce2\" />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default LoadingOverlay;\n","import React from \"react\";\nimport { makeNiceDate } from \"../../../common/utilities\";\n\nconst TimelineHeader = ({ title, from, to, onClick, hideInfo }) => {\n  const d0 = from && makeNiceDate(from);\n  const d1 = to && makeNiceDate(to);\n  return (\n    <div className=\"timeline-header\">\n      <div className=\"timeline-toggle\" onClick={() => onClick()}>\n        <p>\n          <i className=\"arrow-down\" />\n        </p>\n      </div>\n      <div className={`timeline-info ${hideInfo ? \"hidden\" : \"\"}`}>\n        <p>{title}</p>\n        <p>\n          {d0} - {d1}\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default TimelineHeader;\n","import React from \"react\";\nimport { axisBottom, timeFormat, select } from \"d3\";\nimport { setD3Locale } from \"../../common/utilities\";\n\nconst TEXT_HEIGHT = 15;\nsetD3Locale();\nclass TimelineAxis extends React.Component {\n  constructor() {\n    super();\n    this.xAxis0Ref = React.createRef();\n    this.xAxis1Ref = React.createRef();\n    this.state = {\n      isInitialized: false,\n    };\n  }\n\n  componentDidUpdate() {\n    let fstFmt, sndFmt;\n\n    // 10yrs\n    if (this.props.extent > 5256000) {\n      fstFmt = \"%Y\";\n      sndFmt = \"\";\n      // 1yr\n    } else if (this.props.extent > 43200) {\n      sndFmt = \"%d %b\";\n      fstFmt = \"\";\n    } else {\n      sndFmt = \"%d %b\";\n      // fstFmt = \"%H:%M\";\n      fstFmt = \"\";\n    }\n\n    const { marginTop, contentHeight } = this.props.dims;\n    if (this.props.scaleX) {\n      this.x0 = axisBottom(this.props.scaleX)\n        .ticks(this.props.ticks)\n        .tickPadding(0)\n        .tickSize(contentHeight - TEXT_HEIGHT - marginTop)\n        .tickFormat(timeFormat(fstFmt));\n\n      this.x1 = axisBottom(this.props.scaleX)\n        .ticks(this.props.ticks)\n        .tickPadding(marginTop)\n        .tickSize(0)\n        .tickFormat(timeFormat(sndFmt));\n\n      if (!this.state.isInitialized) this.setState({ isInitialized: true });\n    }\n\n    if (this.state.isInitialized) {\n      select(this.xAxis0Ref.current)\n        .transition()\n        .duration(this.props.transitionDuration)\n        .call(this.x0);\n\n      select(this.xAxis1Ref.current)\n        .transition()\n        .duration(this.props.transitionDuration)\n        .call(this.x1);\n    }\n  }\n\n  render() {\n    return (\n      <>\n        <g\n          ref={this.xAxis0Ref}\n          transform={`translate(0, ${this.props.dims.marginTop})`}\n          clipPath=\"url(#clip)\"\n          className=\"axis xAxis\"\n        />\n        <g\n          ref={this.xAxis1Ref}\n          transform={`translate(0, ${this.props.dims.marginTop})`}\n          clipPath=\"url(#clip)\"\n          className=\"axis xAxis\"\n        />\n      </>\n    );\n  }\n}\n\nexport default TimelineAxis;\n","import React from \"react\";\n\nconst TimelineClip = ({ dims }) => (\n  <clipPath id=\"clip\">\n    <rect\n      x={dims.marginLeft}\n      y=\"0\"\n      width={Math.max(0, dims.width - dims.marginLeft - dims.width_controls)}\n      height={dims.contentHeight}\n    />\n  </clipPath>\n);\n\nexport default TimelineClip;\n","import React from \"react\";\n\nconst TimelineHandles = ({ dims, onMoveTime }) => {\n  const transform = \"scale(1.5,1.5)\";\n  const size = 45;\n  const handleOffset = dims.contentHeight / 2;\n  return (\n    <g className=\"time-controls-inline\">\n      <g\n        transform={`translate(${dims.marginLeft - 20}, ${handleOffset})`}\n        onClick={() => onMoveTime(\"backwards\")}\n      >\n        <circle r={size} />\n        <path\n          d=\"M0,-7.847549217020565L6.796176979388489,3.9237746085102825L-6.796176979388489,3.9237746085102825Z\"\n          transform={`rotate(270) ${transform}`}\n        />\n      </g>\n      <g\n        transform={`translate(${\n          dims.width - dims.width_controls + 20\n        }, ${handleOffset})`}\n        onClick={() => onMoveTime(\"forward\")}\n      >\n        <circle r={size} />\n        <path\n          d=\"M0,-7.847549217020565L6.796176979388489,3.9237746085102825L-6.796176979388489,3.9237746085102825Z\"\n          transform={`rotate(90) ${transform}`}\n        />\n      </g>\n    </g>\n  );\n};\n\nexport default TimelineHandles;\n","import React from \"react\";\n\nconst DEFAULT_ZOOM_LEVELS = [\n  { label: \"20 years\", duration: 10512000 },\n  { label: \"2 years\", duration: 1051200 },\n  { label: \"3 months\", duration: 129600 },\n  { label: \"3 days\", duration: 4320 },\n  { label: \"12 hours\", duration: 720 },\n  { label: \"1 hour\", duration: 60 },\n];\n\nfunction zoomIsActive(duration, extent, max) {\n  if (duration >= max && extent >= max) {\n    return true;\n  }\n  return duration === extent;\n}\n\nconst TimelineZoomControls = ({ extent, zoomLevels, dims, onApplyZoom }) => {\n  function renderZoom(zoom, idx) {\n    const max = zoomLevels.reduce((acc, vl) =>\n      acc.duration < vl.duration ? vl : acc\n    );\n    const isActive = zoomIsActive(zoom.duration, extent, max.duration);\n    return (\n      <text\n        className={`zoom-level-button ${isActive ? \"active\" : \"\"}`}\n        x=\"60\"\n        y={idx * 15 + 20}\n        onClick={() => onApplyZoom(zoom)}\n        key={idx}\n      >\n        {zoom.label}\n      </text>\n    );\n  }\n\n  if (zoomLevels.length === 0) {\n    zoomLevels = DEFAULT_ZOOM_LEVELS;\n  }\n  return (\n    <g transform={`translate(${dims.width - dims.width_controls}, 0)`}>\n      {zoomLevels.map((z, idx) => renderZoom(z, idx))}\n    </g>\n  );\n};\n\nexport default TimelineZoomControls;\n","import React from \"react\";\nimport colors from \"../../../common/global\";\nimport hash from \"object-hash\";\nimport {\n  getEventCategories,\n  isLatitude,\n  isLongitude,\n} from \"../../../common/utilities\";\nimport { AVAILABLE_SHAPES } from \"../../../common/constants\";\n\nconst TimelineMarkers = ({\n  styles,\n  eventRadius,\n  getEventX,\n  getEventY,\n  categories,\n  transitionDuration,\n  selected,\n  dims,\n  features,\n}) => {\n  function renderMarker(acc, event) {\n    function renderCircle(y) {\n      return (\n        <circle\n          key={hash(event)}\n          className=\"timeline-marker\"\n          cx={0}\n          cy={0}\n          stroke={styles ? styles.stroke : colors.primaryHighlight}\n          strokeOpacity=\"1\"\n          strokeWidth={styles ? styles[\"stroke-width\"] : 1}\n          strokeLinejoin=\"round\"\n          strokeDasharray={styles ? styles[\"stroke-dasharray\"] : \"2,2\"}\n          style={{\n            transform: `translate(${getEventX(event)}px, ${y}px)`,\n            WebkitTransition: `transform ${transitionDuration / 1000}s ease`,\n            MozTransition: \"none\",\n            opacity: 1,\n          }}\n          r={eventRadius * 2}\n        />\n      );\n    }\n    function renderBar() {\n      return (\n        <rect\n          className=\"timeline-marker\"\n          x={0}\n          y={dims.marginTop}\n          width={eventRadius / 1.5}\n          height={dims.contentHeight - 55}\n          stroke={styles ? styles.stroke : colors.primaryHighlight}\n          strokeOpacity=\"1\"\n          strokeWidth={styles ? styles[\"stroke-width\"] : 1}\n          strokeDasharray={styles ? styles[\"stroke-dasharray\"] : \"2,2\"}\n          style={{\n            transform: `translate(${getEventX(event)}px)`,\n            opacity: 0.7,\n          }}\n        />\n      );\n    }\n\n    const isDot =\n      (isLatitude(event.latitude) && isLongitude(event.longitude)) ||\n      (features.GRAPH_NONLOCATED && event.projectOffset !== -1);\n\n    const evShadows = getEventCategories(event, categories).map((cat) =>\n      getEventY({ ...event, category: cat })\n    );\n\n    function renderMarkerForEvent(y) {\n      switch (event.shape) {\n        case \"circle\":\n        case AVAILABLE_SHAPES.DIAMOND:\n        case AVAILABLE_SHAPES.STAR:\n          acc.push(renderCircle(y));\n          break;\n        case AVAILABLE_SHAPES.BAR:\n          acc.push(renderBar(y));\n          break;\n        default:\n          return isDot ? acc.push(renderCircle(y)) : acc.push(renderBar(y));\n      }\n    }\n\n    if (evShadows.length > 0) {\n      evShadows.forEach(renderMarkerForEvent);\n    } else {\n      renderMarkerForEvent(getEventY(event));\n    }\n    return acc;\n  }\n\n  return <g clipPath=\"url(#clip)\">{selected.reduce(renderMarker, [])}</g>;\n};\n\nexport default TimelineMarkers;\n","import React from \"react\";\n\nconst DatetimeBar = ({\n  highlights,\n  events,\n  x,\n  y,\n  width,\n  height,\n  onSelect,\n  styleProps,\n  extraRender,\n}) => {\n  if (highlights.length === 0) {\n    return (\n      <rect\n        onClick={onSelect}\n        className=\"event\"\n        x={x}\n        y={y}\n        style={styleProps}\n        width={width}\n        height={height}\n      />\n    );\n  }\n  const sectionHeight = height / highlights.length;\n  return (\n    <>\n      {highlights.map((h, idx) => (\n        <rect\n          onClick={onSelect}\n          className=\"event\"\n          x={x}\n          y={y - sectionHeight + idx * sectionHeight + sectionHeight / 2}\n          style={{ ...styleProps, opacity: h ? 0.3 : 0.1 }}\n          width={width}\n          height={sectionHeight}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default DatetimeBar;\n","import React from \"react\";\n\nconst DatetimeSquare = ({\n  x,\n  y,\n  r,\n  transform,\n  onSelect,\n  styleProps,\n  extraRender,\n}) => {\n  const center = r / 2;\n  return (\n    <rect\n      onClick={onSelect}\n      className=\"event\"\n      x={x - center}\n      y={y}\n      style={styleProps}\n      width={r}\n      height={r}\n      transform={transform}\n    />\n  );\n};\n\nexport default DatetimeSquare;\n","import React from \"react\";\nimport { isOdd } from \"../../../common/utilities\";\n\nfunction createStar(numPoints, r, x, y) {\n  const innerRadius = r;\n  const outerRadius = (r * 2) / numPoints;\n  const angle = Math.PI / numPoints;\n  const points = [];\n\n  for (let i = 0; i < numPoints * 2; i++) {\n    const radius = isOdd(i) ? innerRadius : outerRadius;\n    points.push(radius * Math.sin(i * angle) + x);\n    points.push(radius * Math.cos(i * angle) + y);\n  }\n\n  return points;\n}\n\nconst DatetimeStar = ({ x, y, r, onSelect, styleProps, extraRender }) => {\n  return (\n    <polygon\n      onClick={onSelect}\n      className=\"event\"\n      x={x}\n      y={y}\n      style={styleProps}\n      points={createStar(5, r, x, y)}\n    />\n  );\n};\n\nexport default DatetimeStar;\n","import React from \"react\";\n\nconst DatetimeTriangle = ({ x, y, r, transform, onSelect, styleProps }) => {\n  const s = (r * 2) / 3;\n  return (\n    <polygon\n      onClick={onSelect}\n      className=\"event\"\n      x={x}\n      y={y}\n      style={styleProps}\n      points={`${x},${y + s} ${x + s},${y - s} ${x - s},${y - s}`}\n      transform={`rotate(180, ${x}, ${y})`}\n    />\n  );\n};\n\nexport default DatetimeTriangle;\n","import React from \"react\";\n\nconst DatetimePentagon = ({ x, y, r, transform, onSelect, styleProps }) => {\n  const s = (r * 2) / 3;\n  return (\n    <polygon\n      onClick={onSelect}\n      className=\"event\"\n      x={x}\n      y={y}\n      style={styleProps}\n      points={`${x},${y + s} ${x + s},${y} ${x + s},${y - s} ${x - s},${\n        y - s\n      } ${x - s},${y}`}\n      transform={`rotate(180, ${x}, ${y})`}\n    />\n  );\n};\n\nexport default DatetimePentagon;\n","import React from \"react\";\n\nconst Project = ({\n  offset,\n  id,\n  start,\n  end,\n  getX,\n  y,\n  dims,\n  colour,\n  eventRadius,\n  onClick,\n}) => {\n  const length = getX(end) - getX(start);\n  if (offset === undefined) return null;\n  return (\n    <rect\n      onClick={onClick}\n      className=\"project\"\n      x={getX(start)}\n      y={dims.marginTop + offset}\n      width={length}\n      style={{ fill: colour, fillOpacity: 0.2 }}\n      height={2 * eventRadius}\n    />\n  );\n};\n\nexport default Project;\n","import React from \"react\";\nimport { getCoordinatesForPercent } from \"../../common/utilities\";\n\nfunction ColoredMarkers({ radius, colorPercentMap, styles, className }) {\n  let cumulativeAngleSweep = 0;\n  const colors = Object.keys(colorPercentMap);\n\n  return (\n    <>\n      {colors.map((color, idx) => {\n        const colorPercent = colorPercentMap[color];\n\n        const [startX, startY] = getCoordinatesForPercent(\n          radius,\n          cumulativeAngleSweep\n        );\n\n        cumulativeAngleSweep += colorPercent;\n\n        const [endX, endY] = getCoordinatesForPercent(\n          radius,\n          cumulativeAngleSweep\n        );\n        // if the slices are less than 2, take the long arc\n        const largeArcFlag = colors.length === 1 || colorPercent > 0.5 ? 1 : 0;\n\n        // create an array and join it just for code readability\n        const arc = [\n          `M ${startX} ${startY}`, // Move\n          `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${endX} ${endY}`, // Arc\n          \"L 0 0 \", // Line\n          `L ${startX} ${startY} Z`, // Line\n        ].join(\" \");\n\n        const extraStyles = {\n          ...styles,\n          fill: color,\n        };\n\n        return (\n          <path\n            key={`arc_${idx}`}\n            className={className}\n            id={`arc_${idx}`}\n            d={arc}\n            style={extraStyles}\n          />\n        );\n      })}\n    </>\n  );\n}\n\nexport default ColoredMarkers;\n","import React from \"react\";\nimport DatetimeBar from \"./DatetimeBar\";\nimport DatetimeSquare from \"./DatetimeSquare\";\nimport DatetimeStar from \"./DatetimeStar\";\nimport DatetimeTriangle from \"./DatetimeTriangle\";\nimport DatetimePentagon from \"./DatetimePentagon\";\nimport Project from \"./Project\";\nimport ColoredMarkers from \"../../atoms/ColoredMarkers\";\nimport {\n  calcOpacity,\n  getEventCategories,\n  zipColorsToPercentages,\n  calculateColorPercentages,\n  isLatitude,\n  isLongitude,\n} from \"../../../common/utilities\";\nimport { AVAILABLE_SHAPES } from \"../../../common/constants\";\n\nfunction renderDot(event, styles, props) {\n  const colorPercentages = calculateColorPercentages(\n    [event],\n    props.coloringSet\n  );\n  return (\n    <g\n      key={event.id}\n      className=\"timeline-event\"\n      onClick={props.onSelect}\n      transform={`translate(${props.x}, ${props.y})`}\n    >\n      <ColoredMarkers\n        radius={props.eventRadius}\n        colorPercentMap={zipColorsToPercentages(\n          props.filterColors,\n          colorPercentages\n        )}\n        styles={{\n          ...styles,\n        }}\n        className=\"event\"\n      />\n    </g>\n  );\n}\n\nfunction renderBar(event, styles, props) {\n  const fillOpacity = props.features.GRAPH_NONLOCATED\n    ? event.projectOffset >= 0\n      ? styles.opacity\n      : 0.5\n    : calcOpacity(1);\n\n  return (\n    <DatetimeBar\n      onSelect={props.onSelect}\n      category={event.category}\n      events={[event]}\n      x={props.x}\n      y={props.dims.marginTop}\n      width={props.eventRadius / 4}\n      height={props.dims.trackHeight}\n      styleProps={{ ...styles, fillOpacity }}\n      highlights={props.highlights}\n    />\n  );\n}\n\nfunction renderDiamond(event, styles, props) {\n  return (\n    <DatetimeSquare\n      onSelect={props.onSelect}\n      x={props.x}\n      y={props.y - props.eventRadius}\n      r={1.8 * props.eventRadius}\n      styleProps={styles}\n      transform={`rotate(45, ${props.x}, ${props.y})`}\n    />\n  );\n}\n\nfunction renderSquare(event, styles, props) {\n  return (\n    <DatetimeSquare\n      onSelect={props.onSelect}\n      x={props.x}\n      y={props.y - (1.8 * props.eventRadius) / 2}\n      r={1.8 * props.eventRadius}\n      styleProps={styles}\n    />\n  );\n}\n\nfunction renderTriangle(event, styles, props) {\n  return (\n    <DatetimeTriangle\n      onSelect={props.onSelect}\n      x={props.x}\n      y={props.y}\n      r={1.5 * props.eventRadius}\n      styleProps={styles}\n    />\n  );\n}\n\nfunction renderPentagon(event, styles, props) {\n  return (\n    <DatetimePentagon\n      onSelect={props.onSelect}\n      x={props.x}\n      y={props.y}\n      r={1.5 * props.eventRadius}\n      styleProps={styles}\n    />\n  );\n}\n\nfunction renderStar(event, styles, props) {\n  return (\n    <DatetimeStar\n      onSelect={props.onSelect}\n      x={props.x}\n      y={props.y}\n      r={1.5 * props.eventRadius}\n      styleProps={{ ...styles, fillRule: \"nonzero\" }}\n    />\n  );\n}\n\nconst TimelineEvents = ({\n  events,\n  projects,\n  categories,\n  narrative,\n  getDatetimeX,\n  getY,\n  getCategoryColor,\n  getHighlights,\n  onSelect,\n  transitionDuration,\n  dims,\n  features,\n  setLoading,\n  setNotLoading,\n  eventRadius,\n  filterColors,\n  coloringSet,\n}) => {\n  const narIds = narrative ? narrative.steps.map((s) => s.id) : [];\n\n  function renderEvent(acc, event) {\n    if (narrative) {\n      if (!narIds.includes(event.id)) {\n        return null;\n      }\n    }\n    const isDot =\n      (isLatitude(event.latitude) && isLongitude(event.longitude)) ||\n      (features.GRAPH_NONLOCATED && event.projectOffset !== -1);\n\n    const { shape: eventShape } = event;\n\n    let renderShape = isDot ? renderDot : renderBar;\n    if (eventShape && eventShape.shape) {\n      if (eventShape.shape === AVAILABLE_SHAPES.BAR) {\n        renderShape = renderBar;\n      } else if (eventShape.shape === AVAILABLE_SHAPES.DIAMOND) {\n        renderShape = renderDiamond;\n      } else if (eventShape.shape === AVAILABLE_SHAPES.STAR) {\n        renderShape = renderStar;\n      } else if (eventShape.shape === AVAILABLE_SHAPES.TRIANGLE) {\n        renderShape = renderTriangle;\n      } else if (eventShape.shape === AVAILABLE_SHAPES.PENTAGON) {\n        renderShape = renderPentagon;\n      } else if (eventShape.shape === AVAILABLE_SHAPES.SQUARE) {\n        renderShape = renderSquare;\n      } else {\n        renderShape = renderDot;\n      }\n    }\n\n    // if an event has multiple categories, it should be rendered on each of\n    // those timelines: so we create as many event 'shadows' as there are\n    // categories\n    const evShadows = getEventCategories(event, categories).map((cat) => {\n      const y = getY({ ...event, category: cat });\n\n      const colour = event.colour ? event.colour : getCategoryColor(cat.title);\n\n      const styles = {\n        fill: colour,\n        fillOpacity: y > 0 ? calcOpacity(1) : 0,\n        transition: `transform ${transitionDuration / 1000}s ease`,\n      };\n\n      return { y, styles };\n    });\n\n    function getRender(y, styles) {\n      return renderShape(event, styles, {\n        x: getDatetimeX(event.datetime),\n        y,\n        eventRadius,\n        onSelect: () => onSelect(event),\n        dims,\n        highlights: features.HIGHLIGHT_GROUPS\n          ? getHighlights(\n              event.filters[\n                features.HIGHLIGHT_GROUPS.filterIndexIndicatingGroup\n              ]\n            )\n          : [],\n        features,\n        filterColors,\n        coloringSet,\n      });\n    }\n\n    if (evShadows.length === 0) {\n      acc.push(getRender(getY(event), { fill: getCategoryColor(null) }));\n    } else {\n      evShadows.forEach((evShadow) => {\n        acc.push(getRender(evShadow.y, evShadow.styles));\n      });\n    }\n    return acc;\n  }\n\n  let renderProjects = () => null;\n  if (features.GRAPH_NONLOCATED) {\n    renderProjects = function () {\n      return (\n        <>\n          {Object.values(projects).map((project) => (\n            <Project\n              key={project.id}\n              {...project}\n              eventRadius={eventRadius}\n              onClick={() => console.log(project)}\n              getX={getDatetimeX}\n              dims={dims}\n              colour={getCategoryColor(project.category)}\n            />\n          ))}\n        </>\n      );\n    };\n  }\n\n  return (\n    <g clipPath=\"url(#clip)\">\n      {renderProjects()}\n      {events.reduce(renderEvent, [])}\n    </g>\n  );\n};\n\nexport default TimelineEvents;\n","import React from \"react\";\nimport { drag as d3Drag, select } from \"d3\";\n\nclass TimelineCategories extends React.Component {\n  constructor(props) {\n    super(props);\n    this.grabRef = React.createRef();\n    this.state = {\n      isInitialized: false,\n    };\n  }\n\n  componentDidUpdate() {\n    if (!this.state.isInitialized) {\n      const drag = d3Drag()\n        .on(\"start\", this.props.onDragStart)\n        .on(\"drag\", this.props.onDrag)\n        .on(\"end\", this.props.onDragEnd);\n\n      select(this.grabRef.current).call(drag);\n\n      this.setState({ isInitialized: true });\n    }\n  }\n\n  renderCategory(cat, idx) {\n    const { features, dims } = this.props;\n    const strokeWidth = 1; // dims.trackHeight / (this.props.categories.length + 1)\n    if (\n      features.GRAPH_NONLOCATED &&\n      features.GRAPH_NONLOCATED.categories &&\n      features.GRAPH_NONLOCATED.categories.includes(cat)\n    ) {\n      return null;\n    }\n\n    return (\n      <>\n        <g\n          className=\"tick\"\n          style={{ strokeWidth }}\n          opacity=\"0.5\"\n          transform={`translate(0,${this.props.getCategoryY(cat)})`}\n        >\n          <line x1={dims.marginLeft} x2={dims.width - dims.width_controls} />\n        </g>\n        <g\n          className=\"tick\"\n          opacity=\"1\"\n          transform={`translate(0,${this.props.getCategoryY(cat)})`}\n        >\n          <text x={dims.marginLeft - 5} dy=\"0.32em\">\n            {cat}\n          </text>\n        </g>\n      </>\n    );\n  }\n\n  render() {\n    const { dims, categories, fallbackLabel } = this.props;\n    const categoriesExist = categories && categories.length > 0;\n    const renderedCategories = categoriesExist\n      ? categories.map((cat, idx) => this.renderCategory(cat, idx))\n      : this.renderCategory(fallbackLabel, 0);\n\n    return (\n      <g className=\"yAxis\">\n        {renderedCategories}\n        <rect\n          ref={this.grabRef}\n          className=\"drag-grabber\"\n          x={dims.marginLeft}\n          y={dims.marginTop}\n          width={Math.max(\n            0,\n            dims.width - dims.marginLeft - dims.width_controls\n          )}\n          height={dims.contentHeight}\n        />\n      </g>\n    );\n  }\n}\n\nexport default TimelineCategories;\n","import React from \"react\";\nimport { bindActionCreators } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { scaleTime, timeMinute, timeSecond } from \"d3\";\nimport hash from \"object-hash\";\n\nimport { setLoading, setNotLoading, updateTicks } from \"../../actions\";\nimport * as selectors from \"../../selectors\";\nimport copy from \"../../common/data/copy.json\";\n\nimport Header from \"./atoms/Header\";\nimport Axis from \"./Axis\";\nimport Clip from \"./atoms/Clip\";\nimport Handles from \"./atoms/Handles.js\";\nimport ZoomControls from \"./atoms/ZoomControls.js\";\nimport Markers from \"./atoms/Markers.js\";\nimport Events from \"./atoms/Events.js\";\nimport Categories from \"./Categories\";\n\nclass Timeline extends React.Component {\n  constructor(props) {\n    super(props);\n    this.styleDatetime = this.styleDatetime.bind(this);\n    this.getDatetimeX = this.getDatetimeX.bind(this);\n    this.getY = this.getY.bind(this);\n    this.onApplyZoom = this.onApplyZoom.bind(this);\n    this.onSelect = this.onSelect.bind(this);\n    this.onDragStart = this.onDragStart.bind(this);\n    this.onDrag = this.onDrag.bind(this);\n    this.onDragEnd = this.onDragEnd.bind(this);\n    this.svgRef = React.createRef();\n    this.state = {\n      isFolded: false,\n      dims: props.dimensions,\n      scaleX: null,\n      scaleY: null,\n      timerange: [null, null], // two datetimes\n      dragPos0: null,\n      transitionDuration: 300,\n    };\n  }\n\n  componentDidMount() {\n    this.addEventListeners();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (hash(nextProps) !== hash(this.props)) {\n      this.setState({\n        timerange: nextProps.app.timeline.range,\n        scaleX: this.makeScaleX(),\n      });\n    }\n\n    if (\n      hash(nextProps.activeCategories) !== hash(this.props.activeCategories) ||\n      hash(nextProps.dimensions) !== hash(this.props.dimensions)\n    ) {\n      const { trackHeight, marginTop } = nextProps.dimensions;\n      this.setState({\n        scaleY: this.makeScaleY(\n          nextProps.activeCategories,\n          trackHeight,\n          marginTop\n        ),\n      });\n    }\n\n    if (\n      nextProps.dimensions.trackHeight !== this.props.dimensions.trackHeight\n    ) {\n      this.computeDims();\n    }\n\n    // nextProps.domain.events.forEach(e => {\n    // });\n    // this.props.methods.onSelect()\n  }\n\n  addEventListeners() {\n    window.addEventListener(\"resize\", () => {\n      this.computeDims();\n    });\n    const element = document.querySelector(\".timeline-wrapper\");\n    if (element !== null) {\n      element.addEventListener(\"transitionend\", (event) => {\n        this.computeDims();\n      });\n    }\n  }\n\n  makeScaleX() {\n    return scaleTime()\n      .domain(this.state.timerange)\n      .range([\n        this.state.dims.marginLeft,\n        this.state.dims.width - this.state.dims.width_controls,\n      ]);\n  }\n\n  makeScaleY(categories, trackHeight, marginTop) {\n    const { features } = this.props;\n    if (features.GRAPH_NONLOCATED && features.GRAPH_NONLOCATED.categories) {\n      categories = categories.filter(\n        (cat) => !features.GRAPH_NONLOCATED.categories.includes(cat.title)\n      );\n    }\n\n    const extraPadding = 0;\n    const catHeight =\n      categories.length > 2\n        ? trackHeight / categories.length\n        : trackHeight / (categories.length + 1);\n    const catsYpos = categories.map((g, i) => {\n      return (i + 1) * catHeight + marginTop + extraPadding / 2;\n    });\n\n    return (cat) => {\n      const idx = categories.indexOf(cat);\n      return catsYpos[idx];\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.timerange !== this.state.timerange) {\n      this.setState({ scaleX: this.makeScaleX() });\n    }\n  }\n\n  /**\n   * Returns the time scale (x) extent in minutes\n   */\n  getTimeScaleExtent() {\n    if (!this.state.scaleX) return 0;\n    const timeDomain = this.state.scaleX.domain();\n    return (timeDomain[1].getTime() - timeDomain[0].getTime()) / 60000;\n  }\n\n  onClickArrow() {\n    this.setState((prevState) => {\n      return { isFolded: !prevState.isFolded };\n    });\n  }\n\n  computeDims() {\n    const dom = this.props.ui.dom.timeline;\n    if (document.querySelector(`#${dom}`) !== null) {\n      const boundingClient = document\n        .querySelector(`#${dom}`)\n        .getBoundingClientRect();\n\n      this.setState(\n        {\n          dims: {\n            ...this.props.dimensions,\n            width: boundingClient.width,\n          },\n        },\n        () => {\n          this.setState({ scaleX: this.makeScaleX() });\n        }\n      );\n    }\n  }\n\n  /**\n   * Shift time range by moving forward or backwards\n   * @param {String} direction: 'forward' / 'backwards'\n   */\n  onMoveTime(direction) {\n    const extent = this.getTimeScaleExtent();\n    const newCentralTime = timeMinute.offset(\n      this.state.scaleX.domain()[0],\n      extent\n    );\n\n    // if forward\n    let domain0 = newCentralTime;\n    let domainF = timeMinute.offset(newCentralTime, extent);\n\n    // if backwards\n    if (direction === \"backwards\") {\n      domain0 = timeMinute.offset(newCentralTime, -(2 * extent));\n      domainF = timeMinute.offset(newCentralTime, -extent);\n    }\n\n    this.props.methods.onUpdateTimerange([domain0, domainF]);\n    this.props.methods.onSelect([]);\n  }\n\n  onCenterTime(newCentralTime) {\n    const extent = this.getTimeScaleExtent();\n\n    const domain0 = timeMinute.offset(newCentralTime, -extent / 2);\n    const domainF = timeMinute.offset(newCentralTime, +extent / 2);\n\n    this.setState({ timerange: [domain0, domainF] }, () => {\n      this.props.methods.onUpdateTimerange(this.state.timerange);\n    });\n  }\n\n  /**\n   * Change display of time range\n   * WITHOUT updating the store, or data shown.\n   * Used for updates in the middle of a transition, for performance purposes\n   */\n  onSoftTimeRangeUpdate(timerange) {\n    this.setState({ timerange });\n  }\n\n  /**\n   * Apply zoom level to timeline\n   * @param {object} zoom: zoom level from zoomLevels\n   */\n  onApplyZoom(zoom) {\n    const extent = this.getTimeScaleExtent();\n    const newCentralTime = timeMinute.offset(\n      this.state.scaleX.domain()[0],\n      extent / 2\n    );\n    const { rangeLimits } = this.props.app.timeline;\n\n    let newDomain0 = timeMinute.offset(newCentralTime, -zoom.duration / 2);\n    let newDomainF = timeMinute.offset(newCentralTime, zoom.duration / 2);\n\n    if (rangeLimits) {\n      // If the store contains absolute time limits,\n      // make sure the zoom doesn't go over them\n      const minDate = rangeLimits[0];\n      const maxDate = rangeLimits[1];\n\n      if (newDomain0 < minDate) {\n        newDomain0 = minDate;\n        newDomainF = timeMinute.offset(newDomain0, zoom.duration);\n      }\n      if (newDomainF > maxDate) {\n        newDomainF = maxDate;\n        newDomain0 = timeMinute.offset(newDomainF, -zoom.duration);\n      }\n    }\n\n    this.setState(\n      {\n        timerange: [newDomain0, newDomainF],\n      },\n      () => {\n        this.props.actions.updateTicks(15);\n        this.props.methods.onUpdateTimerange(this.state.timerange);\n      }\n    );\n  }\n\n  toggleTransition(isTransition) {\n    this.setState({ transitionDuration: isTransition ? 300 : 0 });\n  }\n\n  /*\n   * Setup drag behavior\n   */\n  onDragStart(event) {\n    event.sourceEvent.stopPropagation();\n    this.setState(\n      {\n        dragPos0: event.x,\n      },\n      () => {\n        this.toggleTransition(false);\n      }\n    );\n  }\n\n  /*\n   * Drag and update\n   */\n  onDrag(event) {\n    const drag0 = this.state.scaleX.invert(this.state.dragPos0).getTime();\n    const dragNow = this.state.scaleX.invert(event.x).getTime();\n    const timeShift = (drag0 - dragNow) / 1000;\n\n    const { range, rangeLimits } = this.props.app.timeline;\n    let newDomain0 = timeSecond.offset(range[0], timeShift);\n    let newDomainF = timeSecond.offset(range[1], timeShift);\n\n    if (rangeLimits) {\n      // If the store contains absolute time limits,\n      // make sure the zoom doesn't go over them\n      const minDate = rangeLimits[0];\n      const maxDate = rangeLimits[1];\n\n      newDomain0 = newDomain0 < minDate ? minDate : newDomain0;\n      newDomainF = newDomainF > maxDate ? maxDate : newDomainF;\n    }\n\n    // Updates components without updating timerange\n    this.onSoftTimeRangeUpdate([newDomain0, newDomainF]);\n  }\n\n  /**\n   * Stop dragging and update data\n   */\n  onDragEnd() {\n    this.toggleTransition(true);\n    this.props.methods.onUpdateTimerange(this.state.timerange);\n  }\n\n  getDatetimeX(datetime) {\n    return this.state.scaleX(datetime);\n  }\n\n  getY(event) {\n    const { features, domain, activeCategories } = this.props;\n    const { USE_CATEGORIES, GRAPH_NONLOCATED } = features;\n\n    const categoriesExist =\n      USE_CATEGORIES && activeCategories && activeCategories.length > 0;\n\n    if (!categoriesExist) {\n      return this.state.dims.trackHeight / 1.5;\n    }\n\n    const { category } = event;\n\n    if (GRAPH_NONLOCATED && GRAPH_NONLOCATED.categories.includes(category)) {\n      const { project } = event;\n      return (\n        this.state.dims.marginTop +\n        domain.projects[project].offset +\n        this.props.ui.eventRadius\n      );\n    }\n    if (!this.state.scaleY) return 0;\n\n    return this.state.scaleY(category);\n  }\n\n  /**\n   * Determines additional styles on the <circle> for each location.\n   * A location consists of an array of events (see selectors). The function\n   * also has full access to the domain and redux state to derive values if\n   * necessary. The function should return an array, where the value at the\n   * first index is a styles object for the SVG at the location, and the value\n   * at the second index is an optional additional component that renders in\n   * the <g/> div.\n   */\n  styleDatetime(timestamp, category) {\n    return [null, null];\n  }\n\n  onSelect(event) {\n    if (this.props.features.ZOOM_TO_TIMEFRAME_ON_TIMELINE_CLICK) {\n      const timeframe = Math.floor(\n        this.props.features.ZOOM_TO_TIMEFRAME_ON_TIMELINE_CLICK / 2\n      );\n      const start = timeMinute.offset(event.datetime, -timeframe);\n      const end = timeMinute.offset(event.datetime, timeframe);\n      this.props.actions.updateTicks(1);\n      this.props.methods.onUpdateTimerange([start, end]);\n    }\n    this.props.methods.onSelect(event);\n  }\n\n  render() {\n    const { isNarrative, app, domain } = this.props;\n\n    let classes = `timeline-wrapper ${this.state.isFolded ? \" folded\" : \"\"}`;\n    classes += app.narrative !== null ? \" narrative-mode\" : \"\";\n    const { dims } = this.state;\n    const foldedStyle = {\n      bottom: this.state.isFolded ? -dims.height : 0,\n      left: 110,\n    };\n    const heightStyle = { height: dims.height };\n    const extraStyle = { ...heightStyle, ...foldedStyle };\n    const contentHeight = { height: dims.contentHeight };\n    const { activeCategories: categories } = this.props;\n\n    const title = copy[this.props.app.language].timeline.info.replace(\n      \"%n\",\n      domain.eventCountInTimeRange\n    );\n\n    return (\n      <div\n        className={classes}\n        style={extraStyle}\n        onKeyDown={this.props.onKeyDown}\n        tabIndex=\"1\"\n      >\n        <Header\n          title={title}\n          from={this.state.timerange[0]}\n          to={this.state.timerange[1]}\n          onClick={() => {\n            this.onClickArrow();\n          }}\n          hideInfo={isNarrative}\n        />\n        <div className=\"timeline-content\" style={heightStyle}>\n          <div\n            id={this.props.ui.dom.timeline}\n            className=\"timeline\"\n            style={contentHeight}\n          >\n            <svg ref={this.svgRef} width={dims.width} style={contentHeight}>\n              <Clip dims={dims} />\n              <Axis\n                ticks={app.timeline.dimensions.ticks}\n                dims={dims}\n                extent={this.getTimeScaleExtent()}\n                transitionDuration={this.state.transitionDuration}\n                scaleX={this.state.scaleX}\n              />\n              <Categories\n                dims={dims}\n                getCategoryY={(category) =>\n                  this.getY({ category, project: null })\n                }\n                onDragStart={this.onDragStart}\n                onDrag={this.onDrag}\n                onDragEnd={this.onDragEnd}\n                categories={categories}\n                features={this.props.features}\n                fallbackLabel={\n                  copy[this.props.app.language].timeline\n                    .default_categories_label\n                }\n              />\n              {app.timeline.dimensions.ticks === 1 && (\n                <Handles\n                  dims={dims}\n                  onMoveTime={(dir) => {\n                    this.onMoveTime(dir);\n                  }}\n                />\n              )}\n              <ZoomControls\n                extent={this.getTimeScaleExtent()}\n                zoomLevels={this.props.app.timeline.zoomLevels}\n                dims={dims}\n                onApplyZoom={this.onApplyZoom}\n              />\n              <Markers\n                dims={dims}\n                selected={this.props.app.selected}\n                getEventX={(ev) => this.getDatetimeX(ev.datetime)}\n                getEventY={this.getY}\n                categories={categories}\n                transitionDuration={this.state.transitionDuration}\n                styles={this.props.ui.styles}\n                features={this.props.features}\n                eventRadius={this.props.ui.eventRadius}\n              />\n              <Events\n                events={this.props.domain.events}\n                projects={this.props.domain.projects}\n                categories={categories}\n                styleDatetime={this.styleDatetime}\n                narrative={this.props.app.narrative}\n                getDatetimeX={this.getDatetimeX}\n                getY={this.getY}\n                getHighlights={(group) => {\n                  if (group === \"None\") {\n                    return [];\n                  }\n                  return categories.map((c) => c.group === group);\n                }}\n                getCategoryColor={this.props.methods.getCategoryColor}\n                transitionDuration={this.state.transitionDuration}\n                onSelect={this.onSelect}\n                dims={dims}\n                features={this.props.features}\n                setLoading={this.props.actions.setLoading}\n                setNotLoading={this.props.actions.setNotLoading}\n                eventRadius={this.props.ui.eventRadius}\n                filterColors={this.props.ui.filterColors}\n                coloringSet={this.props.app.coloringSet}\n              />\n            </svg>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    dimensions: selectors.selectDimensions(state),\n    isNarrative: !!state.app.associations.narrative,\n    activeCategories: selectors.getActiveCategories(state),\n    domain: {\n      events: selectors.selectStackedEvents(state),\n      eventCountInTimeRange: selectors.selectEventCountInTimeRange(state),\n      projects: selectors.selectProjects(state),\n      narratives: state.domain.narratives,\n    },\n    app: {\n      selected: state.app.selected,\n      language: state.app.language,\n      timeline: state.app.timeline,\n      narrative: state.app.associations.narrative,\n      coloringSet: state.app.associations.coloringSet,\n    },\n    ui: {\n      dom: state.ui.dom,\n      styles: state.ui.style.selectedEvents,\n      eventRadius: state.ui.eventRadius,\n      filterColors: state.ui.coloring.colors,\n    },\n    features: selectors.getFeatures(state),\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      { setLoading, setNotLoading, updateTicks },\n      dispatch\n    ),\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Timeline);\n","import React from \"react\";\n\nfunction MapSites({ sites, projectPoint }) {\n  function renderSite(site) {\n    const { x, y } = projectPoint([site.latitude, site.longitude]);\n\n    return (\n      <div\n        className=\"leaflet-tooltip site-label leaflet-zoom-animated leaflet-tooltip-top\"\n        style={{\n          opacity: 1,\n          transform: `translate3d(calc(${x}px - 50%), ${y - 25}px, 0px)`,\n        }}\n      >\n        {site.site}\n      </div>\n    );\n  }\n\n  if (!sites || !sites.length) return null;\n\n  return <div className=\"sites-layer\">{sites.map(renderSite)}</div>;\n}\n\nexport default MapSites;\n","import React from \"react\";\nimport { Portal } from \"react-portal\";\n\nfunction MapRegions({ svg, regions, projectPoint, styles }) {\n  function renderRegion(region) {\n    const lineCoords = [];\n    const points = region.points.map(projectPoint);\n\n    points.forEach((p1, idx) => {\n      if (idx < region.points.length - 1) {\n        const p2 = points[idx + 1];\n        lineCoords.push({\n          x1: p1.x,\n          y1: p1.y,\n          x2: p2.x,\n          y2: p2.y,\n        });\n      }\n    });\n\n    return lineCoords.map((coords) => {\n      const regionstyles =\n        region.name in styles ? styles[region.name] : styles.default;\n\n      return (\n        <line\n          id={`${region.name}_style`}\n          markerStart=\"none\"\n          {...coords}\n          style={regionstyles}\n        />\n      );\n    });\n  }\n\n  if (!regions || !regions.length) return null;\n\n  return (\n    <Portal node={svg}>\n      <g id=\"regions-layer\" className=\"narrative\">\n        {regions.map(renderRegion)}\n      </g>\n    </Portal>\n  );\n}\n\nexport default MapRegions;\n","import React from \"react\";\nimport { Portal } from \"react-portal\";\nimport colors from \"../../../../common/global\";\nimport ColoredMarkers from \"../../../atoms/ColoredMarkers\";\nimport hash from \"object-hash\";\nimport {\n  calcOpacity,\n  calculateColorPercentages,\n  zipColorsToPercentages,\n} from \"../../../../common/utilities\";\n\nfunction MapEvents({\n  getCategoryColor,\n  categories,\n  projectPoint,\n  styleLocation,\n  selected,\n  narrative,\n  onSelect,\n  svg,\n  locations,\n  eventRadius,\n  coloringSet,\n  filterColors,\n  features,\n}) {\n  function handleEventSelect(e, location) {\n    const events = e.shiftKey\n      ? selected.concat(location.events)\n      : location.events;\n    onSelect(events);\n  }\n\n  function renderLocationSlicesByAssociation(location) {\n    const colorPercentages = calculateColorPercentages([location], coloringSet);\n\n    const styles = {\n      stroke: colors.darkBackground,\n      strokeWidth: 0,\n      fillOpacity: narrative ? 1 : calcOpacity(location.events.length),\n    };\n\n    return (\n      <ColoredMarkers\n        radius={eventRadius}\n        colorPercentMap={zipColorsToPercentages(filterColors, colorPercentages)}\n        styles={{\n          ...styles,\n        }}\n        className=\"location-event-marker\"\n      />\n    );\n  }\n\n  function renderLocation(location) {\n    /**\n    {\n      events: [...],\n      label: 'Location name',\n      latitude: '47.7',\n      longitude: '32.2'\n    }\n    */\n    if (!location.latitude || !location.longitude) return null;\n    const { x, y } = projectPoint([location.latitude, location.longitude]);\n\n    // in narrative mode, only render events in narrative\n    // TODO: move this to a selector\n    if (narrative) {\n      const { steps } = narrative;\n      const onlyIfInNarrative = (e) => steps.map((s) => s.id).includes(e.id);\n      const eventsInNarrative = location.events.filter(onlyIfInNarrative);\n\n      if (eventsInNarrative.length <= 0) {\n        return null;\n      }\n    }\n\n    const customStyles = styleLocation ? styleLocation(location) : null;\n    const extraRender = () => <>{customStyles[1]}</>;\n\n    const isSelected = selected.reduce((acc, event) => {\n      return (\n        acc ||\n        (event.latitude === location.latitude &&\n          event.longitude === location.longitude)\n      );\n    }, false);\n\n    return (\n      <svg key={hash(location)}>\n        <g\n          className={`location-event ${narrative ? \"no-hover\" : \"\"}`}\n          transform={`translate(${x}, ${y})`}\n          onClick={(e) => handleEventSelect(e, location)}\n        >\n          {renderLocationSlicesByAssociation(location)}\n          {extraRender ? extraRender() : null}\n          <circle\n            className=\"event-hover\"\n            display={isSelected ? \"auto\" : \"none\"}\n            cx=\"0\"\n            cy=\"0\"\n            r=\"10\"\n            stroke={colors.primaryHighlight}\n            fillOpacity=\"0.0\"\n          />\n        </g>\n      </svg>\n    );\n  }\n\n  return (\n    <Portal node={svg}>\n      <svg>\n        <g className=\"event-locations\">{locations.map(renderLocation)}</g>\n      </svg>\n    </Portal>\n  );\n}\n\nexport default MapEvents;\n","import React, { useState } from \"react\";\nimport { Portal } from \"react-portal\";\nimport colors from \"../../../../common/global\";\nimport ColoredMarkers from \"../../../atoms/ColoredMarkers\";\nimport {\n  calcClusterOpacity,\n  calcClusterSize,\n  isLatitude,\n  isLongitude,\n  calculateColorPercentages,\n  zipColorsToPercentages,\n  calculateTotalClusterPoints,\n} from \"../../../../common/utilities\";\n\nconst DefsClusters = () => (\n  <defs>\n    <radialGradient id=\"clusterGradient\">\n      <stop offset=\"10%\" stop-color=\"red\" />\n      <stop offset=\"90%\" stop-color=\"transparent\" />\n    </radialGradient>\n  </defs>\n);\n\nfunction Cluster({\n  cluster,\n  size,\n  projectPoint,\n  totalPoints,\n  styles,\n  renderHover,\n  onClick,\n  getClusterChildren,\n  coloringSet,\n  filterColors,\n}) {\n  /**\n  {\n    geometry: {\n      coordinates: [longitude, latitude]\n    },\n    properties: {\n      cluster: true|false,\n      cluster_id: int,\n      point_count: int,\n      point_count_abbreviated: int\n    },\n    type: \"Feature\"\n  }\n  */\n  const { cluster_id: clusterId } = cluster.properties;\n\n  const individualChildren = getClusterChildren(clusterId);\n  const colorPercentages = calculateColorPercentages(\n    individualChildren,\n    coloringSet\n  );\n\n  const { coordinates } = cluster.geometry;\n  const [longitude, latitude] = coordinates;\n  const { x, y } = projectPoint([latitude, longitude]);\n  const [hovered, setHovered] = useState(false);\n  if (!isLatitude(latitude) || !isLongitude(longitude)) return null;\n\n  return (\n    <svg>\n      <g\n        className=\"cluster-event\"\n        transform={`translate(${x}, ${y})`}\n        onClick={(e) => onClick({ id: clusterId, latitude, longitude })}\n        onMouseEnter={() => setHovered(true)}\n        onMouseLeave={() => setHovered(false)}\n      >\n        <ColoredMarkers\n          radius={size}\n          colorPercentMap={zipColorsToPercentages(\n            filterColors,\n            colorPercentages\n          )}\n          styles={{\n            ...styles,\n          }}\n          className=\"cluster-event-marker\"\n        />\n        {hovered ? renderHover(cluster) : null}\n      </g>\n    </svg>\n  );\n}\n\nfunction ClusterEvents({\n  projectPoint,\n  onSelect,\n  getClusterChildren,\n  coloringSet,\n  isRadial,\n  svg,\n  clusters,\n  filterColors,\n  selected,\n}) {\n  const totalPoints = calculateTotalClusterPoints(clusters);\n\n  const styles = {\n    fill: isRadial ? \"url('#clusterGradient')\" : colors.fallbackEventColor,\n    stroke: colors.darkBackground,\n    strokeWidth: 0,\n  };\n\n  function renderHover(txt, circleSize) {\n    return (\n      <>\n        <text\n          textAnchor=\"middle\"\n          y=\"3px\"\n          style={{ fontWeight: \"bold\", fill: \"black\", zIndex: 10000 }}\n        >\n          {txt}\n        </text>\n        <circle\n          className=\"event-hover\"\n          cx=\"0\"\n          cy=\"0\"\n          r={circleSize + 2}\n          stroke={colors.primaryHighlight}\n          fillOpacity=\"0.0\"\n        />\n      </>\n    );\n  }\n\n  return (\n    <Portal node={svg}>\n      <svg>\n        <g className=\"cluster-locations\">\n          {isRadial ? <DefsClusters /> : null}\n          {clusters.map((c, idx) => {\n            const pointCount = c.properties.point_count;\n            const clusterSize = calcClusterSize(pointCount, totalPoints);\n            return (\n              <Cluster\n                key={idx}\n                onClick={onSelect}\n                getClusterChildren={getClusterChildren}\n                coloringSet={coloringSet}\n                cluster={c}\n                filterColors={filterColors}\n                size={clusterSize}\n                projectPoint={projectPoint}\n                totalPoints={totalPoints}\n                styles={{\n                  ...styles,\n                  fillOpacity: calcClusterOpacity(pointCount, totalPoints),\n                }}\n                renderHover={() => renderHover(pointCount, clusterSize)}\n              />\n            );\n          })}\n        </g>\n      </svg>\n    </Portal>\n  );\n}\n\nexport default ClusterEvents;\n","import React from \"react\";\nimport { Portal } from \"react-portal\";\nimport colors from \"../../../../common/global\";\nimport hash from \"object-hash\";\n\nclass MapSelectedEvents extends React.Component {\n  renderMarker(marker) {\n    const { x, y } = this.props.projectPoint([\n      marker.latitude,\n      marker.longitude,\n    ]);\n    const styles = this.props.styles;\n    const r = marker.radius ? marker.radius + 5 : 24;\n    return (\n      <g\n        key={hash(marker)}\n        className=\"location-marker\"\n        transform={`translate(${x - r}, ${y})`}\n      >\n        <path\n          className=\"leaflet-interactive\"\n          stroke={styles ? styles.stroke : colors.primaryHighlight}\n          strokeOpacity=\"1\"\n          strokeWidth={styles ? styles[\"stroke-width\"] : 2}\n          strokeLinecap=\"\"\n          strokeLinejoin=\"round\"\n          strokeDasharray={styles ? styles[\"stroke-dasharray\"] : \"2,2\"}\n          fill=\"none\"\n          d={`M0,0a${r},${r} 0 1,0 ${r * 2},0 a${r},${r} 0 1,0 -${r * 2},0 `}\n        />\n      </g>\n    );\n  }\n\n  render() {\n    return (\n      <Portal node={this.props.svg}>\n        {this.props.selected.map((s) => this.renderMarker(s))}\n      </Portal>\n    );\n  }\n}\nexport default MapSelectedEvents;\n","import React from \"react\";\nimport { Portal } from \"react-portal\";\n// import { concatStatic } from 'rxjs/operator/concat'\n// import { single } from 'rxjs/operator/single'\n\nconst defaultStyles = {\n  strokeOpacity: 1,\n  strokeWidth: 0,\n  strokeDasharray: \"none\",\n  stroke: \"none\",\n};\n\nfunction MapNarratives({\n  styles,\n  onSelectNarrative,\n  svg,\n  narrative,\n  narratives,\n  projectPoint,\n  features,\n}) {\n  function getNarrativeStyle(narrativeId) {\n    const styleName =\n      narrativeId && narrativeId in styles ? narrativeId : \"default\";\n    return styles[styleName];\n  }\n\n  const narrativesExist = narratives && narratives.length !== 0;\n\n  function hasNoLocation(step) {\n    return step.latitude === \"\" || step.longitude === \"\";\n  }\n\n  function _renderNarrativeStepArrow(p1, p2, styles) {\n    const distance = Math.sqrt(\n      (p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y)\n    );\n    const theta = Math.atan2(p2.y - p1.y, p2.x - p1.x); // Angle of narrative step line\n    const alpha = Math.atan2(1, 2); // Angle of arrow overture\n    const edge = 10; // Arrow edge length\n    const offset = distance < 24 ? distance / 2 : 24;\n\n    // Arrow corners\n    const coord0 = {\n      x: p2.x - offset * Math.cos(theta),\n      y: p2.y - offset * Math.sin(theta),\n    };\n    const coord1 = {\n      x: coord0.x - edge * Math.cos(-theta - alpha),\n      y: coord0.y + edge * Math.sin(-theta - alpha),\n    };\n    const coord2 = {\n      x: coord0.x - edge * Math.cos(-theta + alpha),\n      y: coord0.y + edge * Math.sin(-theta + alpha),\n    };\n\n    return (\n      <path\n        className=\"narrative-step-arrow\"\n        d={`\n        M ${coord0.x} ${coord0.y}\n        L ${coord1.x} ${coord1.y}\n        L ${coord2.x} ${coord2.y} Z\n      `}\n        style={{\n          ...styles,\n          fillOpacity: styles.strokeOpacity,\n          fill: styles.stroke,\n        }}\n      />\n    );\n  }\n\n  function _renderNarrativeStep(p1, p2, styles) {\n    const { stroke, strokeWidth, strokeDasharray, strokeOpacity } = styles;\n\n    return (\n      <g>\n        <line\n          className=\"narrative-step\"\n          x1={p1.x}\n          x2={p2.x}\n          y1={p1.y}\n          y2={p2.y}\n          markerStart=\"none\"\n          onClick={(n) => onSelectNarrative(n)}\n          style={{\n            strokeWidth,\n            strokeDasharray,\n            strokeOpacity,\n            stroke,\n          }}\n        />\n        {stroke !== \"none\" ? _renderNarrativeStepArrow(p1, p2, styles) : \"\"}\n      </g>\n    );\n  }\n\n  function renderBetweenSteps(step1, step2, extraStyles) {\n    // don't draw if one of the steps has no location, or not in narrative\n    if (hasNoLocation(step1) || hasNoLocation(step2)) {\n      return null;\n    }\n\n    // don't draw if something else is up\n    if (!step1 || !step2) {\n      return null;\n    }\n\n    const p1 = projectPoint([step1.latitude, step1.longitude]);\n    const p2 = projectPoint([step2.latitude, step2.longitude]);\n\n    return _renderNarrativeStep(p1, p2, {\n      ...defaultStyles,\n      ...(extraStyles || {}),\n    });\n  }\n\n  function renderFullNarrative(n) {\n    if (n === null || n.id !== narrative.id) {\n      return null;\n    }\n\n    const arrows = [];\n\n    for (let idx = 0; idx < n.steps.length - 1; idx += 1) {\n      const step1 = n.steps[idx];\n      const step2 = n.steps[idx + 1];\n      arrows.push(renderBetweenSteps(step1, step2, getNarrativeStyle(n.id)));\n    }\n\n    return arrows;\n  }\n\n  function renderBetweenMarked(n) {\n    // this function should only be called if features.NARRATIVE_STEP_STYLES\n    // is true, and thus there is a 'stepStyles' attributes in events\n    if (n === null || n.id !== narrative.id) {\n      return null;\n    }\n\n    const arrows = [];\n\n    let lastMarked = null;\n\n    if (narrativesExist) {\n      for (let idx = 0; idx < n.steps.length; idx += 1) {\n        const step = n.steps[idx];\n        if (lastMarked) {\n          arrows.push(\n            renderBetweenSteps(\n              lastMarked,\n              step,\n              n.withLines ? { strokeWidth: \"1px\", stroke: step.colour } : {}\n            )\n          );\n        }\n        lastMarked = step;\n      }\n    } else {\n      for (let idx = 0; idx < n.steps.length; idx += 1) {\n        const step = n.steps[idx];\n        const _idx = step.narratives.indexOf(n.id);\n        const stepStyle = step.narrative___stepStyles[_idx];\n\n        if (stepStyle !== \"None\") {\n          if (lastMarked) {\n            arrows.push(\n              renderBetweenSteps(lastMarked, step, styles.stepStyles[stepStyle])\n            );\n          }\n          lastMarked = step;\n        }\n      }\n    }\n\n    return arrows;\n  }\n\n  function renderNarrative(n) {\n    const narrativeId = `narrative-${n.id.replace(/ /g, \"_\")}`;\n\n    const body = narrativesExist\n      ? renderBetweenMarked(n)\n      : features.NARRATIVE_STEP_STYLES\n      ? renderBetweenMarked(n)\n      : renderFullNarrative(n);\n\n    return (\n      <g id={narrativeId} className=\"narrative\">\n        {body}\n      </g>\n    );\n  }\n\n  // don't render in explore mode\n  if (narrative === null) {\n    return null;\n  }\n\n  return (\n    <Portal node={svg}>\n      <g className=\"narratives\">{narratives.map(renderNarrative)}</g>\n    </Portal>\n  );\n}\n\nexport default MapNarratives;\n","import React from \"react\";\n\nconst MapDefsMarkers = () => (\n  <svg>\n    <defs>\n      <marker\n        id=\"arrow\"\n        viewBox=\"0 0 6 6\"\n        refX=\"3\"\n        refY=\"3\"\n        markerWidth=\"6\"\n        markerHeight=\"6\"\n        orient=\"auto\"\n      >\n        <path d=\"M0,3v-3l6,3l-6,3z\" style={{ fill: \"red\" }} />\n      </marker>\n      <marker\n        id=\"arrow-off\"\n        viewBox=\"0 0 6 6\"\n        refX=\"3\"\n        refY=\"3\"\n        markerWidth=\"6\"\n        markerHeight=\"6\"\n        orient=\"auto\"\n      >\n        <path\n          d=\"M0,3v-3l6,3l-6,3z\"\n          style={{ fill: \"black\", fillOpacity: 0.2 }}\n        />\n      </marker>\n    </defs>\n  </svg>\n);\n\nexport default MapDefsMarkers;\n","export default __webpack_public_path__ + \"static/media/map.1a1ec3b3.png\";","export default __webpack_public_path__ + \"static/media/sat.751acac8.png\";","import React from \"react\";\nimport copy from \"../../../../common/data/copy.json\";\nimport { language } from \"../../../../common/utilities\";\nimport mapImg from \"../../../../assets/satelliteoverlaytoggle/map.png\";\nimport satImg from \"../../../../assets/satelliteoverlaytoggle/sat.png\";\n\nconst SatelliteOverlayToggle = ({\n  switchToSatellite,\n  reset,\n  isUsingSatellite,\n}) => {\n  return (\n    <div id=\"satellite-overlay-toggle\" className=\"satellite-overlay-toggle\">\n      {isUsingSatellite ? (\n        <button\n          className=\"satellite-overlay-toggle-button satellite-overlay-toggle-map\"\n          style={{ backgroundImage: `url(${mapImg}` }}\n          onClick={reset}\n        >\n          <div className=\"label\">{copy[language].tiles.default}</div>\n        </button>\n      ) : (\n        <button\n          className=\"satellite-overlay-toggle-button satellite-overlay-toggle-sat\"\n          style={{ backgroundImage: `url(${satImg}` }}\n          onClick={switchToSatellite}\n        >\n          <div className=\"label\">{copy[language].tiles.satellite}</div>\n        </button>\n      )}\n    </div>\n  );\n};\n\nexport default SatelliteOverlayToggle;\n","/* global L */\nimport { bindActionCreators } from \"redux\";\nimport \"leaflet\";\nimport React from \"react\";\nimport { flushSync } from \"react-dom\";\nimport { Portal } from \"react-portal\";\nimport Supercluster from \"supercluster\";\n\nimport { connect } from \"react-redux\";\nimport * as selectors from \"../../../selectors\";\nimport * as actions from \"../../../actions\";\n\nimport Sites from \"./atoms/Sites\";\nimport Regions from \"./atoms/Regions\";\nimport Events from \"./atoms/Events\";\nimport Clusters from \"./atoms/Clusters\";\nimport SelectedEvents from \"./atoms/SelectedEvents\";\nimport Narratives from \"./atoms/Narratives\";\nimport DefsMarkers from \"./atoms/DefsMarkers\";\nimport SatelliteOverlayToggle from \"./atoms/SatelliteOverlayToggle\";\nimport LoadingOverlay from \"../../atoms/Loading\";\n\nimport {\n  mapClustersToLocations,\n  isIdentical,\n  isLatitude,\n  isLongitude,\n  calculateTotalClusterPoints,\n  calcClusterSize,\n} from \"../../../common/utilities\";\n\n// NB: important constants for map, TODO: make statics\n// Note: Base map is OpenStreetMaps by default; can choose another base map\nconst supportedMapboxMap = [\"streets-v11\", \"satellite\"];\nconst defaultToken = \"your_token\";\n\nclass Map extends React.Component {\n  constructor() {\n    super();\n    this.projectPoint = this.projectPoint.bind(this);\n    this.onClusterSelect = this.onClusterSelect.bind(this);\n    this.loadClusterData = this.loadClusterData.bind(this);\n    this.getClusterChildren = this.getClusterChildren.bind(this);\n    this.svgRef = React.createRef();\n    this.map = null;\n    this.superclusterIndex = null;\n    this.tileLayer = null;\n    this.state = {\n      mapTransformX: 0,\n      mapTransformY: 0,\n      indexLoaded: false,\n      clusters: [],\n    };\n    this.styleLocation = this.styleLocation.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.map === null) {\n      this.initializeMap();\n      this.initializeTileLayer();\n    }\n    window.dispatchEvent(new Event(\"resize\"));\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.ui.tiles !== this.props.ui.tiles && this.map) {\n      this.initializeTileLayer();\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (!isIdentical(nextProps.domain.locations, this.props.domain.locations)) {\n      this.loadClusterData(nextProps.domain.locations);\n    }\n\n    // Set appropriate zoom for narrative\n    const { bounds } = nextProps.app.map;\n    if (!isIdentical(bounds, this.props.app.map.bounds) && bounds !== null) {\n      this.map.fitBounds(bounds);\n    } else {\n      if (!isIdentical(nextProps.app.selected, this.props.app.selected)) {\n        // Fly to first  of events selected\n        const eventPoint =\n          nextProps.app.selected.length > 0 ? nextProps.app.selected[0] : null;\n\n        if (\n          eventPoint !== null &&\n          eventPoint.latitude &&\n          eventPoint.longitude\n        ) {\n          // this.map.setView([eventPoint.latitude, eventPoint.longitude])\n          this.map.setView(\n            [eventPoint.latitude, eventPoint.longitude],\n            this.map.getZoom(),\n            {\n              animate: true,\n              pan: {\n                duration: 0.7,\n              },\n            }\n          );\n        }\n      }\n    }\n  }\n\n  getTileUrl(tiles) {\n    if (\n      tiles === \"openstreetmap\" ||\n      !process.env.MAPBOX_TOKEN ||\n      process.env.MAPBOX_TOKEN === defaultToken\n    ) {\n      return \"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png\";\n    }\n\n    if (supportedMapboxMap.indexOf(this.props.ui.tiles) !== -1) {\n      return `https://api.mapbox.com/styles/v1/mapbox/${this.props.ui.tiles}/tiles/{z}/{x}/{y}?access_token=${process.env.MAPBOX_TOKEN}`;\n    }\n\n    return `https://api.mapbox.com/styles/v1/mapbox/${supportedMapboxMap[0]}/tiles/{z}/{x}/{y}?access_token=${process.env.MAPBOX_TOKEN}`;\n  }\n\n  /**\n   * Initialize the base tile layer based on the ui state\n   */\n  initializeTileLayer() {\n    if (!this.map) {\n      return;\n    }\n\n    const url = this.getTileUrl(this.props.ui.tiles);\n    /**\n     * If a tile layer already exists, we update its url. Otherwise, we create it and add it to the map.\n     */\n    if (this.tileLayer) {\n      this.tileLayer.setUrl(url);\n    } else {\n      this.tileLayer = L.tileLayer(url);\n      this.tileLayer.addTo(this.map);\n    }\n  }\n\n  initializeMap() {\n    /**\n     * Creates a Leaflet map\n     */\n    const { map: mapConfig, cluster: clusterConfig } = this.props.app;\n\n    const map = L.map(this.props.ui.dom.map)\n      .setView(mapConfig.anchor, mapConfig.startZoom)\n      .setMinZoom(mapConfig.minZoom)\n      .setMaxZoom(mapConfig.maxZoom)\n      .setMaxBounds(mapConfig.maxBounds);\n\n    // Initialize supercluster index\n    this.superclusterIndex = new Supercluster(clusterConfig);\n\n    map.keyboard.disable();\n    map.zoomControl.remove();\n\n    map.on(\"moveend\", () => {\n      this.updateClusters();\n      this.alignLayers();\n    });\n\n    map.on(\"zoomend viewreset\", () => {\n      this.map.dragging.enable();\n      this.map.doubleClickZoom.enable();\n      this.map.scrollWheelZoom.enable();\n      flushSync(() => {\n        this.alignLayers();\n        this.updateClusters();\n      });\n    });\n    map.on(\"zoomstart\", () => {\n      if (this.svgRef.current !== null)\n        this.svgRef.current.classList.add(\"hide\");\n    });\n    map.on(\"zoomend\", () => {\n      if (this.svgRef.current !== null)\n        this.svgRef.current.classList.remove(\"hide\");\n    });\n    window.addEventListener(\"resize\", () => {\n      this.alignLayers();\n    });\n\n    this.map = map;\n  }\n\n  getMapDetails() {\n    const bounds = this.map.getBounds();\n    const bbox = [\n      bounds.getWest(),\n      bounds.getSouth(),\n      bounds.getEast(),\n      bounds.getNorth(),\n    ];\n    const zoom = this.map.getZoom();\n    return [bbox, zoom];\n  }\n\n  updateClusters() {\n    const [bbox, zoom] = this.getMapDetails();\n    if (this.superclusterIndex && this.state.indexLoaded) {\n      this.setState({\n        clusters: this.superclusterIndex.getClusters(bbox, zoom),\n      });\n    }\n  }\n\n  loadClusterData(locations) {\n    if (locations && locations.length > 0 && this.superclusterIndex) {\n      const convertedLocations = locations.reduce((acc, loc) => {\n        const { longitude, latitude } = loc;\n        const validCoordinates = isLatitude(latitude) && isLongitude(longitude);\n        if (validCoordinates) {\n          const feature = {\n            type: \"Feature\",\n            properties: {\n              cluster: false,\n              id: loc.label,\n            },\n            geometry: {\n              type: \"Point\",\n              coordinates: [longitude, latitude],\n            },\n          };\n          acc.push(feature);\n        }\n        return acc;\n      }, []);\n      this.superclusterIndex.load(convertedLocations);\n      this.setState({ indexLoaded: true }, () => {\n        this.updateClusters();\n      });\n    } else {\n      this.setState({ clusters: [] });\n    }\n  }\n\n  getClusterChildren(clusterId) {\n    if (this.superclusterIndex) {\n      try {\n        const children = this.superclusterIndex.getLeaves(\n          clusterId,\n          Infinity,\n          0\n        );\n        return mapClustersToLocations(children, this.props.domain.locations);\n      } catch (err) {\n        return [];\n      }\n    }\n    return [];\n  }\n\n  getSelectedClusters() {\n    const { selected } = this.props.app;\n    const selectedIds = selected.map((sl) => sl.id);\n\n    if (this.state.clusters && this.state.clusters.length > 0) {\n      return this.state.clusters.reduce((acc, cl) => {\n        if (cl.properties.cluster) {\n          const children = this.getClusterChildren(cl.properties.cluster_id);\n          if (children && children.length > 0) {\n            children.forEach((child) => {\n              const clusterPresent =\n                acc.findIndex((item) => item.id === cl.id) >= 0;\n              if (selectedIds.includes(child.id) && !clusterPresent) {\n                acc.push(cl);\n              }\n            });\n          }\n        }\n        return acc;\n      }, []);\n    }\n    return [];\n  }\n\n  alignLayers() {\n    const mapNode = document.querySelector(\".leaflet-map-pane\");\n    if (mapNode === null) return { transformX: 0, transformY: 0 };\n\n    // We'll get the transform of the leaflet container,\n    // which will let us offset the SVG by the same quantity\n    const transform = window\n      .getComputedStyle(mapNode)\n      .getPropertyValue(\"transform\");\n\n    // Offset with leaflet map transform boundaries\n    this.setState({\n      mapTransformX: +transform.split(\",\")[4],\n      mapTransformY: +transform.split(\",\")[5].split(\")\")[0],\n    });\n  }\n\n  projectPoint(location) {\n    const latLng = new L.LatLng(location[0], location[1]);\n    return {\n      x: this.map.latLngToLayerPoint(latLng).x + this.state.mapTransformX,\n      y: this.map.latLngToLayerPoint(latLng).y + this.state.mapTransformY,\n    };\n  }\n\n  onClusterSelect({ id, latitude, longitude }) {\n    const expansionZoom = Math.max(\n      this.superclusterIndex.getClusterExpansionZoom(parseInt(id)),\n      this.superclusterIndex.options.minZoom\n    );\n    const zoomLevelsToSkip = 2;\n    const zoomToFly = Math.max(\n      expansionZoom + zoomLevelsToSkip,\n      this.props.app.cluster.maxZoom\n    );\n    this.map.flyTo(new L.LatLng(latitude, longitude), zoomToFly);\n  }\n\n  getClientDims() {\n    const boundingClient = document\n      .querySelector(`#${this.props.ui.dom.map}`)\n      .getBoundingClientRect();\n\n    return {\n      width: boundingClient.width,\n      height: boundingClient.height,\n    };\n  }\n\n  renderTiles() {\n    const pane = this.map.getPanes().overlayPane;\n    const { width, height } = this.getClientDims();\n\n    return this.map ? (\n      <Portal node={pane}>\n        <svg\n          ref={this.svgRef}\n          width={width}\n          height={height}\n          style={{\n            transform: `translate3d(${-this.state.mapTransformX}px, ${-this\n              .state.mapTransformY}px, 0)`,\n          }}\n          className=\"leaflet-svg\"\n        />\n      </Portal>\n    ) : null;\n  }\n\n  renderSites() {\n    return (\n      <Sites\n        sites={this.props.domain.sites}\n        projectPoint={this.projectPoint}\n        isEnabled={this.props.app.views.sites}\n      />\n    );\n  }\n\n  renderRegions() {\n    return (\n      <Regions\n        svg={this.svgRef.current}\n        regions={this.props.domain.regions}\n        projectPoint={this.projectPoint}\n        styles={this.props.ui.regions}\n      />\n    );\n  }\n\n  renderNarratives() {\n    const hasNarratives = this.props.domain.narratives.length > 0;\n    return (\n      <Narratives\n        svg={this.svgRef.current}\n        narratives={\n          hasNarratives\n            ? this.props.domain.narratives\n            : [this.props.app.narrative]\n        }\n        projectPoint={this.projectPoint}\n        narrative={this.props.app.narrative}\n        styles={this.props.ui.narratives}\n        onSelectNarrative={this.props.methods.onSelectNarrative}\n        features={this.props.features}\n      />\n    );\n  }\n\n  /**\n   * Determines additional styles on the <circle> for each location.\n   * A location consists of an array of events (see selectors). The function\n   * also has full access to the domain and redux state to derive values if\n   * necessary. The function should return an array, where the value at the\n   * first index is a styles object for the SVG at the location, and the value\n   * at the second index is an optional additional component that renders in\n   * the <g/> div.\n   */\n  styleLocation(location) {\n    return [null, null];\n  }\n\n  styleCluster(cluster) {\n    return [null, null];\n  }\n\n  renderEvents() {\n    /*\n    Uncomment below to filter out the locations already present in a cluster.\n    Leaving these lines commented out renders all the locations on the map, regardless of whether or not they are clustered\n    */\n\n    const individualClusters = this.state.clusters.filter(\n      (cl) => !cl.properties.cluster\n    );\n    const filteredLocations = mapClustersToLocations(\n      individualClusters,\n      this.props.domain.locations\n    );\n\n    return (\n      <Events\n        svg={this.svgRef.current}\n        events={this.props.domain.events}\n        locations={filteredLocations}\n        // locations={this.props.domain.locations}\n        styleLocation={this.styleLocation}\n        categories={this.props.domain.categories}\n        projectPoint={this.projectPoint}\n        selected={this.props.app.selected}\n        narrative={this.props.app.narrative}\n        onSelect={this.props.methods.onSelect}\n        getCategoryColor={this.props.methods.getCategoryColor}\n        eventRadius={this.props.ui.eventRadius}\n        coloringSet={this.props.app.coloringSet}\n        filterColors={this.props.ui.filterColors}\n        features={this.props.features}\n      />\n    );\n  }\n\n  renderClusters() {\n    const allClusters = this.state.clusters.filter(\n      (cl) => cl.properties.cluster\n    );\n    return (\n      <Clusters\n        svg={this.svgRef.current}\n        styleCluster={this.styleCluster}\n        projectPoint={this.projectPoint}\n        clusters={allClusters}\n        isRadial={this.props.ui.radial}\n        onSelect={this.onClusterSelect}\n        coloringSet={this.props.app.coloringSet}\n        getClusterChildren={this.getClusterChildren}\n        filterColors={this.props.ui.filterColors}\n      />\n    );\n  }\n\n  renderSelected() {\n    const selectedClusters = this.getSelectedClusters();\n    const totalMarkers = [];\n\n    this.props.app.selected.forEach((s) => {\n      const { latitude, longitude, id } = s;\n      totalMarkers.push({\n        id,\n        latitude,\n        longitude,\n        radius: this.props.ui.eventRadius,\n      });\n    });\n\n    const totalClusterPoints = calculateTotalClusterPoints(this.state.clusters);\n\n    selectedClusters.forEach((cl) => {\n      if (cl.properties.cluster) {\n        const { coordinates } = cl.geometry;\n\n        totalMarkers.push({\n          id: cl.id,\n          latitude: String(coordinates[1]),\n          longitude: String(coordinates[0]),\n          radius: calcClusterSize(\n            cl.properties.point_count,\n            totalClusterPoints\n          ),\n        });\n      }\n    });\n\n    return (\n      <SelectedEvents\n        svg={this.svgRef.current}\n        selected={totalMarkers}\n        projectPoint={this.projectPoint}\n        styles={this.props.ui.mapSelectedEvents}\n      />\n    );\n  }\n\n  renderMarkers() {\n    return (\n      <Portal node={this.svgRef.current}>\n        <DefsMarkers />\n      </Portal>\n    );\n  }\n\n  render() {\n    const { isShowingSites, isFetchingDomain } = this.props.app.flags;\n    const classes = this.props.app.narrative\n      ? \"map-wrapper narrative-mode\"\n      : \"map-wrapper\";\n    const innerMap = this.map ? (\n      <>\n        {this.renderTiles()}\n        {this.renderMarkers()}\n        {isShowingSites ? this.renderSites() : null}\n        {this.renderRegions()}\n        {this.renderNarratives()}\n        {this.renderEvents()}\n        {this.renderClusters()}\n        {this.renderSelected()}\n      </>\n    ) : null;\n\n    return (\n      <div className={classes} onKeyDown={this.props.onKeyDown} tabIndex=\"0\">\n        <div id={this.props.ui.dom.map} />\n        <LoadingOverlay\n          isLoading={this.props.app.loading || isFetchingDomain}\n          ui={isFetchingDomain}\n          language={this.props.app.language}\n        />\n        {this.props.features.USE_SATELLITE_OVERLAY_TOGGLE && (\n          <SatelliteOverlayToggle\n            isUsingSatellite={this.props.ui.tiles === \"satellite\"}\n            toggleView={this.props.actions.toggleSatelliteView}\n          />\n        )}\n        {innerMap}\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    domain: {\n      locations: selectors.selectLocations(state),\n      narratives: selectors.selectNarratives(state),\n      categories: selectors.getCategories(state),\n      sites: selectors.selectSites(state),\n      regions: selectors.selectRegions(state),\n    },\n    app: {\n      views: state.app.associations.views,\n      selected: selectors.selectSelected(state),\n      highlighted: state.app.highlighted,\n      map: state.app.map,\n      cluster: state.app.cluster,\n      language: state.app.language,\n      loading: state.app.loading,\n      narrative: state.app.associations.narrative,\n      coloringSet: state.app.associations.coloringSet,\n      flags: {\n        isShowingSites: state.app.flags.isShowingSites,\n        isFetchingDomain: state.app.flags.isFetchingDomain,\n      },\n    },\n    ui: {\n      tiles: selectors.getTiles(state),\n      dom: state.ui.dom,\n      narratives: state.ui.style.narratives,\n      mapSelectedEvents: state.ui.style.selectedEvents,\n      regions: state.ui.style.regions,\n      eventRadius: state.ui.eventRadius,\n      radial: state.ui.style.clusters.radial,\n      filterColors: state.ui.coloring.colors,\n    },\n    features: selectors.getFeatures(state),\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Map);\n","import React from \"react\";\nimport MapCarto from \"./carto/Map\";\n// import Map3d from \"./3d/Map\";\n\nconst Space = (props) => {\n  switch (props.kind) {\n    // case \"3d\":\n    //   return <Map3d {...props} />;\n    default:\n      return <MapCarto {...props} />;\n  }\n};\n\nexport default Space;\n","import React from \"react\";\n\nconst SearchRow = ({ query, eventObj, onSearchRowClick }) => {\n  const { description, location, date } = eventObj;\n  function getHighlightedText(text, highlight) {\n    // Split text on highlight term, include term itself into parts, ignore case\n    const parts = text.split(new RegExp(`(${highlight})`, \"gi\"));\n    return (\n      <span>\n        {parts.map((part) =>\n          part.toLowerCase() === highlight.toLowerCase() ? (\n            <span style={{ backgroundColor: \"yellow\", color: \"black\" }}>\n              {part}\n            </span>\n          ) : (\n            part\n          )\n        )}\n      </span>\n    );\n  }\n\n  function getShortDescription(text, searchQuery) {\n    const regexp = new RegExp(\n      `(([^ ]* ){0,6}[a-zA-Z]*${searchQuery.toLowerCase()}[a-zA-Z]*( [^ ]*){0,5})`,\n      \"gm\"\n    );\n    const parts = text.toLowerCase().match(regexp);\n    for (let x = 0; x < (parts ? parts.length : 0); x++) {\n      parts[x] = \"...\" + parts[x];\n    }\n    const firstLine = [text.match(\"(([^ ]* ){0,10})\", \"m\")[0]];\n    return parts || firstLine;\n  }\n\n  return (\n    <div className=\"search-row\" onClick={() => onSearchRowClick([eventObj])}>\n      <div className=\"location-date-container\">\n        <div className=\"date-container\">\n          <i className=\"material-icons\">event</i>\n          <p>{getHighlightedText(date, query)}</p>\n        </div>\n        <div className=\"location-container\">\n          <i className=\"material-icons\">location_on</i>\n          <p>{getHighlightedText(location, query)}</p>\n        </div>\n      </div>\n      <p>\n        {getShortDescription(description, query).map((match) => {\n          return (\n            <span>\n              {getHighlightedText(match, query)}...\n              <br />\n            </span>\n          );\n        })}\n      </p>\n    </div>\n  );\n};\n\nexport default SearchRow;\n","import React from \"react\";\n\nimport { bindActionCreators } from \"redux\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../actions\";\n\nimport SearchRow from \"./atoms/SearchRow.jsx\";\n\nclass Search extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isFolded: true,\n    };\n    this.onButtonClick = this.onButtonClick.bind(this);\n    this.updateSearchQuery = this.updateSearchQuery.bind(this);\n  }\n\n  onButtonClick() {\n    this.setState((prevState) => {\n      return { isFolded: !prevState.isFolded };\n    });\n  }\n\n  updateSearchQuery(e) {\n    const queryString = e.target.value;\n    this.props.actions.updateSearchQuery(queryString);\n  }\n\n  render() {\n    let searchResults;\n\n    const searchAttributes = [\"description\", \"location\", \"category\", \"date\"];\n\n    if (!this.props.queryString) {\n      searchResults = [];\n    } else {\n      searchResults = this.props.events.filter((event) =>\n        searchAttributes.some((attribute) =>\n          event[attribute]\n            .toLowerCase()\n            .includes(this.props.queryString.toLowerCase())\n        )\n      );\n    }\n\n    return (\n      <div\n        className={\n          \"search-outer-container\" +\n          (this.props.narrative ? \" narrative-mode \" : \"\")\n        }\n      >\n        <div id=\"search-bar-icon-container\" onClick={this.onButtonClick}>\n          <i className=\"material-icons\">search</i>\n        </div>\n        <div\n          className={\n            \"search-bar-overlay\" + (this.state.isFolded ? \" folded\" : \"\")\n          }\n        >\n          <div className=\"search-input-container\">\n            <input\n              className=\"search-bar-input\"\n              onChange={this.updateSearchQuery}\n              type=\"text\"\n            />\n            <i\n              id=\"close-search-overlay\"\n              className=\"material-icons\"\n              onClick={this.onButtonClick}\n            >\n              close\n            </i>\n          </div>\n          <div className=\"search-results\">\n            {searchResults.map((result) => {\n              return (\n                <SearchRow\n                  onSearchRowClick={this.props.onSearchRowClick}\n                  eventObj={result}\n                  query={this.props.queryString}\n                />\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect((state) => state, mapDispatchToProps)(Search);\n","import React, { useState } from \"react\";\n\nconst CardText = ({ title, value, hoverValue = null }) => {\n  const [showHover, setShowHover] = useState(false);\n\n  return (\n    <div className=\"card-cell\">\n      {title ? <h4>{title}</h4> : null}\n      <div\n        style={{\n          width: `fit-content`,\n        }}\n      >\n        <div\n          onMouseOver={() => hoverValue && setShowHover(true)}\n          onMouseOut={() => hoverValue && setShowHover(false)}\n        >\n          {showHover ? (\n            <span\n              style={{\n                pointerEvents: `none`,\n                opacity: 0.8,\n              }}\n            >\n              <em>{hoverValue}</em>\n            </span>\n          ) : (\n            <div\n              style={{\n                pointerEvents: `none`,\n                display: `inline-block`,\n                height: `1.1rem`,\n                borderBottom: hoverValue && `1px rgb(235, 68, 62) dashed`,\n              }}\n            >\n              {value}\n            </div>\n          )}\n        </div>\n        {/* {!showHover && value} */}\n      </div>\n    </div>\n  );\n};\n\nexport default CardText;\n","import React from \"react\";\n\nimport copy from \"../../../common/data/copy.json\";\nimport { isNotNullNorUndefined } from \"../../../common/utilities\";\n\nconst CardTime = ({ title = \"Timestamp\", timelabel, language, precision }) => {\n  const unknownLang = copy[language].cardstack.unknown_time;\n\n  if (isNotNullNorUndefined(timelabel)) {\n    return (\n      <div className=\"card-cell\">\n        {/* <i className=\"material-icons left\">today</i> */}\n        <h4>{title}</h4>\n        {timelabel}\n        {precision && precision !== \"\" ? ` - ${precision}` : null}\n      </div>\n    );\n  } else {\n    return (\n      <div className=\"card-cell\">\n        {/* <i className=\"material-icons left\">today</i> */}\n        <h4>{title}</h4>\n        {unknownLang}\n      </div>\n    );\n  }\n};\n\nexport default CardTime;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\n\n/**\n * Primary UI component for user interaction\n */\nexport const Button = ({\n  primary,\n  backgroundColor,\n  borderRadius,\n  size,\n  label,\n  normalCursor,\n  ...props\n}) => {\n  const mode = primary ? \"button--primary\" : \"button--secondary\";\n  return (\n    <button\n      type=\"button\"\n      className={[\n        \"button\",\n        `button--${size}`,\n        mode,\n        normalCursor ? \"no-hover\" : \"\",\n      ].join(\" \")}\n      style={{ backgroundColor: backgroundColor, borderRadius: borderRadius }}\n      {...props}\n    >\n      {label}\n    </button>\n  );\n};\n\nButton.propTypes = {\n  /**\n   * Is this the principal call to action on the page?\n   */\n  primary: PropTypes.bool,\n  /**\n   * What background color to use\n   */\n  backgroundColor: PropTypes.string,\n  /**\n   * How much rounded are they?\n   */\n  borderRadius: PropTypes.string,\n  /**\n   * How large should the button be?\n   */\n  size: PropTypes.oneOf([\"small\", \"medium\", \"large\"]),\n  /**\n   * Button contents\n   */\n  label: PropTypes.string.isRequired,\n  /**\n   * Optional click handler\n   */\n  onClick: PropTypes.func,\n};\n\nButton.defaultProps = {\n  backgroundColor: \"red\",\n  borderRadius: \"0%\",\n  primary: false,\n  size: \"medium\",\n  onClick: undefined,\n};\n\nconst CardButton = ({\n  text,\n  color = \"#000\",\n  onClick = () => {},\n  normalCursor,\n}) => (\n  <Button\n    size={\"small\"}\n    backgroundColor={color}\n    borderRadius={\"12px\"}\n    primary={false}\n    label={text}\n    onClick={onClick}\n    normalCursor={normalCursor}\n  />\n);\n\nexport default CardButton;\n","import React from \"react\";\n\nconst CardCaret = ({ isOpen, toggle }) => {\n  let classes = isOpen ? \"arrow-down\" : \"arrow-down folded\";\n\n  return (\n    <div className=\"card-toggle\" onClick={toggle}>\n      <p>\n        <i className={classes} />\n      </p>\n    </div>\n  );\n};\n\nexport default CardCaret;\n","import React from \"react\";\nimport { marked } from \"marked\";\n\n// TODO could this be a security vulnerability?\nconst CardCustomField = ({ title, value }) => (\n  <div className=\"card-cell\">\n    {title ? <h4>{title}</h4> : null}\n    <div dangerouslySetInnerHTML={{ __html: marked(`${value}`) }} />\n  </div>\n);\n\nexport default CardCustomField;\n","/*\n * Adapted from https://github.com/cudr/react-telegram-embed\n */\nimport React, { Component } from \"react\";\n\nconst styles = {\n  width: \"100%\",\n  frameBorder: \"0\",\n  scrolling: \"no\",\n  border: \"none\",\n  overflow: \"hidden\",\n};\n\nconst containerStyles = {};\n\n/**\n * Simple Component for Telegram embedding\n * @extends Component\n */\n\nclass TelegramEmbed extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      src: this.props.src,\n      id: \"\",\n      height: \"80px\",\n    };\n    this.messageHandler = this.messageHandler.bind(this);\n    this.urlObj = document.createElement(\"a\");\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"message\", this.messageHandler);\n\n    this.iFrame.addEventListener(\"load\", () => {\n      this.checkFrame(this.state.id);\n    });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"message\", this.messageHandler);\n  }\n\n  messageHandler({ data, source }) {\n    if (\n      !data ||\n      typeof data !== \"string\" ||\n      source !== this.iFrame.contentWindow\n    ) {\n      return;\n    }\n\n    const action = JSON.parse(data);\n\n    if (action.event === \"resize\" && action.height) {\n      this.setState({\n        height: action.height + \"px\",\n      });\n    }\n  }\n\n  checkFrame(id) {\n    this.iFrame.contentWindow.postMessage(\n      JSON.stringify({ event: \"visible\", frame: id }),\n      \"*\"\n    );\n  }\n\n  UNSAFE_componentWillReceiveProps({ src }) {\n    if (this.state.src !== src) {\n      this.urlObj.href = src;\n      const id = `telegram-post${this.urlObj.pathname.replace(\n        /[^a-z0-9_]/gi,\n        \"-\"\n      )}`;\n\n      this.setState({ src, id }, () => this.checkFrame(id));\n    }\n  }\n\n  render() {\n    const { src, height } = this.state;\n    const { container } = this.props;\n\n    return (\n      <div data-sharing-id={container} style={containerStyles}>\n        <iframe\n          title={src}\n          ref={(node) => (this.iFrame = node)}\n          src={src + \"?embed=1\"}\n          height={height}\n          id={\n            \"telegram-post\" + this.urlObj.pathname.replace(/[^a-z0-9_]/gi, \"-\")\n          }\n          style={styles}\n        />\n      </div>\n    );\n  }\n}\n\nexport default TelegramEmbed;\n","import React, { useRef } from \"react\";\nimport { useCallback } from \"react\";\nimport { typeForPath } from \"../../../common/utilities\";\nimport { TwitterTweetEmbed } from \"react-twitter-embed\";\nimport TelegramPostEmbed from \"./TelegramEmbed\";\n\nconst TITLE_LENGTH = 50;\n// TODO should videos\n//    - play inline\n//    - appear zoomed out/in\n//    - only show cover image and then lightbox when clicked\n//    - show video control plane?\n// TODO landscape image doesn't fit in box properly\nconst Media = ({ src, title }) => {\n  const videoRef = useRef();\n  const onVideoStart = useCallback(() => {\n    return videoRef.current?.play();\n  }, []);\n  const onVideoStop = useCallback(() => {\n    return videoRef.current?.pause();\n  }, []);\n\n  const type = typeForPath(src);\n  const formattedTitle =\n    title && title.length > TITLE_LENGTH\n      ? `${title.slice(0, TITLE_LENGTH + 1)}...`\n      : title;\n\n  switch (type) {\n    case \"Video\":\n      return (\n        <div className=\"card-cell media\">\n          {title && <h4 title={title}>{formattedTitle}</h4>}\n          <video\n            onMouseEnter={onVideoStart}\n            onMouseLeave={onVideoStop}\n            ref={videoRef}\n            // controls\n            // controlsList=\"nodownload noremoteplayback\"\n            disablePictureInPicture\n          >\n            <source src={src} />\n          </video>\n        </div>\n      );\n    case \"Image\":\n      return (\n        <div className=\"card-cell media\">\n          {title && <h4 title={title}>{formattedTitle}</h4>}\n          <div className=\"img-wrapper\">\n            <img\n              src={src}\n              alt=\"an inline photograph for the event card component\"\n            />\n          </div>\n        </div>\n      );\n\n    case \"Telegram\":\n      return (\n        <div className=\"card-cell media embedded\">\n          <TelegramPostEmbed src={src} />\n        </div>\n      );\n\n    case \"Tweet\":\n      const tweetIdRegex =\n        /https?:\\/\\/twitter.com\\/[0-9a-zA-Z_]{1,20}\\/status\\/([0-9]*)/;\n      const match = tweetIdRegex.exec(src);\n      const tweetId = match[1];\n\n      return (\n        <div className=\"card-cell media embedded\">\n          <TwitterTweetEmbed tweetId={tweetId} />\n        </div>\n      );\n    default:\n      if (src === \"HIDDEN\") {\n        return (\n          <div className=\"card-cell media source-hidden\">\n            <h4>\n              Source hidden\n              <br />\n              Privacy concerns\n            </h4>\n          </div>\n        );\n      } else {\n        return null;\n      }\n  }\n};\n\nexport default Media;\n","import React, { useState } from \"react\";\nimport CardText from \"./atoms/Text\";\nimport CardTime from \"./atoms/Time\";\nimport CardButton from \"./atoms/Button\";\nimport CardCaret from \"./atoms/Caret\";\nimport CardCustom from \"./atoms/CustomField\";\nimport CardMedia from \"./atoms/Media\";\n\nimport { makeNiceDate, isEmptyString } from \"../../common/utilities\";\nimport hash from \"object-hash\";\n\nexport const generateCardLayout = {\n  basic: ({ event }) => {\n    return [\n      [\n        {\n          kind: \"date\",\n          title: \"Incident Date\",\n          value: event.datetime || event.date || ``,\n        },\n        {\n          kind: \"text\",\n          title: \"Location\",\n          value: event.location || `—`,\n        },\n      ],\n      [{ kind: \"line-break\", times: 0.4 }],\n      [\n        {\n          kind: \"text\",\n          title: \"Summary\",\n          value: event.description || ``,\n          scaleFont: 1.1,\n        },\n      ],\n    ];\n  },\n  sourced: ({ event }) => {\n    return [\n      [\n        {\n          kind: \"date\",\n          title: \"Incident Date\",\n          value: event.datetime || event.date || ``,\n        },\n        {\n          kind: \"text\",\n          title: \"Location\",\n          value: event.location || `—`,\n        },\n      ],\n      [\n        {\n          kind: \"text\",\n          title: \"Summary\",\n          value: event.description || ``,\n          scaleFont: 1.1,\n        },\n      ],\n      ...event.sources.flatMap((source) => [\n        source.paths.map((p) => ({\n          kind: \"media\",\n          title: \"Media\",\n          value: [{ src: p, title: null }],\n        })),\n      ]),\n    ];\n  },\n};\n\nexport const Card = ({\n  content = [],\n  isLoading = true,\n  onSelect = () => {},\n  sources = [],\n  isSelected = false,\n  language = \"en-US\",\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const toggle = () => setIsOpen(!isOpen);\n\n  // NB: should be internationalized.\n  const renderTime = (field) => (\n    <CardTime\n      language={language}\n      timelabel={makeNiceDate(field.value)}\n      {...field}\n    />\n  );\n\n  const renderCaret = () =>\n    sources.length === 0 && (\n      <CardCaret toggle={() => toggle()} isOpen={isOpen} />\n    );\n\n  const renderMedia = ({ media, idx }) => {\n    return <CardMedia key={idx} src={media.src} title={media.title} />;\n  };\n\n  function renderField(field) {\n    switch (field.kind) {\n      case \"media\":\n        return (\n          <div className=\"card-cell\">\n            {field.value.map((media, idx) => {\n              return renderMedia({ media, idx });\n            })}\n          </div>\n        );\n      case \"line\":\n        return (\n          <div style={{ height: `1rem`, width: `100%` }}>\n            <hr />\n          </div>\n        );\n      case \"line-break\":\n        return (\n          <div style={{ height: `${field.times || 1}rem`, width: `100%` }} />\n        );\n      case \"item\":\n        // this is like a span\n        return null;\n      case \"markdown\":\n        return <CardCustom {...field} />;\n      case \"tag\":\n        return (\n          <div\n            className=\"card-cell m0\"\n            style={{\n              textTransform: `uppercase`,\n              fontSize: `.8em`,\n              lineHeight: `.8em`,\n            }}\n          >\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: `flex-${field.align || `start`}`,\n              }}\n            >\n              {field.value}\n            </div>\n          </div>\n        );\n      case \"button\":\n        return (\n          <div className=\"card-cell\">\n            {field.title && <h4>{field.title}</h4>}\n            {/* <div className=\"card-row\"> */}\n            {field.value.map((t, idx) => (\n              <CardButton key={`card-button-${idx}`} {...t} />\n            ))}\n            {/* </div> */}\n          </div>\n        );\n      case \"text\":\n        return !isEmptyString(field.value) && <CardText {...field} />;\n      case \"date\":\n        return renderTime(field);\n      case \"links\":\n        return (\n          <div className=\"card-cell\">\n            {field.title && <h4>{field.title}</h4>}\n            <div className=\"card-row m0\">\n              {field.value.map(({ text, href }, idx) => (\n                <a href={href} key={`card-links-url-${idx}`}>\n                  {text}\n                </a>\n              ))}\n            </div>\n          </div>\n        );\n      case \"list\":\n        // Only render if some of the list's strings are non-empty\n        const shouldFieldRender =\n          !!field.value.length &&\n          !!field.value.filter((s) => !isEmptyString(s)).length;\n        return shouldFieldRender ? (\n          // <div className=\"card-cell\">\n          <div>\n            {field.title && <h4>{field.title}</h4>}\n            <div className=\"card-row m0\">\n              {field.value.map((t, idx) => (\n                <CardText key={`card-list-text-${idx}`} value={t} {...t} />\n              ))}\n            </div>\n          </div>\n        ) : null;\n      default:\n        return null;\n    }\n  }\n\n  function renderRow(row) {\n    return (\n      <div className=\"card-row\" key={hash(row)}>\n        {row.map((field) => (\n          <span key={hash(field)}>{renderField(field)}</span>\n        ))}\n      </div>\n    );\n  }\n\n  // TODO: render afterCaret appropriately from props\n  sources = [];\n\n  return (\n    <li\n      key={hash(content)}\n      className={`event-card ${isSelected ? \"selected\" : \"\"}`}\n      onClick={onSelect}\n    >\n      {content.map((row) => renderRow(row))}\n      {isOpen && (\n        <div className=\"card-bottomhalf\">\n          {sources.map(() => (\n            <div className=\"card-row\"></div>\n          ))}\n        </div>\n      )}\n      {sources.length > 0 ? renderCaret() : null}\n    </li>\n  );\n};\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { generateCardLayout, Card } from \"./Card\";\n\nimport * as selectors from \"../../selectors\";\nimport { getFilterIdxFromColorSet } from \"../../common/utilities\";\nimport copy from \"../../common/data/copy.json\";\nimport hash from \"object-hash\";\n\nclass CardStack extends React.Component {\n  constructor() {\n    super();\n    this.refs = {};\n    this.refCardStack = React.createRef();\n    this.refCardStackContent = React.createRef();\n  }\n\n  componentDidUpdate() {\n    const isNarrative = !!this.props.narrative;\n\n    if (isNarrative) {\n      this.scrollToCard();\n    }\n  }\n\n  scrollToCard() {\n    const duration = 500;\n    const element = this.refCardStack.current;\n    const cardScroll =\n      this.refs[this.props.narrative.current].current.offsetTop;\n\n    const start = element.scrollTop;\n    const change = cardScroll - start;\n    let currentTime = 0;\n    const increment = 20;\n\n    // t = current time\n    // b = start value\n    // c = change in value\n    // d = duration\n    Math.easeInOutQuad = function (t, b, c, d) {\n      t /= d / 2;\n      if (t < 1) return (c / 2) * t * t + b;\n      t -= 1;\n      return (-c / 2) * (t * (t - 2) - 1) + b;\n    };\n\n    const animateScroll = function () {\n      currentTime += increment;\n      const val = Math.easeInOutQuad(currentTime, start, change, duration);\n      element.scrollTop = val;\n      if (currentTime < duration) setTimeout(animateScroll, increment);\n    };\n    animateScroll();\n  }\n\n  renderCards(events, selections) {\n    // if no selections provided, select all\n    if (!selections) {\n      selections = events.map((e) => true);\n    }\n    this.refs = [];\n\n    const generateTemplate =\n      generateCardLayout[this.props.cardUI.layout.template];\n\n    return events.map((event, idx) => {\n      const thisRef = React.createRef();\n      this.refs[idx] = thisRef;\n\n      const content = generateTemplate({\n        event,\n        colors: this.props.colors,\n        coloringSet: this.props.coloringSet,\n        getFilterIdxFromColorSet,\n      });\n\n      return (\n        <Card\n          key={hash(content)}\n          content={content}\n          language={this.props.language}\n          isLoading={this.props.isLoading}\n          isSelected={selections[idx]}\n        />\n      );\n    });\n  }\n\n  renderSelectedCards() {\n    const { selected } = this.props;\n\n    if (selected.length > 0) {\n      return this.renderCards(selected);\n    }\n    return null;\n  }\n\n  renderNarrativeCards() {\n    const { narrative } = this.props;\n    const showing = narrative.steps;\n\n    const selections = showing.map((_, idx) => idx === narrative.current);\n\n    return this.renderCards(showing, selections);\n  }\n\n  renderCardStackHeader() {\n    const headerLang = copy[this.props.language].cardstack.header;\n\n    return (\n      <div\n        id=\"card-stack-header\"\n        className=\"card-stack-header\"\n        onClick={() => this.props.onToggleCardstack()}\n      >\n        <button className=\"side-menu-burg is-active\">\n          <span />\n        </button>\n        <p className=\"header-copy top\">\n          {`${this.props.selected.length} ${headerLang}`}\n        </p>\n      </div>\n    );\n  }\n\n  renderCardStackContent() {\n    return (\n      <div id=\"card-stack-content\" className=\"card-stack-content\">\n        <ul>{this.renderSelectedCards()}</ul>\n      </div>\n    );\n  }\n\n  renderNarrativeContent() {\n    return (\n      <div\n        id=\"card-stack-content\"\n        className=\"card-stack-content\"\n        ref={this.refCardStackContent}\n      >\n        <ul>{this.renderNarrativeCards()}</ul>\n      </div>\n    );\n  }\n\n  render() {\n    const { isCardstack, selected, narrative } = this.props;\n    if (selected.length > 0) {\n      if (!narrative) {\n        return (\n          <div\n            id=\"card-stack\"\n            className={`card-stack ${isCardstack ? \"\" : \" folded\"}`}\n          >\n            {this.renderCardStackHeader()}\n            {this.renderCardStackContent()}\n          </div>\n        );\n      } else {\n        return (\n          <div\n            id=\"card-stack\"\n            ref={this.refCardStack}\n            className={`card-stack narrative-mode\n            ${isCardstack ? \"\" : \" folded\"}`}\n          >\n            {this.renderNarrativeContent()}\n          </div>\n        );\n      }\n    }\n\n    return <div />;\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    narrative: selectors.selectActiveNarrative(state),\n    selected: selectors.selectSelected(state),\n    sourceError: state.app.errors.source,\n    language: state.app.language,\n    isCardstack: state.app.flags.isCardstack,\n    isLoading: state.app.flags.isFetchingSources,\n    cardUI: state.ui.card,\n    colors: state.ui.coloring.colors,\n    coloringSet: state.app.associations.coloringSet,\n    features: state.features,\n  };\n}\n\nexport default connect(mapStateToProps)(CardStack);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { selectActiveNarrative } from \"../../../selectors\";\n\nfunction NarrativeCard({ narrative }) {\n  // no display if no narrative\n  const { steps, current } = narrative;\n\n  if (steps[current]) {\n    return (\n      <div className=\"narrative-info\">\n        <div className=\"narrative-info-header\">\n          <div className=\"count-container\">\n            <div className=\"count\">\n              {current + 1}/{steps.length}\n            </div>\n          </div>\n          <div>\n            <h3>{narrative.label}</h3>\n          </div>\n        </div>\n\n        {/* <i className='material-icons left'>location_on</i> */}\n        {/* {_renderActions(current, steps)} */}\n        <div className=\"narrative-info-desc\">\n          <p>{narrative.description}</p>\n        </div>\n      </div>\n    );\n  } else {\n    return null;\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    narrative: selectActiveNarrative(state),\n  };\n}\nexport default connect(mapStateToProps)(NarrativeCard);\n","import React from \"react\";\n\nconst Adjust = ({ isDisabled, direction, onClickHandler }) => {\n  return (\n    <div\n      className={`narrative-adjust ${direction}`}\n      onClick={!isDisabled ? onClickHandler : null}\n    >\n      <i className={`material-icons ${isDisabled ? \"disabled\" : \"\"}`}>\n        {`chevron_${direction}`}\n      </i>\n    </div>\n  );\n};\n\nexport default Adjust;\n","import React from \"react\";\n\nconst Close = ({ onClickHandler, closeMsg }) => {\n  return (\n    <div className=\"narrative-close\" onClick={onClickHandler}>\n      <button className=\"side-menu-burg is-active\">\n        <span />\n      </button>\n      <div className=\"close-text\">{closeMsg}</div>\n    </div>\n  );\n};\n\nexport default Close;\n","import React from \"react\";\nimport Card from \"./atoms/NarrativeCard\";\nimport Adjust from \"./atoms/NarrativeAdjust\";\nimport Close from \"./atoms/NarrativeClose\";\n\nconst NarrativeControls = ({ narrative, methods }) => {\n  if (!narrative) return null;\n\n  const { current, steps } = narrative;\n  const prevExists = current !== 0;\n  const nextExists = current < steps.length - 1;\n\n  return (\n    <>\n      <Card narrative={narrative} />\n      <Adjust\n        isDisabled={!prevExists}\n        direction=\"left\"\n        onClickHandler={methods.onPrev}\n      />\n      <Adjust\n        isDisabled={!nextExists}\n        direction=\"right\"\n        onClickHandler={methods.onNext}\n      />\n      <Close\n        onClickHandler={() => methods.onSelectNarrative(null)}\n        closeMsg=\"-- exit from narrative --\"\n      />\n    </>\n  );\n};\n\nexport default NarrativeControls;\n","import React from \"react\";\n\nimport { bindActionCreators } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { isMobileOnly } from \"react-device-detect\";\nimport * as actions from \"../actions\";\nimport * as selectors from \"../selectors\";\n\nimport Toolbar from \"./Toolbar\";\nimport InfoPopup from \"./InfoPopup\";\nimport Notification from \"./Notification\";\nimport TemplateCover from \"./TemplateCover\";\n\nimport Popup from \"./atoms/Popup\";\nimport StaticPage from \"./atoms/StaticPage\";\nimport MediaOverlay from \"./atoms/Media\";\nimport LoadingOverlay from \"./atoms/Loading\";\n\nimport Timeline from \"./time/Timeline\";\nimport Space from \"./space/Space\";\nimport Search from \"./controls/Search\";\nimport CardStack from \"./controls/CardStack\";\nimport NarrativeControls from \"./controls/NarrativeControls.js\";\n\nimport colors from \"../common/global\";\nimport { binarySearch, insetSourceFrom } from \"../common/utilities\";\n\nclass Dashboard extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleViewSource = this.handleViewSource.bind(this);\n    this.handleHighlight = this.handleHighlight.bind(this);\n    this.setNarrative = this.setNarrative.bind(this);\n    this.setNarrativeFromFilters = this.setNarrativeFromFilters.bind(this);\n    this.handleSelect = this.handleSelect.bind(this);\n    this.getCategoryColor = this.getCategoryColor.bind(this);\n    this.findEventIdx = this.findEventIdx.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.selectNarrativeStep = this.selectNarrativeStep.bind(this);\n  }\n\n  componentDidMount() {\n    if (!this.props.app.isMobile) {\n      this.props.actions.fetchDomain().then((domain) => {\n        const { actions, features } = this.props;\n        actions.updateDomain({ domain, features });\n        actions.rehydrateState();\n      });\n    }\n    // NOTE: hack to get the timeline to always show. Not entirely sure why\n    // this is necessary.\n    window.dispatchEvent(new Event(\"resize\"));\n  }\n\n  handleHighlight(highlighted) {\n    this.props.actions.updateHighlighted(highlighted || null);\n  }\n\n  handleViewSource(source) {\n    this.props.actions.updateSource(source);\n  }\n\n  findEventIdx(theEvent) {\n    const { events } = this.props.domain;\n    return binarySearch(events, theEvent, (theev, otherev) => {\n      return theev.datetime - otherev.datetime;\n    });\n  }\n\n  handleSelect(selected, axis) {\n    if (selected.length <= 0) {\n      this.props.actions.updateSelected([]);\n      return;\n    }\n\n    const matchedEvents = [];\n    const TIMELINE_AXIS = 0;\n    if (axis === TIMELINE_AXIS) {\n      matchedEvents.push(selected);\n      // find in events\n      const { events } = this.props.domain;\n      const idx = this.findEventIdx(selected);\n      // binary search can return event with different id\n      if (events[idx].id !== selected.id) {\n        matchedEvents.push(events[idx]);\n      }\n\n      // check events before\n      let ptr = idx - 1;\n\n      while (\n        ptr >= 0 &&\n        events[idx].datetime.getTime() === events[ptr].datetime.getTime()\n      ) {\n        if (events[ptr].id !== selected.id) {\n          matchedEvents.push(events[ptr]);\n        }\n        ptr -= 1;\n      }\n      // check events after\n      ptr = idx + 1;\n\n      while (\n        ptr < events.length &&\n        events[idx].datetime.getTime() === events[ptr].datetime.getTime()\n      ) {\n        if (events[ptr].id !== selected.id) {\n          matchedEvents.push(events[ptr]);\n        }\n        ptr += 1;\n      }\n    } else {\n      // Map..\n      const std = { ...selected };\n      delete std.sources;\n      Object.values(std).forEach((ev) => matchedEvents.push(ev));\n    }\n\n    this.props.actions.updateSelected(matchedEvents);\n  }\n\n  getCategoryColor(category) {\n    if (!this.props.features.USE_CATEGORIES) {\n      return colors.fallbackEventColor;\n    }\n\n    const cat = this.props.ui.style.categories[category];\n    if (cat) {\n      return cat;\n    } else {\n      return this.props.ui.style.categories.default;\n    }\n  }\n\n  setNarrative(narrative) {\n    // only handleSelect if narrative is not null and has associated events\n    if (narrative && narrative.steps.length >= 1) {\n      this.handleSelect([narrative.steps[0]]);\n    }\n    this.props.actions.updateNarrative(narrative);\n  }\n\n  setNarrativeFromFilters(withSteps) {\n    const { app, domain } = this.props;\n    let activeFilters = app.associations.filters;\n\n    if (activeFilters.length === 0) {\n      alert(\"No filters selected, cant narrativise\");\n      return;\n    }\n\n    activeFilters = activeFilters.map((f) => ({ name: f }));\n\n    const evs = domain.events.filter((ev) => {\n      let hasOne = false;\n      // add event if it has at least one matching filter\n      for (let i = 0; i < activeFilters.length; i++) {\n        if (ev.associations.includes(activeFilters[i].name)) {\n          hasOne = true;\n          break;\n        }\n      }\n      if (hasOne) return true;\n      return false;\n    });\n\n    if (evs.length === 0) {\n      alert(\"No associated events, cant narrativise\");\n      return;\n    }\n\n    const name = activeFilters.map((f) => f.name).join(\"-\");\n    const desc = activeFilters.map((f) => f.description).join(\"\\n\\n\");\n    this.setNarrative({\n      id: name,\n      label: name,\n      description: desc,\n      withLines: withSteps,\n      steps: evs.map(insetSourceFrom(domain.sources)),\n    });\n  }\n\n  selectNarrativeStep(idx) {\n    // Try to find idx if event passed rather than number\n    if (typeof idx !== \"number\") {\n      const e = idx[0] || idx;\n\n      if (this.props.app.associations.narrative) {\n        const { steps } = this.props.app.associations.narrative;\n        // choose the first event at a given location\n        const locationEventId = e.id;\n        const narrativeIdxObj = steps.find((s) => s.id === locationEventId);\n        const narrativeIdx = steps.indexOf(narrativeIdxObj);\n\n        if (narrativeIdx > -1) {\n          idx = narrativeIdx;\n        }\n      }\n    }\n\n    const { narrative } = this.props.app.associations;\n    if (narrative === null) return;\n\n    if (idx < narrative.steps.length && idx >= 0) {\n      const step = narrative.steps[idx];\n\n      this.handleSelect([step]);\n      this.props.actions.updateNarrativeStepIdx(idx);\n    }\n  }\n\n  onKeyDown(e) {\n    const { narrative, selected } = this.props.app;\n    const { events } = this.props.domain;\n\n    const prev = (idx) => {\n      if (narrative === null) {\n        this.handleSelect(events[idx - 1], 0);\n      } else {\n        this.selectNarrativeStep(this.props.narrativeIdx - 1);\n      }\n    };\n    const next = (idx) => {\n      if (narrative === null) {\n        this.handleSelect(events[idx + 1], 0);\n      } else {\n        this.selectNarrativeStep(this.props.narrativeIdx + 1);\n      }\n    };\n    if (selected.length > 0) {\n      const ev = selected[selected.length - 1];\n      const idx = this.findEventIdx(ev);\n      switch (e.keyCode) {\n        case 37: // left arrow\n        case 38: // up arrow\n          if (idx <= 0) return;\n          prev(idx);\n          break;\n        case 39: // right arrow\n        case 40: // down arrow\n          if (idx < 0 || idx >= this.props.domain.length - 1) return;\n          next(idx);\n          break;\n        default:\n      }\n    }\n  }\n\n  renderIntroPopup(isMobile, styles) {\n    const { app, actions } = this.props;\n\n    const extraContent = isMobile ? (\n      <div style={{ position: \"relative\", bottom: 0 }}>\n        <h3 style={{ color: \"var(--error-red)\" }}>\n          This platform is not suitable for mobile.\n          <br />\n          <br />\n          Please re-visit the site on a device with a larger screen.\n        </h3>\n      </div>\n    ) : null;\n\n    return (\n      <Popup\n        title=\"Introduction to the platform\"\n        theme=\"dark\"\n        isOpen={app.flags.isIntropopup}\n        onClose={actions.toggleIntroPopup}\n        content={app.intro}\n        styles={styles}\n        isMobile={isMobile}\n      >\n        {extraContent}\n      </Popup>\n    );\n  }\n\n  render() {\n    const { actions, app, domain, features } = this.props;\n    const dateHeight = 80;\n    const padding = 2;\n    const checkMobile = isMobileOnly || window.innerWidth < 600;\n\n    const popupStyles = {\n      height: checkMobile ? \"100vh\" : \"fit-content\",\n      display: checkMobile ? \"block\" : \"table\",\n      width: checkMobile\n        ? \"100vw\"\n        : window.innerWidth > 768\n        ? \"60vw\"\n        : \"calc(100vw - var(--toolbar-width))\",\n      maxWidth: checkMobile ? \"100vw\" : 600,\n      maxHeight: checkMobile\n        ? \"100vh\"\n        : window.innerHeight > 768\n        ? `calc(100vh - ${app.timeline.dimensions.height}px - ${dateHeight}px)`\n        : \"100vh\",\n      left: checkMobile ? padding : \"var(--toolbar-width)\",\n      top: 0,\n      overflowY: \"scroll\",\n    };\n\n    if (checkMobile) {\n      const msg =\n        \"This platform is not suitable for mobile. Please re-visit the site on a device with a larger screen.\";\n      return (\n        <div>\n          {features.USE_COVER && !app.intro && (\n            <StaticPage showing={app.flags.isCover}>\n              {/* enable USE_COVER in config.js features, and customise your header */}\n              {/* pass 'actions.toggleCover' as a prop to your custom header */}\n              <TemplateCover\n                showAppHandler={() => {\n                  /* eslint-disable no-undef */\n                  alert(msg);\n                  /* eslint-enable no-undef */\n                }}\n              />\n            </StaticPage>\n          )}\n          {app.intro && <>{this.renderIntroPopup(true, popupStyles)}</>}\n          {!app.intro && !features.USE_COVER && (\n            <div className=\"fixedTooSmallMessage\">{msg}</div>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <div>\n        <Toolbar\n          isNarrative={!!app.associations.narrative}\n          methods={{\n            onTitle: actions.toggleCover,\n            onSelectFilter: (filters) =>\n              actions.toggleAssociations(\"filters\", filters),\n            onCategoryFilter: (categories) =>\n              actions.toggleAssociations(\"categories\", categories),\n            onShapeFilter: actions.toggleShapes,\n            onSelectNarrative: this.setNarrative,\n          }}\n        />\n        <Space\n          kind={\"map\" in app ? \"map\" : \"space3d\"}\n          onKeyDown={this.onKeyDown}\n          methods={{\n            onSelectNarrative: this.setNarrative,\n            getCategoryColor: this.getCategoryColor,\n            onSelect: app.associations.narrative\n              ? this.selectNarrativeStep\n              : (ev) => this.handleSelect(ev, 1),\n          }}\n        />\n        <Timeline\n          onKeyDown={this.onKeyDown}\n          methods={{\n            onSelect: app.associations.narrative\n              ? this.selectNarrativeStep\n              : (ev) => this.handleSelect(ev, 0),\n            onUpdateTimerange: actions.updateTimeRange,\n            getCategoryColor: this.getCategoryColor,\n          }}\n        />\n        <CardStack\n          timelineDims={app.timeline.dimensions}\n          onViewSource={this.handleViewSource}\n          onSelect={\n            app.associations.narrative ? this.selectNarrativeStep : () => null\n          }\n          onHighlight={this.handleHighlight}\n          onToggleCardstack={() => actions.updateSelected([])}\n          getCategoryColor={this.getCategoryColor}\n        />\n        <NarrativeControls\n          narrative={\n            app.associations.narrative\n              ? {\n                  ...app.associations.narrative,\n                  current: this.props.narrativeIdx,\n                }\n              : null\n          }\n          methods={{\n            onNext: () => this.selectNarrativeStep(this.props.narrativeIdx + 1),\n            onPrev: () => this.selectNarrativeStep(this.props.narrativeIdx - 1),\n            onSelectNarrative: this.setNarrative,\n          }}\n        />\n        <InfoPopup\n          language={app.language}\n          styles={popupStyles}\n          isOpen={app.flags.isInfopopup}\n          onClose={actions.toggleInfoPopup}\n        />\n        {this.renderIntroPopup(false, popupStyles)}\n        {app.debug ? (\n          <Notification\n            isNotification={app.flags.isNotification}\n            notifications={domain.notifications}\n            onToggle={actions.markNotificationsRead}\n          />\n        ) : null}\n        {features.USE_SEARCH && (\n          <Search\n            narrative={app.narrative}\n            queryString={app.searchQuery}\n            events={domain.events}\n            onSearchRowClick={this.handleSelect}\n          />\n        )}\n        {app.source ? (\n          <MediaOverlay\n            source={app.source}\n            onCancel={() => {\n              actions.updateSource(null);\n            }}\n          />\n        ) : null}\n        <LoadingOverlay\n          isLoading={app.loading || app.flags.isFetchingDomain}\n          ui={app.flags.isFetchingDomain}\n          language={app.language}\n        />\n        {features.USE_COVER && (\n          <StaticPage showing={app.flags.isCover}>\n            {/* enable USE_COVER in config.js features, and customise your header */}\n            {/* pass 'actions.toggleCover' as a prop to your custom header */}\n            <TemplateCover\n              showing={app.flags.isCover}\n              showAppHandler={actions.toggleCover}\n            />\n          </StaticPage>\n        )}\n      </div>\n    );\n  }\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  (state) => ({\n    ...state,\n    narrativeIdx: selectors.selectNarrativeIdx(state),\n    narratives: selectors.selectNarratives(state),\n    selected: selectors.selectSelected(state),\n  }),\n  mapDispatchToProps\n)(Dashboard);\n","import \"../scss/main.scss\";\nimport React from \"react\";\nimport Layout from \"./Layout\";\n\nclass App extends React.Component {\n  render() {\n    return <Layout />;\n  }\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store\";\nimport App from \"./components/App\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"explore-app\"));\nroot.render(\n  <Provider store={store}>\n    <App />\n  </Provider>\n);\n\n// Expressions from https://exceptionshub.com/how-to-detect-safari-chrome-ie-firefox-and-opera-browser.html\n\n/* eslint-disable */\n// Opera 8.0+\nconst isOpera =\n  (!!window.opr && !!opr.addons) ||\n  !!window.opera ||\n  navigator.userAgent.indexOf(\" OPR/\") >= 0;\n// Firefox 1.0+\nconst isFirefox = typeof InstallTrigger !== \"undefined\";\n// Safari 3.0+ \"[object HTMLElementConstructor]\"\nconst isSafari =\n  /constructor/i.test(window.HTMLElement) ||\n  (function (p) {\n    return p.toString() === \"[object SafariRemoteNotification]\";\n  })(\n    !window[\"safari\"] ||\n      (typeof safari !== \"undefined\" && safari.pushNotification)\n  );\n// Internet Explorer 6-11\nconst isIE = /* @cc_on!@ */ false || !!document.documentMode;\n// Edge 20+\nconst isEdge = !isIE && !!window.StyleMedia;\n// Chrome 1+\nconst isChrome = !!window.chrome && !!window.chrome.webstore;\n// Blink engine detection\nconst isBlink = (isChrome || isOpera) && !!window.CSS;\n\nif (isEdge || isIE) {\n  alert(\n    \"Please view this website in Opera for best viewing. It is untested in your browser.\"\n  );\n}\n/* eslint-enable */\n"],"sourceRoot":""}